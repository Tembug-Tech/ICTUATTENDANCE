{"ast":null,"code":"import{supabase}from'../supabase/supabase';// ============================================\n// ADMIN DASHBOARD QUERIES\n// ============================================\nexport const adminFetchStats=async()=>{try{const[{count:studentCount,error:studentError},{count:delegateCount,error:delegateError},{count:courseCount,error:courseError},{count:classCount,error:classError}]=await Promise.all([supabase.from('users').select('id',{count:'exact'}).eq('role','student'),supabase.from('users').select('id',{count:'exact'}).eq('role','delegate'),supabase.from('courses').select('id',{count:'exact'}),supabase.from('classes').select('id',{count:'exact'})]);const today=new Date().toISOString().split('T')[0];const{data:todaySessions,error:sessionsError}=await supabase.from('sessions').select('id').eq('session_date',today);if(studentError||delegateError||courseError||classError||sessionsError){throw new Error('Failed to fetch stats');}return{totalStudents:studentCount||0,totalDelegates:delegateCount||0,totalCourses:courseCount||0,totalClasses:classCount||0,sessionsToday:(todaySessions||[]).length,error:null};}catch(error){console.error('Error fetching admin stats:',error);return{totalStudents:0,totalDelegates:0,totalCourses:0,totalClasses:0,sessionsToday:0,error:error.message};}};export const adminFetchOpenSessions=async()=>{try{const{data:sessions,error}=await supabase.from('sessions').select(\"\\n        id,\\n        session_date,\\n        start_time,\\n        end_time,\\n        token,\\n        expires_at,\\n        classes!inner (\\n          id,\\n          class_name,\\n          delegate_id,\\n          users!delegate_id (name),\\n          courses!inner (course_code, course_title)\\n        )\\n      \").order('session_date',{ascending:false}).limit(20);if(error)throw error;// Return all sessions with calculated status\nconst allSessions=(sessions||[]).map(session=>{var _session$classes,_session$classes$cour,_session$classes2,_session$classes2$cou,_session$classes3,_session$classes3$use,_session$token;// Calculate status based on Cameroon time\nconst now=new Date();const sessionDate=session.session_date;const[startHour,startMin]=session.start_time.split(':').map(Number);const[endHour,endMin]=session.end_time.split(':').map(Number);const startDateTimeUTC=new Date(sessionDate);startDateTimeUTC.setHours(startHour,startMin,0,0);startDateTimeUTC.setTime(startDateTimeUTC.getTime()-1*60*60*1000);const endDateTimeUTC=new Date(sessionDate);endDateTimeUTC.setHours(endHour,endMin,0,0);endDateTimeUTC.setTime(endDateTimeUTC.getTime()-1*60*60*1000);const nowUTC=new Date(now.getTime()-now.getTimezoneOffset()*60*1000);let status='Closed';if(nowUTC<startDateTimeUTC){status='Scheduled';}else if(nowUTC>=startDateTimeUTC&&nowUTC<endDateTimeUTC){status='Open';}return{id:session.id,className:((_session$classes=session.classes)===null||_session$classes===void 0?void 0:(_session$classes$cour=_session$classes.courses)===null||_session$classes$cour===void 0?void 0:_session$classes$cour.course_title)||'Unknown',courseCode:((_session$classes2=session.classes)===null||_session$classes2===void 0?void 0:(_session$classes2$cou=_session$classes2.courses)===null||_session$classes2$cou===void 0?void 0:_session$classes2$cou.course_code)||'N/A',delegateName:((_session$classes3=session.classes)===null||_session$classes3===void 0?void 0:(_session$classes3$use=_session$classes3.users)===null||_session$classes3$use===void 0?void 0:_session$classes3$use.name)||'Unknown',date:new Date(session.session_date).toLocaleDateString(),startTime:session.start_time,endTime:session.end_time,status:status,tokenPreview:((_session$token=session.token)===null||_session$token===void 0?void 0:_session$token.slice(0,8).toUpperCase())||'N/A'};});return{sessions:allSessions,error:null};}catch(error){console.error('Error fetching sessions:',error);return{sessions:[],error:error.message};}};export const adminFetchCourseAttendance=async function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;try{const{data:courses,error}=await supabase.from('courses').select('id, course_code, course_title').limit(limit);if(error)throw error;const courseStats=await Promise.all((courses||[]).map(async course=>{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('id').eq('course_id',course.id);const{data:sessions,error:sessionsError}=await supabase.from('sessions').select('id',{count:'exact'}).eq('classes.course_id',course.id);const{data:attendance}=await supabase.from('attendance').select('id').in('session_id',(sessions||[]).map(s=>s.id));const enrollmentCount=(enrollments||[]).length;const totalAttendance=(attendance||[]).length;const percentage=enrollmentCount>0?Math.round(totalAttendance/enrollmentCount*100):0;return{id:course.id,courseCode:course.course_code,courseTitle:course.course_title,enrolledStudents:enrollmentCount,totalAttendance,attendancePercentage:percentage,status:percentage>=80?'Good':percentage>=60?'Fair':'Low'};}));return{courseAttendance:courseStats,error:null};}catch(error){console.error('Error fetching course attendance:',error);return{courseAttendance:[],error:error.message};}};export const adminFetchAttendanceAlerts=async()=>{try{const threshold=75;// 75% attendance threshold\nconst{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('student_id, course_id');if(enrollError)throw enrollError;const alerts=[];for(const enrollment of enrollments||[]){var _await$supabase$from$;// Get sessions for this course\nconst{data:sessions}=await supabase.from('sessions').select('id').in('class_id',((_await$supabase$from$=(await supabase.from('classes').select('id').eq('course_id',enrollment.course_id)).data)===null||_await$supabase$from$===void 0?void 0:_await$supabase$from$.map(c=>c.id))||[]);// Count attendance for this student in these sessions\nconst{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('student_id',enrollment.student_id).in('session_id',(sessions||[]).map(s=>s.id));const percentage=((sessions===null||sessions===void 0?void 0:sessions.length)||0)>0?attendanceCount/sessions.length*100:0;if(percentage<threshold){const{data:student}=await supabase.from('users').select('name, matricule').eq('id',enrollment.student_id).single();const{data:course}=await supabase.from('courses').select('course_title, course_code').eq('id',enrollment.course_id).single();alerts.push({type:'low-attendance',severity:percentage<60?'critical':'warning',studentName:(student===null||student===void 0?void 0:student.name)||'Unknown',studentId:enrollment.student_id,courseTitle:(course===null||course===void 0?void 0:course.course_title)||'Unknown',courseCode:(course===null||course===void 0?void 0:course.course_code)||'N/A',attendance:\"\".concat(Math.round(percentage),\"%\"),message:\"\".concat((student===null||student===void 0?void 0:student.name)||'Student',\" has \").concat(Math.round(percentage),\"% attendance in \").concat((course===null||course===void 0?void 0:course.course_title)||'Course')});}}// Check for expired sessions\nconst{data:expiredSessions}=await supabase.from('sessions').select('id, expires_at, classes!inner(class_name)').lt('expires_at',new Date().toISOString());(expiredSessions||[]).forEach(session=>{var _session$classes4;alerts.push({type:'expired-session',severity:'warning',message:\"Session for \".concat(((_session$classes4=session.classes)===null||_session$classes4===void 0?void 0:_session$classes4.class_name)||'Class',\" was left open beyond allowed time\"),sessionId:session.id});});return{alerts,error:null};}catch(error){console.error('Error fetching alerts:',error);return{alerts:[],error:error.message};}};// ============================================\n// DELEGATE DASHBOARD QUERIES\n// ============================================\nexport const delegateFetchAssignedClasses=async delegateId=>{try{const{data:classes,error}=await supabase.from('classes').select(\"\\n        id,\\n        class_name,\\n        level,\\n        course_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title,\\n          program,\\n          year_level\\n        )\\n      \").eq('delegate_id',delegateId);if(error)throw error;const classesWithSessions=await Promise.all((classes||[]).map(async cls=>{var _cls$courses,_cls$courses2,_cls$courses3,_cls$courses4;const today=new Date().toISOString().split('T')[0];const{data:todaySession}=await supabase.from('sessions').select('id, status, start_time, end_time').eq('class_id',cls.id).eq('session_date',today).limit(1);return{id:cls.id,className:cls.class_name,level:cls.level,courseCode:(_cls$courses=cls.courses)===null||_cls$courses===void 0?void 0:_cls$courses.course_code,courseTitle:(_cls$courses2=cls.courses)===null||_cls$courses2===void 0?void 0:_cls$courses2.course_title,program:(_cls$courses3=cls.courses)===null||_cls$courses3===void 0?void 0:_cls$courses3.program,yearLevel:(_cls$courses4=cls.courses)===null||_cls$courses4===void 0?void 0:_cls$courses4.year_level,sessionToday:(todaySession||[]).length>0?'Open':'None',hasActiveSession:(todaySession||[]).length>0};}));return{classes:classesWithSessions,error:null};}catch(error){console.error('Error fetching assigned classes:',error);return{classes:[],error:error.message};}};export const delegateFetchAssignedCourses=async delegateId=>{try{const{data:courses,error}=await supabase.from('classes').select(\"\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title,\\n          program,\\n          year_level\\n        )\\n      \").eq('delegate_id',delegateId);if(error)throw error;// Remove duplicates\nconst uniqueCourses=[];const seen=new Set();(courses||[]).forEach(item=>{if(item.courses&&!seen.has(item.courses.id)){seen.add(item.courses.id);uniqueCourses.push({id:item.courses.id,courseCode:item.courses.course_code,courseTitle:item.courses.course_title,program:item.courses.program,yearLevel:item.courses.year_level});}});return{courses:uniqueCourses,error:null};}catch(error){console.error('Error fetching assigned courses:',error);return{courses:[],error:error.message};}};export const delegateFetchSessions=async delegateId=>{try{// Fetch ALL sessions (not just for delegate's classes) so delegates can see admin-created sessions\nconst{data:sessions,error}=await supabase.from('sessions').select(\"\\n        id,\\n        session_date,\\n        start_time,\\n        end_time,\\n        token,\\n        expires_at,\\n        classes!inner (\\n          id,\\n          class_name,\\n          delegate_id,\\n          courses!inner (course_code, course_title),\\n          users!delegate_id (name)\\n        )\\n      \").order('session_date',{ascending:false}).limit(50);if(error)throw error;const enrichedSessions=await Promise.all((sessions||[]).map(async session=>{var _session$classes5,_session$classes6,_session$classes6$cou,_session$classes7,_session$classes7$cou,_session$classes8,_session$classes8$use,_session$classes9;const{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('session_id',session.id);return{id:session.id,className:(_session$classes5=session.classes)===null||_session$classes5===void 0?void 0:_session$classes5.class_name,courseTitle:(_session$classes6=session.classes)===null||_session$classes6===void 0?void 0:(_session$classes6$cou=_session$classes6.courses)===null||_session$classes6$cou===void 0?void 0:_session$classes6$cou.course_title,courseCode:(_session$classes7=session.classes)===null||_session$classes7===void 0?void 0:(_session$classes7$cou=_session$classes7.courses)===null||_session$classes7$cou===void 0?void 0:_session$classes7$cou.course_code,delegateName:((_session$classes8=session.classes)===null||_session$classes8===void 0?void 0:(_session$classes8$use=_session$classes8.users)===null||_session$classes8$use===void 0?void 0:_session$classes8$use.name)||'Admin',date:new Date(session.session_date).toLocaleDateString(),startTime:session.start_time,endTime:session.end_time,status:new Date(session.expires_at)>new Date()?'Open':'Closed',attendanceCount:attendanceCount||0,token:session.token,isOwnClass:((_session$classes9=session.classes)===null||_session$classes9===void 0?void 0:_session$classes9.delegate_id)===delegateId};}));return{sessions:enrichedSessions,error:null};}catch(error){console.error('Error fetching sessions:',error);return{sessions:[],error:error.message};}};export const delegateFetchSessionAttendance=async sessionId=>{try{const{data:attendance,error}=await supabase.from('attendance').select(\"\\n        id,\\n        created_at,\\n        users!student_id (\\n          id,\\n          name,\\n          matricule\\n        )\\n      \").eq('session_id',sessionId);if(error)throw error;return{attendance:(attendance||[]).map(a=>{var _a$users,_a$users2;return{id:a.id,studentName:(_a$users=a.users)===null||_a$users===void 0?void 0:_a$users.name,studentMatricule:(_a$users2=a.users)===null||_a$users2===void 0?void 0:_a$users2.matricule,timestamp:new Date(a.created_at).toLocaleTimeString(),status:'Present'};}),error:null};}catch(error){console.error('Error fetching session attendance:',error);return{attendance:[],error:error.message};}};export const delegateFetchStats=async delegateId=>{try{// Get stats for delegate's own classes\nconst{data:classes}=await supabase.from('classes').select('id').eq('delegate_id',delegateId);const classIds=(classes||[]).map(c=>c.id);const{data:ownSessions}=await supabase.from('sessions').select('id, expires_at').in('class_id',classIds);const now=new Date();const activeSessions=(ownSessions||[]).filter(s=>new Date(s.expires_at)>now);const{count:totalAttendance}=await supabase.from('attendance').select('id',{count:'exact'}).in('session_id',(ownSessions||[]).map(s=>s.id));const today=new Date().toISOString().split('T')[0];const{data:todaySessions}=await supabase.from('sessions').select('id').in('class_id',classIds).eq('session_date',today);return{activeSessions:activeSessions.length,totalSessions:(ownSessions===null||ownSessions===void 0?void 0:ownSessions.length)||0,totalMarked:totalAttendance||0,todaySessions:(todaySessions||[]).length,error:null};}catch(error){console.error('Error fetching delegate stats:',error);return{activeSessions:0,totalSessions:0,totalMarked:0,todaySessions:0,error:error.message};}};// ============================================\n// STUDENT DASHBOARD QUERIES\n// ============================================\nexport const studentFetchEnrolledCourses=async studentId=>{try{const{data:enrollments,error}=await supabase.from('enrollments').select(\"\\n        id,\\n        course_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title,\\n          program,\\n          year_level\\n        )\\n      \").eq('student_id',studentId);if(error)throw error;return{courses:(enrollments||[]).map(e=>{var _e$courses,_e$courses2,_e$courses3,_e$courses4,_e$courses5;return{id:(_e$courses=e.courses)===null||_e$courses===void 0?void 0:_e$courses.id,courseCode:(_e$courses2=e.courses)===null||_e$courses2===void 0?void 0:_e$courses2.course_code,courseTitle:(_e$courses3=e.courses)===null||_e$courses3===void 0?void 0:_e$courses3.course_title,program:(_e$courses4=e.courses)===null||_e$courses4===void 0?void 0:_e$courses4.program,yearLevel:(_e$courses5=e.courses)===null||_e$courses5===void 0?void 0:_e$courses5.year_level,enrollmentId:e.id};}),error:null};}catch(error){console.error('Error fetching enrolled courses:',error);return{courses:[],error:error.message};}};export const studentFetchActiveSessions=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('course_id').eq('student_id',studentId);if(enrollError)throw enrollError;const courseIds=(enrollments||[]).map(e=>e.course_id);const{data:classes}=await supabase.from('classes').select('id').in('course_id',courseIds);const classIds=(classes||[]).map(c=>c.id);const now=new Date();const{data:sessions,error:sessionError}=await supabase.from('sessions').select(\"\\n        id,\\n        session_date,\\n        start_time,\\n        end_time,\\n        expires_at,\\n        token,\\n        classes!inner (\\n          id,\\n          class_name,\\n          delegate_id,\\n          users!delegate_id (name),\\n          courses!inner (course_code, course_title)\\n        )\\n      \").in('class_id',classIds).gt('expires_at',now.toISOString());if(sessionError)throw sessionError;// Check which sessions student has already marked\nconst{data:studentAttendance}=await supabase.from('attendance').select('session_id').eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const markedSessionIds=(studentAttendance||[]).map(a=>a.session_id);return{sessions:(sessions||[]).map(s=>{var _s$classes,_s$classes$courses,_s$classes2,_s$classes2$courses,_s$classes3,_s$classes4,_s$classes4$users;return{id:s.id,courseCode:(_s$classes=s.classes)===null||_s$classes===void 0?void 0:(_s$classes$courses=_s$classes.courses)===null||_s$classes$courses===void 0?void 0:_s$classes$courses.course_code,courseTitle:(_s$classes2=s.classes)===null||_s$classes2===void 0?void 0:(_s$classes2$courses=_s$classes2.courses)===null||_s$classes2$courses===void 0?void 0:_s$classes2$courses.course_title,className:(_s$classes3=s.classes)===null||_s$classes3===void 0?void 0:_s$classes3.class_name,delegateName:(_s$classes4=s.classes)===null||_s$classes4===void 0?void 0:(_s$classes4$users=_s$classes4.users)===null||_s$classes4$users===void 0?void 0:_s$classes4$users.name,date:new Date(s.session_date).toLocaleDateString(),startTime:s.start_time,endTime:s.end_time,token:s.token,isMarked:markedSessionIds.includes(s.id),status:'Open'};}),error:null};}catch(error){console.error('Error fetching active sessions:',error);return{sessions:[],error:error.message};}};export const studentFetchAttendanceSummary=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('course_id').eq('student_id',studentId);if(enrollError)throw enrollError;const courseIds=(enrollments||[]).map(e=>e.course_id);const{data:classes}=await supabase.from('classes').select('id').in('course_id',courseIds);const classIds=(classes||[]).map(c=>c.id);const{data:sessions}=await supabase.from('sessions').select('id').in('class_id',classIds);const{data:attendance}=await supabase.from('attendance').select('id').eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const totalSessions=(sessions||[]).length;const totalAttended=(attendance||[]).length;const percentage=totalSessions>0?Math.round(totalAttended/totalSessions*100):0;return{summary:{totalSessions,totalAttended,attendancePercentage:percentage,status:percentage>=80?'Good':percentage>=60?'Fair':'Low'},error:null};}catch(error){console.error('Error fetching attendance summary:',error);return{summary:{totalSessions:0,totalAttended:0,attendancePercentage:0,status:'Unknown'},error:error.message};}};export const studentFetchCourseAttendance=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select(\"\\n        course_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title\\n        )\\n      \").eq('student_id',studentId);if(enrollError)throw enrollError;const courseAttendance=await Promise.all((enrollments||[]).map(async enrollment=>{var _enrollment$courses,_enrollment$courses2;const{data:classes}=await supabase.from('classes').select('id').eq('course_id',enrollment.course_id);const{data:sessions}=await supabase.from('sessions').select('id').in('class_id',(classes||[]).map(c=>c.id));const{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const totalSessions=(sessions||[]).length;const percentage=totalSessions>0?Math.round(attendanceCount/totalSessions*100):0;return{courseCode:(_enrollment$courses=enrollment.courses)===null||_enrollment$courses===void 0?void 0:_enrollment$courses.course_code,courseTitle:(_enrollment$courses2=enrollment.courses)===null||_enrollment$courses2===void 0?void 0:_enrollment$courses2.course_title,courseId:enrollment.course_id,totalSessions,attended:attendanceCount||0,attendancePercentage:percentage,status:percentage>=80?'Good':percentage>=60?'Fair':'Low'};}));return{courseAttendance,error:null};}catch(error){console.error('Error fetching course attendance:',error);return{courseAttendance:[],error:error.message};}};export const studentFetchAlerts=async studentId=>{try{const alerts=[];const threshold=75;const{data:enrollments}=await supabase.from('enrollments').select(\"\\n        course_id,\\n        courses!inner (course_code, course_title)\\n      \").eq('student_id',studentId);for(const enrollment of enrollments||[]){const{data:classes}=await supabase.from('classes').select('id').eq('course_id',enrollment.course_id);const{data:sessions}=await supabase.from('sessions').select('id').in('class_id',(classes||[]).map(c=>c.id));const{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const percentage=((sessions===null||sessions===void 0?void 0:sessions.length)||0)>0?attendanceCount/sessions.length*100:0;if(percentage<threshold){var _enrollment$courses3,_enrollment$courses4,_enrollment$courses5;alerts.push({type:'low-attendance',severity:percentage<60?'critical':'warning',message:\"Your attendance in \".concat((_enrollment$courses3=enrollment.courses)===null||_enrollment$courses3===void 0?void 0:_enrollment$courses3.course_title,\" is \").concat(Math.round(percentage),\"%. You may face academic penalties.\"),courseTitle:(_enrollment$courses4=enrollment.courses)===null||_enrollment$courses4===void 0?void 0:_enrollment$courses4.course_title,courseCode:(_enrollment$courses5=enrollment.courses)===null||_enrollment$courses5===void 0?void 0:_enrollment$courses5.course_code,percentage:Math.round(percentage)});}}return{alerts,error:null};}catch(error){console.error('Error fetching alerts:',error);return{alerts:[],error:error.message};}};// ============================================\n// COURSE MANAGEMENT\n// ============================================\nexport const createCourse=async courseData=>{try{const{data,error}=await supabase.from('courses').insert({course_code:courseData.courseCode,course_title:courseData.courseTitle,program:courseData.program,year_level:courseData.yearLevel,instructor:courseData.instructor,course_status:'scheduled'}).select();if(error)throw error;return{course:data===null||data===void 0?void 0:data[0],error:null};}catch(error){console.error('Error creating course:',error);return{course:null,error:error.message};}};export const createDelegate=async delegateData=>{try{// NOTE: Creating delegates requires admin privileges to create auth users first.\n// This is a limitation when using client-side Supabase without service role.\n// For production, this should be done server-side or with proper auth setup.\nalert('Creating delegates requires admin setup. Please use the setup script or contact administrator to add delegates.');return{delegate:null,error:'Admin privileges required for user creation'};}catch(error){console.error('Error creating delegate:',error);return{delegate:null,error:error.message};}};export const adminFetchAllClasses=async()=>{try{const{data:classes,error}=await supabase.from('classes').select(\"\\n        id,\\n        class_name,\\n        level,\\n        delegate_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title\\n        ),\\n        users!delegate_id (\\n          id,\\n          name\\n        )\\n      \");if(error)throw error;return{classes:(classes||[]).map(cls=>{var _cls$courses5,_cls$courses6,_cls$users;return{id:cls.id,className:cls.class_name,level:cls.level,courseCode:(_cls$courses5=cls.courses)===null||_cls$courses5===void 0?void 0:_cls$courses5.course_code,courseTitle:(_cls$courses6=cls.courses)===null||_cls$courses6===void 0?void 0:_cls$courses6.course_title,delegateId:cls.delegate_id,delegateName:(_cls$users=cls.users)===null||_cls$users===void 0?void 0:_cls$users.name};}),error:null};}catch(error){console.error('Error fetching all classes:',error);return{classes:[],error:error.message};}};export const adminFetchAllStudents=async()=>{try{const{data:students,error}=await supabase.from('users').select('id, name, matricule').eq('role','student');if(error)throw error;return{students:(students||[]).map(student=>({id:student.id,name:student.name,matricule:student.matricule})),error:null};}catch(error){console.error('Error fetching all students:',error);return{students:[],error:error.message};}};export const adminFetchAllCourses=async()=>{try{const{data:courses,error}=await supabase.from('courses').select('id, course_code, course_title, program, year_level');if(error)throw error;return{courses:(courses||[]).map(course=>({id:course.id,courseCode:course.course_code,courseTitle:course.course_title,program:course.program,yearLevel:course.year_level})),error:null};}catch(error){console.error('Error fetching all courses:',error);return{courses:[],error:error.message};}};export const adminFetchAllDelegates=async()=>{try{const{data:delegates,error}=await supabase.from('users').select('id, name').eq('role','delegate');if(error)throw error;return{delegates:(delegates||[]).map(delegate=>({id:delegate.id,name:delegate.name})),error:null};}catch(error){console.error('Error fetching all delegates:',error);return{delegates:[],error:error.message};}};export const promoteStudentToDelegate=async studentId=>{try{const{data,error}=await supabase.from('users').update({role:'delegate'}).eq('id',studentId).select();if(error)throw error;return{delegate:data===null||data===void 0?void 0:data[0],error:null};}catch(error){console.error('Error promoting student to delegate:',error);return{delegate:null,error:error.message};}};// ============================================\n// SESSION MANAGEMENT\n// ============================================\nexport const createSession=async(courseId,delegateId,sessionDate,startTime,endTime)=>{try{// First, find or create the class for this course and delegate\nlet{data:existingClass,error:classError}=await supabase.from('classes').select('id').eq('course_id',courseId).eq('delegate_id',delegateId).single();let classId;if(classError&&classError.code==='PGRST116'){// No rows returned\n// Create new class\nconst{data:course,error:courseError}=await supabase.from('courses').select('course_title').eq('id',courseId).single();if(courseError)throw courseError;const{data:newClass,error:createClassError}=await supabase.from('classes').insert({class_name:course.course_title,course_id:courseId,delegate_id:delegateId}).select('id').single();if(createClassError)throw createClassError;classId=newClass.id;}else if(classError){throw classError;}else{classId=existingClass.id;}// Generate a unique token\nconst token=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);// Calculate expires_at (1 hour after end time) in UTC\nconst[endHour,endMin]=endTime.split(':');const endDateTimeCameroon=new Date(sessionDate);endDateTimeCameroon.setHours(parseInt(endHour),parseInt(endMin),0,0);const expiresAt=new Date(endDateTimeCameroon.getTime()+60*60*1000-1*60*60*1000);// Add 1 hour, then convert Cameroon to UTC\nconst{data,error}=await supabase.from('sessions').insert({class_id:classId,session_date:sessionDate,start_time:startTime,end_time:endTime,token,expires_at:expiresAt.toISOString()}).select();if(error)throw error;return{session:data===null||data===void 0?void 0:data[0],error:null};}catch(error){console.error('Error creating session:',error);return{session:null,error:error.message};}};export const markAttendance=async(studentId,sessionId)=>{try{const{data,error}=await supabase.from('attendance').insert({student_id:studentId,session_id:sessionId}).select();if(error)throw error;return{success:true,attendance:data===null||data===void 0?void 0:data[0],error:null};}catch(error){console.error('Error marking attendance:',error);return{success:false,attendance:null,error:error.message};}};// ============================================\n// ATTENDANCE HISTORY & EXPORT QUERIES\n// ============================================\nexport const studentFetchAttendanceHistory=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id',studentId);if(enrollError)throw enrollError;const history=[];for(const enrollment of enrollments||[]){var _enrollment$courses6,_enrollment$courses7;const courseId=enrollment.course_id;const courseName=((_enrollment$courses6=enrollment.courses)===null||_enrollment$courses6===void 0?void 0:_enrollment$courses6.course_title)||'';const courseCode=((_enrollment$courses7=enrollment.courses)===null||_enrollment$courses7===void 0?void 0:_enrollment$courses7.course_code)||'';// Get classes for this course\nconst{data:classes}=await supabase.from('classes').select('id, class_name').eq('course_id',courseId);const classIds=(classes||[]).map(c=>c.id);// Get all sessions for these classes\nconst{data:sessions}=await supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id',classIds).order('session_date',{ascending:false});// Get attendance records for this student in these sessions\nconst{data:attendance}=await supabase.from('attendance').select('id, session_id, created_at').eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const attendanceMap=new Set((attendance||[]).map(a=>a.session_id));// Create history records\nfor(const session of sessions||[]){const classInfo=classes===null||classes===void 0?void 0:classes.find(c=>c.id===session.class_id);history.push({courseCode,courseName,className:(classInfo===null||classInfo===void 0?void 0:classInfo.class_name)||'Unknown',sessionDate:new Date(session.session_date).toLocaleDateString(),startTime:session.start_time,endTime:session.end_time,status:attendanceMap.has(session.id)?'Present':'Absent',sessionId:session.id});}}// Calculate per-course statistics\nconst courseStats={};for(const record of history){if(!courseStats[record.courseCode]){courseStats[record.courseCode]={courseCode:record.courseCode,courseName:record.courseName,totalSessions:0,attended:0,percentage:0};}courseStats[record.courseCode].totalSessions++;if(record.status==='Present'){courseStats[record.courseCode].attended++;}}// Calculate percentages\nfor(const key in courseStats){const stat=courseStats[key];stat.percentage=stat.totalSessions>0?Math.round(stat.attended/stat.totalSessions*100):0;}return{history:history.sort((a,b)=>new Date(b.sessionDate)-new Date(a.sessionDate)),courseStats:Object.values(courseStats),error:null};}catch(error){console.error('Error fetching attendance history:',error);return{history:[],courseStats:[],error:error.message};}};export const adminFetchAttendanceExportData=async function(){let filters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};try{// Fetch all students\nconst{data:students,error:studentError}=await supabase.from('users').select('id, name, matricule').eq('role','student');if(studentError)throw studentError;const exportData=[];for(const student of students||[]){// Get student's enrollments\nconst{data:enrollments}=await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id',student.id);for(const enrollment of enrollments||[]){var _enrollment$courses8;// Apply course filter if provided\nif(filters.courseCode&&((_enrollment$courses8=enrollment.courses)===null||_enrollment$courses8===void 0?void 0:_enrollment$courses8.course_code)!==filters.courseCode){continue;}const courseId=enrollment.course_id;// Get classes for this course\nconst{data:classes}=await supabase.from('classes').select('id, class_name').eq('course_id',courseId);const classIds=(classes||[]).map(c=>c.id);// Get sessions\nlet sessionsQuery=supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id',classIds);// Apply date range filter if provided\nif(filters.startDate){sessionsQuery=sessionsQuery.gte('session_date',filters.startDate);}if(filters.endDate){sessionsQuery=sessionsQuery.lte('session_date',filters.endDate);}const{data:sessions}=await sessionsQuery.order('session_date',{ascending:false});// Get attendance records\nconst{data:attendance}=await supabase.from('attendance').select('id, session_id, created_at').eq('student_id',student.id).in('session_id',(sessions||[]).map(s=>s.id));const attendanceMap=new Map((attendance||[]).map(a=>[a.session_id,true]));// Create export records\nfor(const session of sessions||[]){var _enrollment$courses9,_enrollment$courses0;const classInfo=classes===null||classes===void 0?void 0:classes.find(c=>c.id===session.class_id);exportData.push({studentName:student.name,studentId:student.matricule,course:(_enrollment$courses9=enrollment.courses)===null||_enrollment$courses9===void 0?void 0:_enrollment$courses9.course_code,courseName:(_enrollment$courses0=enrollment.courses)===null||_enrollment$courses0===void 0?void 0:_enrollment$courses0.course_title,class:(classInfo===null||classInfo===void 0?void 0:classInfo.class_name)||'Unknown',sessionDate:new Date(session.session_date).toLocaleDateString(),sessionTime:\"\".concat(session.start_time,\" - \").concat(session.end_time),status:attendanceMap.has(session.id)?'Present':'Absent'});}}}return{data:exportData,error:null};}catch(error){console.error('Error fetching export data:',error);return{data:[],error:error.message};}};","map":{"version":3,"names":["supabase","adminFetchStats","count","studentCount","error","studentError","delegateCount","delegateError","courseCount","courseError","classCount","classError","Promise","all","from","select","eq","today","Date","toISOString","split","data","todaySessions","sessionsError","Error","totalStudents","totalDelegates","totalCourses","totalClasses","sessionsToday","length","console","message","adminFetchOpenSessions","sessions","order","ascending","limit","allSessions","map","session","_session$classes","_session$classes$cour","_session$classes2","_session$classes2$cou","_session$classes3","_session$classes3$use","_session$token","now","sessionDate","session_date","startHour","startMin","start_time","Number","endHour","endMin","end_time","startDateTimeUTC","setHours","setTime","getTime","endDateTimeUTC","nowUTC","getTimezoneOffset","status","id","className","classes","courses","course_title","courseCode","course_code","delegateName","users","name","date","toLocaleDateString","startTime","endTime","tokenPreview","token","slice","toUpperCase","adminFetchCourseAttendance","arguments","undefined","courseStats","course","enrollments","enrollError","attendance","in","s","enrollmentCount","totalAttendance","percentage","Math","round","courseTitle","enrolledStudents","attendancePercentage","courseAttendance","adminFetchAttendanceAlerts","threshold","alerts","enrollment","_await$supabase$from$","course_id","c","attendanceCount","student_id","student","single","push","type","severity","studentName","studentId","concat","expiredSessions","lt","forEach","_session$classes4","class_name","sessionId","delegateFetchAssignedClasses","delegateId","classesWithSessions","cls","_cls$courses","_cls$courses2","_cls$courses3","_cls$courses4","todaySession","level","program","yearLevel","year_level","sessionToday","hasActiveSession","delegateFetchAssignedCourses","uniqueCourses","seen","Set","item","has","add","delegateFetchSessions","enrichedSessions","_session$classes5","_session$classes6","_session$classes6$cou","_session$classes7","_session$classes7$cou","_session$classes8","_session$classes8$use","_session$classes9","expires_at","isOwnClass","delegate_id","delegateFetchSessionAttendance","a","_a$users","_a$users2","studentMatricule","matricule","timestamp","created_at","toLocaleTimeString","delegateFetchStats","classIds","ownSessions","activeSessions","filter","totalSessions","totalMarked","studentFetchEnrolledCourses","e","_e$courses","_e$courses2","_e$courses3","_e$courses4","_e$courses5","enrollmentId","studentFetchActiveSessions","courseIds","sessionError","gt","studentAttendance","markedSessionIds","session_id","_s$classes","_s$classes$courses","_s$classes2","_s$classes2$courses","_s$classes3","_s$classes4","_s$classes4$users","isMarked","includes","studentFetchAttendanceSummary","totalAttended","summary","studentFetchCourseAttendance","_enrollment$courses","_enrollment$courses2","courseId","attended","studentFetchAlerts","_enrollment$courses3","_enrollment$courses4","_enrollment$courses5","createCourse","courseData","insert","instructor","course_status","createDelegate","delegateData","alert","delegate","adminFetchAllClasses","_cls$courses5","_cls$courses6","_cls$users","adminFetchAllStudents","students","adminFetchAllCourses","adminFetchAllDelegates","delegates","promoteStudentToDelegate","update","role","createSession","existingClass","classId","code","newClass","createClassError","random","toString","substring","endDateTimeCameroon","parseInt","expiresAt","class_id","markAttendance","success","studentFetchAttendanceHistory","history","_enrollment$courses6","_enrollment$courses7","courseName","attendanceMap","classInfo","find","record","key","stat","sort","b","Object","values","adminFetchAttendanceExportData","filters","exportData","_enrollment$courses8","sessionsQuery","startDate","gte","endDate","lte","Map","_enrollment$courses9","_enrollment$courses0","class","sessionTime"],"sources":["C:/Users/PFI/Desktop/ictuattennce_portal/ATTENDANCE/src/utils/dashboardQueries.js"],"sourcesContent":["import { supabase } from '../supabase/supabase';\r\n\r\n// ============================================\r\n// ADMIN DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const adminFetchStats = async () => {\r\n  try {\r\n    const [\r\n      { count: studentCount, error: studentError },\r\n      { count: delegateCount, error: delegateError },\r\n      { count: courseCount, error: courseError },\r\n      { count: classCount, error: classError }\r\n    ] = await Promise.all([\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'student'),\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'delegate'),\r\n      supabase\r\n        .from('courses')\r\n        .select('id', { count: 'exact' }),\r\n      supabase\r\n        .from('classes')\r\n        .select('id', { count: 'exact' })\r\n    ]);\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions, error: sessionsError } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .eq('session_date', today);\r\n\r\n    if (studentError || delegateError || courseError || classError || sessionsError) {\r\n      throw new Error('Failed to fetch stats');\r\n    }\r\n\r\n    return {\r\n      totalStudents: studentCount || 0,\r\n      totalDelegates: delegateCount || 0,\r\n      totalCourses: courseCount || 0,\r\n      totalClasses: classCount || 0,\r\n      sessionsToday: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching admin stats:', error);\r\n    return {\r\n      totalStudents: 0,\r\n      totalDelegates: 0,\r\n      totalCourses: 0,\r\n      totalClasses: 0,\r\n      sessionsToday: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const adminFetchOpenSessions = async () => {\r\n  try {\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(20);\r\n\r\n    if (error) throw error;\r\n\r\n    // Return all sessions with calculated status\r\n    const allSessions = (sessions || []).map(session => {\r\n      // Calculate status based on Cameroon time\r\n      const now = new Date();\r\n      const sessionDate = session.session_date;\r\n      const [startHour, startMin] = session.start_time.split(':').map(Number);\r\n      const [endHour, endMin] = session.end_time.split(':').map(Number);\r\n\r\n      const startDateTimeUTC = new Date(sessionDate);\r\n      startDateTimeUTC.setHours(startHour, startMin, 0, 0);\r\n      startDateTimeUTC.setTime(startDateTimeUTC.getTime() - (1 * 60 * 60 * 1000));\r\n\r\n      const endDateTimeUTC = new Date(sessionDate);\r\n      endDateTimeUTC.setHours(endHour, endMin, 0, 0);\r\n      endDateTimeUTC.setTime(endDateTimeUTC.getTime() - (1 * 60 * 60 * 1000));\r\n\r\n      const nowUTC = new Date(now.getTime() - (now.getTimezoneOffset() * 60 * 1000));\r\n\r\n      let status = 'Closed';\r\n      if (nowUTC < startDateTimeUTC) {\r\n        status = 'Scheduled';\r\n      } else if (nowUTC >= startDateTimeUTC && nowUTC < endDateTimeUTC) {\r\n        status = 'Open';\r\n      }\r\n\r\n      return {\r\n        id: session.id,\r\n        className: session.classes?.courses?.course_title || 'Unknown',\r\n        courseCode: session.classes?.courses?.course_code || 'N/A',\r\n        delegateName: session.classes?.users?.name || 'Unknown',\r\n        date: new Date(session.session_date).toLocaleDateString(),\r\n        startTime: session.start_time,\r\n        endTime: session.end_time,\r\n        status: status,\r\n        tokenPreview: session.token?.slice(0, 8).toUpperCase() || 'N/A'\r\n      };\r\n    });\r\n\r\n    return { sessions: allSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchCourseAttendance = async (limit = 10) => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title')\r\n      .limit(limit);\r\n\r\n    if (error) throw error;\r\n\r\n    const courseStats = await Promise.all(\r\n      (courses || []).map(async (course) => {\r\n        const { data: enrollments, error: enrollError } = await supabase\r\n          .from('enrollments')\r\n          .select('id')\r\n          .eq('course_id', course.id);\r\n\r\n        const { data: sessions, error: sessionsError } = await supabase\r\n          .from('sessions')\r\n          .select('id', { count: 'exact' })\r\n          .eq('classes.course_id', course.id);\r\n\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id')\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const enrollmentCount = (enrollments || []).length;\r\n        const totalAttendance = (attendance || []).length;\r\n        const percentage = enrollmentCount > 0 ? Math.round((totalAttendance / enrollmentCount) * 100) : 0;\r\n\r\n        return {\r\n          id: course.id,\r\n          courseCode: course.course_code,\r\n          courseTitle: course.course_title,\r\n          enrolledStudents: enrollmentCount,\r\n          totalAttendance,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance: courseStats, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceAlerts = async () => {\r\n  try {\r\n    const threshold = 75; // 75% attendance threshold\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('student_id, course_id');\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const alerts = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      // Get sessions for this course\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (\r\n          await supabase\r\n            .from('classes')\r\n            .select('id')\r\n            .eq('course_id', enrollment.course_id)\r\n        ).data?.map(c => c.id) || []);\r\n\r\n      // Count attendance for this student in these sessions\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', enrollment.student_id)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        const { data: student } = await supabase\r\n          .from('users')\r\n          .select('name, matricule')\r\n          .eq('id', enrollment.student_id)\r\n          .single();\r\n\r\n        const { data: course } = await supabase\r\n          .from('courses')\r\n          .select('course_title, course_code')\r\n          .eq('id', enrollment.course_id)\r\n          .single();\r\n\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          studentName: student?.name || 'Unknown',\r\n          studentId: enrollment.student_id,\r\n          courseTitle: course?.course_title || 'Unknown',\r\n          courseCode: course?.course_code || 'N/A',\r\n          attendance: `${Math.round(percentage)}%`,\r\n          message: `${student?.name || 'Student'} has ${Math.round(percentage)}% attendance in ${course?.course_title || 'Course'}`\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check for expired sessions\r\n    const { data: expiredSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at, classes!inner(class_name)')\r\n      .lt('expires_at', new Date().toISOString());\r\n\r\n    (expiredSessions || []).forEach(session => {\r\n      alerts.push({\r\n        type: 'expired-session',\r\n        severity: 'warning',\r\n        message: `Session for ${session.classes?.class_name || 'Class'} was left open beyond allowed time`,\r\n        sessionId: session.id\r\n      });\r\n    });\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// DELEGATE DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const delegateFetchAssignedClasses = async (delegateId) => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        level,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('delegate_id', delegateId);\r\n\r\n    if (error) throw error;\r\n\r\n    const classesWithSessions = await Promise.all(\r\n      (classes || []).map(async (cls) => {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const { data: todaySession } = await supabase\r\n          .from('sessions')\r\n          .select('id, status, start_time, end_time')\r\n          .eq('class_id', cls.id)\r\n          .eq('session_date', today)\r\n          .limit(1);\r\n\r\n        return {\r\n          id: cls.id,\r\n          className: cls.class_name,\r\n          level: cls.level,\r\n          courseCode: cls.courses?.course_code,\r\n          courseTitle: cls.courses?.course_title,\r\n          program: cls.courses?.program,\r\n          yearLevel: cls.courses?.year_level,\r\n          sessionToday: (todaySession || []).length > 0 ? 'Open' : 'None',\r\n          hasActiveSession: (todaySession || []).length > 0\r\n        };\r\n      })\r\n    );\r\n\r\n    return { classes: classesWithSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching assigned classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchAssignedCourses = async (delegateId) => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('delegate_id', delegateId);\r\n\r\n    if (error) throw error;\r\n\r\n    // Remove duplicates\r\n    const uniqueCourses = [];\r\n    const seen = new Set();\r\n    (courses || []).forEach(item => {\r\n      if (item.courses && !seen.has(item.courses.id)) {\r\n        seen.add(item.courses.id);\r\n        uniqueCourses.push({\r\n          id: item.courses.id,\r\n          courseCode: item.courses.course_code,\r\n          courseTitle: item.courses.course_title,\r\n          program: item.courses.program,\r\n          yearLevel: item.courses.year_level\r\n        });\r\n      }\r\n    });\r\n\r\n    return {\r\n      courses: uniqueCourses,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching assigned courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessions = async (delegateId) => {\r\n  try {\r\n    // Fetch ALL sessions (not just for delegate's classes) so delegates can see admin-created sessions\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          courses!inner (course_code, course_title),\r\n          users!delegate_id (name)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(50);\r\n\r\n    if (error) throw error;\r\n\r\n    const enrichedSessions = await Promise.all(\r\n      (sessions || []).map(async (session) => {\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('session_id', session.id);\r\n\r\n        return {\r\n          id: session.id,\r\n          className: session.classes?.class_name,\r\n          courseTitle: session.classes?.courses?.course_title,\r\n          courseCode: session.classes?.courses?.course_code,\r\n          delegateName: session.classes?.users?.name || 'Admin',\r\n          date: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: new Date(session.expires_at) > new Date() ? 'Open' : 'Closed',\r\n          attendanceCount: attendanceCount || 0,\r\n          token: session.token,\r\n          isOwnClass: session.classes?.delegate_id === delegateId\r\n        };\r\n      })\r\n    );\r\n\r\n    return { sessions: enrichedSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessionAttendance = async (sessionId) => {\r\n  try {\r\n    const { data: attendance, error } = await supabase\r\n      .from('attendance')\r\n      .select(`\r\n        id,\r\n        created_at,\r\n        users!student_id (\r\n          id,\r\n          name,\r\n          matricule\r\n        )\r\n      `)\r\n      .eq('session_id', sessionId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      attendance: (attendance || []).map(a => ({\r\n        id: a.id,\r\n        studentName: a.users?.name,\r\n        studentMatricule: a.users?.matricule,\r\n        timestamp: new Date(a.created_at).toLocaleTimeString(),\r\n        status: 'Present'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching session attendance:', error);\r\n    return { attendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchStats = async (delegateId) => {\r\n  try {\r\n    // Get stats for delegate's own classes\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .eq('delegate_id', delegateId);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: ownSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at')\r\n      .in('class_id', classIds);\r\n\r\n    const now = new Date();\r\n    const activeSessions = (ownSessions || []).filter(s => new Date(s.expires_at) > now);\r\n\r\n    const { count: totalAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('id', { count: 'exact' })\r\n      .in('session_id', (ownSessions || []).map(s => s.id));\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds)\r\n      .eq('session_date', today);\r\n\r\n    return {\r\n      activeSessions: activeSessions.length,\r\n      totalSessions: ownSessions?.length || 0,\r\n      totalMarked: totalAttendance || 0,\r\n      todaySessions: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching delegate stats:', error);\r\n    return {\r\n      activeSessions: 0,\r\n      totalSessions: 0,\r\n      totalMarked: 0,\r\n      todaySessions: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// STUDENT DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchEnrolledCourses = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        id,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (enrollments || []).map(e => ({\r\n        id: e.courses?.id,\r\n        courseCode: e.courses?.course_code,\r\n        courseTitle: e.courses?.course_title,\r\n        program: e.courses?.program,\r\n        yearLevel: e.courses?.year_level,\r\n        enrollmentId: e.id\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching enrolled courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchActiveSessions = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n    const now = new Date();\r\n\r\n    const { data: sessions, error: sessionError } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        expires_at,\r\n        token,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .in('class_id', classIds)\r\n      .gt('expires_at', now.toISOString());\r\n\r\n    if (sessionError) throw sessionError;\r\n\r\n    // Check which sessions student has already marked\r\n    const { data: studentAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('session_id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const markedSessionIds = (studentAttendance || []).map(a => a.session_id);\r\n\r\n    return {\r\n      sessions: (sessions || []).map(s => ({\r\n        id: s.id,\r\n        courseCode: s.classes?.courses?.course_code,\r\n        courseTitle: s.classes?.courses?.course_title,\r\n        className: s.classes?.class_name,\r\n        delegateName: s.classes?.users?.name,\r\n        date: new Date(s.session_date).toLocaleDateString(),\r\n        startTime: s.start_time,\r\n        endTime: s.end_time,\r\n        token: s.token,\r\n        isMarked: markedSessionIds.includes(s.id),\r\n        status: 'Open'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching active sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAttendanceSummary = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: sessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds);\r\n\r\n    const { data: attendance } = await supabase\r\n      .from('attendance')\r\n      .select('id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const totalSessions = (sessions || []).length;\r\n    const totalAttended = (attendance || []).length;\r\n    const percentage = totalSessions > 0 ? Math.round((totalAttended / totalSessions) * 100) : 0;\r\n\r\n    return {\r\n      summary: {\r\n        totalSessions,\r\n        totalAttended,\r\n        attendancePercentage: percentage,\r\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n      },\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance summary:', error);\r\n    return {\r\n      summary: {\r\n        totalSessions: 0,\r\n        totalAttended: 0,\r\n        attendancePercentage: 0,\r\n        status: 'Unknown'\r\n      },\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const studentFetchCourseAttendance = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseAttendance = await Promise.all(\r\n      (enrollments || []).map(async (enrollment) => {\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id')\r\n          .eq('course_id', enrollment.course_id);\r\n\r\n        const { data: sessions } = await supabase\r\n          .from('sessions')\r\n          .select('id')\r\n          .in('class_id', (classes || []).map(c => c.id));\r\n\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('student_id', studentId)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const totalSessions = (sessions || []).length;\r\n        const percentage = totalSessions > 0 ? Math.round((attendanceCount / totalSessions) * 100) : 0;\r\n\r\n        return {\r\n          courseCode: enrollment.courses?.course_code,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseId: enrollment.course_id,\r\n          totalSessions,\r\n          attended: attendanceCount || 0,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAlerts = async (studentId) => {\r\n  try {\r\n    const alerts = [];\r\n    const threshold = 75;\r\n\r\n    const { data: enrollments } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (course_code, course_title)\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id')\r\n        .eq('course_id', enrollment.course_id);\r\n\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (classes || []).map(c => c.id));\r\n\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          message: `Your attendance in ${enrollment.courses?.course_title} is ${Math.round(percentage)}%. You may face academic penalties.`,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseCode: enrollment.courses?.course_code,\r\n          percentage: Math.round(percentage)\r\n        });\r\n      }\r\n    }\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// COURSE MANAGEMENT\r\n// ============================================\r\n\r\nexport const createCourse = async (courseData) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('courses')\r\n      .insert({\r\n        course_code: courseData.courseCode,\r\n        course_title: courseData.courseTitle,\r\n        program: courseData.program,\r\n        year_level: courseData.yearLevel,\r\n        instructor: courseData.instructor,\r\n        course_status: 'scheduled'\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { course: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating course:', error);\r\n    return { course: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const createDelegate = async (delegateData) => {\r\n  try {\r\n    // NOTE: Creating delegates requires admin privileges to create auth users first.\r\n    // This is a limitation when using client-side Supabase without service role.\r\n    // For production, this should be done server-side or with proper auth setup.\r\n\r\n    alert('Creating delegates requires admin setup. Please use the setup script or contact administrator to add delegates.');\r\n    return { delegate: null, error: 'Admin privileges required for user creation' };\r\n  } catch (error) {\r\n    console.error('Error creating delegate:', error);\r\n    return { delegate: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllClasses = async () => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        level,\r\n        delegate_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        ),\r\n        users!delegate_id (\r\n          id,\r\n          name\r\n        )\r\n      `);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      classes: (classes || []).map(cls => ({\r\n        id: cls.id,\r\n        className: cls.class_name,\r\n        level: cls.level,\r\n        courseCode: cls.courses?.course_code,\r\n        courseTitle: cls.courses?.course_title,\r\n        delegateId: cls.delegate_id,\r\n        delegateName: cls.users?.name\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllStudents = async () => {\r\n  try {\r\n    const { data: students, error } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      students: (students || []).map(student => ({\r\n        id: student.id,\r\n        name: student.name,\r\n        matricule: student.matricule\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all students:', error);\r\n    return { students: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllCourses = async () => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title, program, year_level');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (courses || []).map(course => ({\r\n        id: course.id,\r\n        courseCode: course.course_code,\r\n        courseTitle: course.course_title,\r\n        program: course.program,\r\n        yearLevel: course.year_level\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllDelegates = async () => {\r\n  try {\r\n    const { data: delegates, error } = await supabase\r\n      .from('users')\r\n      .select('id, name')\r\n      .eq('role', 'delegate');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      delegates: (delegates || []).map(delegate => ({\r\n        id: delegate.id,\r\n        name: delegate.name\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all delegates:', error);\r\n    return { delegates: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const promoteStudentToDelegate = async (studentId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('users')\r\n      .update({ role: 'delegate' })\r\n      .eq('id', studentId)\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { delegate: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error promoting student to delegate:', error);\r\n    return { delegate: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// SESSION MANAGEMENT\r\n// ============================================\r\n\r\nexport const createSession = async (courseId, delegateId, sessionDate, startTime, endTime) => {\r\n  try {\r\n    // First, find or create the class for this course and delegate\r\n    let { data: existingClass, error: classError } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .eq('course_id', courseId)\r\n      .eq('delegate_id', delegateId)\r\n      .single();\r\n\r\n    let classId;\r\n    if (classError && classError.code === 'PGRST116') { // No rows returned\r\n      // Create new class\r\n      const { data: course, error: courseError } = await supabase\r\n        .from('courses')\r\n        .select('course_title')\r\n        .eq('id', courseId)\r\n        .single();\r\n\r\n      if (courseError) throw courseError;\r\n\r\n      const { data: newClass, error: createClassError } = await supabase\r\n        .from('classes')\r\n        .insert({\r\n          class_name: course.course_title,\r\n          course_id: courseId,\r\n          delegate_id: delegateId\r\n        })\r\n        .select('id')\r\n        .single();\r\n\r\n      if (createClassError) throw createClassError;\r\n      classId = newClass.id;\r\n    } else if (classError) {\r\n      throw classError;\r\n    } else {\r\n      classId = existingClass.id;\r\n    }\r\n\r\n    // Generate a unique token\r\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\r\n\r\n    // Calculate expires_at (1 hour after end time) in UTC\r\n    const [endHour, endMin] = endTime.split(':');\r\n    const endDateTimeCameroon = new Date(sessionDate);\r\n    endDateTimeCameroon.setHours(parseInt(endHour), parseInt(endMin), 0, 0);\r\n    const expiresAt = new Date(endDateTimeCameroon.getTime() + (60 * 60 * 1000) - (1 * 60 * 60 * 1000)); // Add 1 hour, then convert Cameroon to UTC\r\n\r\n    const { data, error } = await supabase\r\n      .from('sessions')\r\n      .insert({\r\n        class_id: classId,\r\n        session_date: sessionDate,\r\n        start_time: startTime,\r\n        end_time: endTime,\r\n        token,\r\n        expires_at: expiresAt.toISOString()\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { session: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating session:', error);\r\n    return { session: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const markAttendance = async (studentId, sessionId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('attendance')\r\n      .insert({\r\n        student_id: studentId,\r\n        session_id: sessionId\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { success: true, attendance: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error marking attendance:', error);\r\n    return { success: false, attendance: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// ATTENDANCE HISTORY & EXPORT QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchAttendanceHistory = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id, courses!inner(id, course_code, course_title)')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const history = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const courseId = enrollment.course_id;\r\n      const courseName = enrollment.courses?.course_title || '';\r\n      const courseCode = enrollment.courses?.course_code || '';\r\n\r\n      // Get classes for this course\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id, class_name')\r\n        .eq('course_id', courseId);\r\n\r\n      const classIds = (classes || []).map(c => c.id);\r\n\r\n      // Get all sessions for these classes\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n        .in('class_id', classIds)\r\n        .order('session_date', { ascending: false });\r\n\r\n      // Get attendance records for this student in these sessions\r\n      const { data: attendance } = await supabase\r\n        .from('attendance')\r\n        .select('id, session_id, created_at')\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const attendanceMap = new Set((attendance || []).map(a => a.session_id));\r\n\r\n      // Create history records\r\n      for (const session of (sessions || [])) {\r\n        const classInfo = classes?.find(c => c.id === session.class_id);\r\n        history.push({\r\n          courseCode,\r\n          courseName,\r\n          className: classInfo?.class_name || 'Unknown',\r\n          sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: attendanceMap.has(session.id) ? 'Present' : 'Absent',\r\n          sessionId: session.id\r\n        });\r\n      }\r\n    }\r\n\r\n    // Calculate per-course statistics\r\n    const courseStats = {};\r\n    for (const record of history) {\r\n      if (!courseStats[record.courseCode]) {\r\n        courseStats[record.courseCode] = {\r\n          courseCode: record.courseCode,\r\n          courseName: record.courseName,\r\n          totalSessions: 0,\r\n          attended: 0,\r\n          percentage: 0\r\n        };\r\n      }\r\n      courseStats[record.courseCode].totalSessions++;\r\n      if (record.status === 'Present') {\r\n        courseStats[record.courseCode].attended++;\r\n      }\r\n    }\r\n\r\n    // Calculate percentages\r\n    for (const key in courseStats) {\r\n      const stat = courseStats[key];\r\n      stat.percentage = stat.totalSessions > 0\r\n        ? Math.round((stat.attended / stat.totalSessions) * 100)\r\n        : 0;\r\n    }\r\n\r\n    return {\r\n      history: history.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate)),\r\n      courseStats: Object.values(courseStats),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance history:', error);\r\n    return { history: [], courseStats: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceExportData = async (filters = {}) => {\r\n  try {\r\n    // Fetch all students\r\n    const { data: students, error: studentError } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (studentError) throw studentError;\r\n\r\n    const exportData = [];\r\n\r\n    for (const student of (students || [])) {\r\n      // Get student's enrollments\r\n      const { data: enrollments } = await supabase\r\n        .from('enrollments')\r\n        .select('course_id, courses!inner(id, course_code, course_title)')\r\n        .eq('student_id', student.id);\r\n\r\n      for (const enrollment of (enrollments || [])) {\r\n        // Apply course filter if provided\r\n        if (filters.courseCode && enrollment.courses?.course_code !== filters.courseCode) {\r\n          continue;\r\n        }\r\n\r\n        const courseId = enrollment.course_id;\r\n\r\n        // Get classes for this course\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id, class_name')\r\n          .eq('course_id', courseId);\r\n\r\n        const classIds = (classes || []).map(c => c.id);\r\n\r\n        // Get sessions\r\n        let sessionsQuery = supabase\r\n          .from('sessions')\r\n          .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n          .in('class_id', classIds);\r\n\r\n        // Apply date range filter if provided\r\n        if (filters.startDate) {\r\n          sessionsQuery = sessionsQuery.gte('session_date', filters.startDate);\r\n        }\r\n        if (filters.endDate) {\r\n          sessionsQuery = sessionsQuery.lte('session_date', filters.endDate);\r\n        }\r\n\r\n        const { data: sessions } = await sessionsQuery.order('session_date', { ascending: false });\r\n\r\n        // Get attendance records\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id, session_id, created_at')\r\n          .eq('student_id', student.id)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const attendanceMap = new Map(\r\n          (attendance || []).map(a => [a.session_id, true])\r\n        );\r\n\r\n        // Create export records\r\n        for (const session of (sessions || [])) {\r\n          const classInfo = classes?.find(c => c.id === session.class_id);\r\n          exportData.push({\r\n            studentName: student.name,\r\n            studentId: student.matricule,\r\n            course: enrollment.courses?.course_code,\r\n            courseName: enrollment.courses?.course_title,\r\n            class: classInfo?.class_name || 'Unknown',\r\n            sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n            sessionTime: `${session.start_time} - ${session.end_time}`,\r\n            status: attendanceMap.has(session.id) ? 'Present' : 'Absent'\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return { data: exportData, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching export data:', error);\r\n    return { data: [], error: error.message };\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}