{"ast":null,"code":"import { supabase } from '../supabase/supabase';\n\n// ============================================\n// ADMIN DASHBOARD QUERIES\n// ============================================\n\nexport const adminFetchStats = async () => {\n  try {\n    const [{\n      count: studentCount,\n      error: studentError\n    }, {\n      count: delegateCount,\n      error: delegateError\n    }, {\n      count: courseCount,\n      error: courseError\n    }, {\n      count: classCount,\n      error: classError\n    }] = await Promise.all([supabase.from('users').select('id', {\n      count: 'exact'\n    }).eq('role', 'student'), supabase.from('users').select('id', {\n      count: 'exact'\n    }).eq('role', 'delegate'), supabase.from('courses').select('id', {\n      count: 'exact'\n    }), supabase.from('classes').select('id', {\n      count: 'exact'\n    })]);\n    const today = new Date().toISOString().split('T')[0];\n    const {\n      data: todaySessions,\n      error: sessionsError\n    } = await supabase.from('sessions').select('id').eq('session_date', today);\n    if (studentError || delegateError || courseError || classError || sessionsError) {\n      throw new Error('Failed to fetch stats');\n    }\n    return {\n      totalStudents: studentCount || 0,\n      totalDelegates: delegateCount || 0,\n      totalCourses: courseCount || 0,\n      totalClasses: classCount || 0,\n      sessionsToday: (todaySessions || []).length,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching admin stats:', error);\n    return {\n      totalStudents: 0,\n      totalDelegates: 0,\n      totalCourses: 0,\n      totalClasses: 0,\n      sessionsToday: 0,\n      error: error.message\n    };\n  }\n};\nexport const adminFetchOpenSessions = async () => {\n  try {\n    const now = new Date();\n    const {\n      data: sessions,\n      error\n    } = await supabase.from('sessions').select(`\n        id,\n        session_date,\n        start_time,\n        end_time,\n        token,\n        expires_at,\n        classes!inner (\n          id,\n          class_name,\n          delegate_id,\n          users!delegate_id (name),\n          courses!inner (course_code, course_title)\n        )\n      `).order('session_date', {\n      ascending: false\n    }).limit(20);\n    if (error) throw error;\n\n    // Filter for open sessions\n    const openSessions = (sessions || []).filter(s => new Date(s.expires_at) > now).map(session => {\n      var _session$classes, _session$classes$cour, _session$classes2, _session$classes2$cou, _session$classes3, _session$classes3$use, _session$token;\n      return {\n        id: session.id,\n        className: ((_session$classes = session.classes) === null || _session$classes === void 0 ? void 0 : (_session$classes$cour = _session$classes.courses) === null || _session$classes$cour === void 0 ? void 0 : _session$classes$cour.course_title) || 'Unknown',\n        courseCode: ((_session$classes2 = session.classes) === null || _session$classes2 === void 0 ? void 0 : (_session$classes2$cou = _session$classes2.courses) === null || _session$classes2$cou === void 0 ? void 0 : _session$classes2$cou.course_code) || 'N/A',\n        delegateName: ((_session$classes3 = session.classes) === null || _session$classes3 === void 0 ? void 0 : (_session$classes3$use = _session$classes3.users) === null || _session$classes3$use === void 0 ? void 0 : _session$classes3$use.name) || 'Unknown',\n        date: new Date(session.session_date).toLocaleDateString(),\n        startTime: session.start_time,\n        endTime: session.end_time,\n        status: 'Open',\n        tokenPreview: ((_session$token = session.token) === null || _session$token === void 0 ? void 0 : _session$token.slice(0, 8).toUpperCase()) || 'N/A'\n      };\n    });\n    return {\n      sessions: openSessions,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching open sessions:', error);\n    return {\n      sessions: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchCourseAttendance = async (limit = 10) => {\n  try {\n    const {\n      data: courses,\n      error\n    } = await supabase.from('courses').select('id, course_code, course_title').limit(limit);\n    if (error) throw error;\n    const courseStats = await Promise.all((courses || []).map(async course => {\n      const {\n        data: enrollments,\n        error: enrollError\n      } = await supabase.from('enrollments').select('id').eq('course_id', course.id);\n      const {\n        data: sessions,\n        error: sessionsError\n      } = await supabase.from('sessions').select('id', {\n        count: 'exact'\n      }).eq('classes.course_id', course.id);\n      const {\n        data: attendance\n      } = await supabase.from('attendance').select('id').in('session_id', (sessions || []).map(s => s.id));\n      const enrollmentCount = (enrollments || []).length;\n      const totalAttendance = (attendance || []).length;\n      const percentage = enrollmentCount > 0 ? Math.round(totalAttendance / enrollmentCount * 100) : 0;\n      return {\n        id: course.id,\n        courseCode: course.course_code,\n        courseTitle: course.course_title,\n        enrolledStudents: enrollmentCount,\n        totalAttendance,\n        attendancePercentage: percentage,\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\n      };\n    }));\n    return {\n      courseAttendance: courseStats,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching course attendance:', error);\n    return {\n      courseAttendance: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAttendanceAlerts = async () => {\n  try {\n    const threshold = 75; // 75% attendance threshold\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('student_id, course_id');\n    if (enrollError) throw enrollError;\n    const alerts = [];\n    for (const enrollment of enrollments || []) {\n      var _await$supabase$from$;\n      // Get sessions for this course\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id').in('class_id', ((_await$supabase$from$ = (await supabase.from('classes').select('id').eq('course_id', enrollment.course_id)).data) === null || _await$supabase$from$ === void 0 ? void 0 : _await$supabase$from$.map(c => c.id)) || []);\n\n      // Count attendance for this student in these sessions\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('student_id', enrollment.student_id).in('session_id', (sessions || []).map(s => s.id));\n      const percentage = ((sessions === null || sessions === void 0 ? void 0 : sessions.length) || 0) > 0 ? attendanceCount / sessions.length * 100 : 0;\n      if (percentage < threshold) {\n        const {\n          data: student\n        } = await supabase.from('users').select('name, matricule').eq('id', enrollment.student_id).single();\n        const {\n          data: course\n        } = await supabase.from('courses').select('course_title, course_code').eq('id', enrollment.course_id).single();\n        alerts.push({\n          type: 'low-attendance',\n          severity: percentage < 60 ? 'critical' : 'warning',\n          studentName: (student === null || student === void 0 ? void 0 : student.name) || 'Unknown',\n          studentId: enrollment.student_id,\n          courseTitle: (course === null || course === void 0 ? void 0 : course.course_title) || 'Unknown',\n          courseCode: (course === null || course === void 0 ? void 0 : course.course_code) || 'N/A',\n          attendance: `${Math.round(percentage)}%`,\n          message: `${(student === null || student === void 0 ? void 0 : student.name) || 'Student'} has ${Math.round(percentage)}% attendance in ${(course === null || course === void 0 ? void 0 : course.course_title) || 'Course'}`\n        });\n      }\n    }\n\n    // Check for expired sessions\n    const {\n      data: expiredSessions\n    } = await supabase.from('sessions').select('id, expires_at, classes!inner(class_name)').lt('expires_at', new Date().toISOString());\n    (expiredSessions || []).forEach(session => {\n      var _session$classes4;\n      alerts.push({\n        type: 'expired-session',\n        severity: 'warning',\n        message: `Session for ${((_session$classes4 = session.classes) === null || _session$classes4 === void 0 ? void 0 : _session$classes4.class_name) || 'Class'} was left open beyond allowed time`,\n        sessionId: session.id\n      });\n    });\n    return {\n      alerts,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching alerts:', error);\n    return {\n      alerts: [],\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// DELEGATE DASHBOARD QUERIES\n// ============================================\n\nexport const delegateFetchAssignedClasses = async delegateId => {\n  try {\n    const {\n      data: classes,\n      error\n    } = await supabase.from('classes').select(`\n        id,\n        class_name,\n        course_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title,\n          program,\n          year_level\n        )\n      `).eq('delegate_id', delegateId);\n    if (error) throw error;\n    const classesWithSessions = await Promise.all((classes || []).map(async cls => {\n      var _cls$courses, _cls$courses2, _cls$courses3, _cls$courses4;\n      const today = new Date().toISOString().split('T')[0];\n      const {\n        data: todaySession\n      } = await supabase.from('sessions').select('id, status, start_time, end_time').eq('class_id', cls.id).eq('session_date', today).limit(1);\n      return {\n        id: cls.id,\n        className: cls.class_name,\n        courseCode: (_cls$courses = cls.courses) === null || _cls$courses === void 0 ? void 0 : _cls$courses.course_code,\n        courseTitle: (_cls$courses2 = cls.courses) === null || _cls$courses2 === void 0 ? void 0 : _cls$courses2.course_title,\n        program: (_cls$courses3 = cls.courses) === null || _cls$courses3 === void 0 ? void 0 : _cls$courses3.program,\n        yearLevel: (_cls$courses4 = cls.courses) === null || _cls$courses4 === void 0 ? void 0 : _cls$courses4.year_level,\n        sessionToday: (todaySession || []).length > 0 ? 'Open' : 'None',\n        hasActiveSession: (todaySession || []).length > 0\n      };\n    }));\n    return {\n      classes: classesWithSessions,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching assigned classes:', error);\n    return {\n      classes: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchSessions = async delegateId => {\n  try {\n    // Fetch ALL sessions (not just for delegate's classes) so delegates can see admin-created sessions\n    const {\n      data: sessions,\n      error\n    } = await supabase.from('sessions').select(`\n        id,\n        session_date,\n        start_time,\n        end_time,\n        token,\n        expires_at,\n        classes!inner (\n          id,\n          class_name,\n          delegate_id,\n          courses!inner (course_code, course_title),\n          users!delegate_id (name)\n        )\n      `).order('session_date', {\n      ascending: false\n    }).limit(50);\n    if (error) throw error;\n    const enrichedSessions = await Promise.all((sessions || []).map(async session => {\n      var _session$classes5, _session$classes6, _session$classes6$cou, _session$classes7, _session$classes7$cou, _session$classes8, _session$classes8$use, _session$classes9;\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('session_id', session.id);\n      return {\n        id: session.id,\n        className: (_session$classes5 = session.classes) === null || _session$classes5 === void 0 ? void 0 : _session$classes5.class_name,\n        courseTitle: (_session$classes6 = session.classes) === null || _session$classes6 === void 0 ? void 0 : (_session$classes6$cou = _session$classes6.courses) === null || _session$classes6$cou === void 0 ? void 0 : _session$classes6$cou.course_title,\n        courseCode: (_session$classes7 = session.classes) === null || _session$classes7 === void 0 ? void 0 : (_session$classes7$cou = _session$classes7.courses) === null || _session$classes7$cou === void 0 ? void 0 : _session$classes7$cou.course_code,\n        delegateName: ((_session$classes8 = session.classes) === null || _session$classes8 === void 0 ? void 0 : (_session$classes8$use = _session$classes8.users) === null || _session$classes8$use === void 0 ? void 0 : _session$classes8$use.name) || 'Admin',\n        date: new Date(session.session_date).toLocaleDateString(),\n        startTime: session.start_time,\n        endTime: session.end_time,\n        status: new Date(session.expires_at) > new Date() ? 'Open' : 'Closed',\n        attendanceCount: attendanceCount || 0,\n        token: session.token,\n        isOwnClass: ((_session$classes9 = session.classes) === null || _session$classes9 === void 0 ? void 0 : _session$classes9.delegate_id) === delegateId\n      };\n    }));\n    return {\n      sessions: enrichedSessions,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching sessions:', error);\n    return {\n      sessions: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchSessionAttendance = async sessionId => {\n  try {\n    const {\n      data: attendance,\n      error\n    } = await supabase.from('attendance').select(`\n        id,\n        created_at,\n        users!student_id (\n          id,\n          name,\n          matricule\n        )\n      `).eq('session_id', sessionId);\n    if (error) throw error;\n    return {\n      attendance: (attendance || []).map(a => {\n        var _a$users, _a$users2;\n        return {\n          id: a.id,\n          studentName: (_a$users = a.users) === null || _a$users === void 0 ? void 0 : _a$users.name,\n          studentMatricule: (_a$users2 = a.users) === null || _a$users2 === void 0 ? void 0 : _a$users2.matricule,\n          timestamp: new Date(a.created_at).toLocaleTimeString(),\n          status: 'Present'\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching session attendance:', error);\n    return {\n      attendance: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchStats = async delegateId => {\n  try {\n    // Get stats for delegate's own classes\n    const {\n      data: classes\n    } = await supabase.from('classes').select('id').eq('delegate_id', delegateId);\n    const classIds = (classes || []).map(c => c.id);\n    const {\n      data: ownSessions\n    } = await supabase.from('sessions').select('id, expires_at').in('class_id', classIds);\n    const now = new Date();\n    const activeSessions = (ownSessions || []).filter(s => new Date(s.expires_at) > now);\n    const {\n      count: totalAttendance\n    } = await supabase.from('attendance').select('id', {\n      count: 'exact'\n    }).in('session_id', (ownSessions || []).map(s => s.id));\n    const today = new Date().toISOString().split('T')[0];\n    const {\n      data: todaySessions\n    } = await supabase.from('sessions').select('id').in('class_id', classIds).eq('session_date', today);\n    return {\n      activeSessions: activeSessions.length,\n      totalSessions: (ownSessions === null || ownSessions === void 0 ? void 0 : ownSessions.length) || 0,\n      totalMarked: totalAttendance || 0,\n      todaySessions: (todaySessions || []).length,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching delegate stats:', error);\n    return {\n      activeSessions: 0,\n      totalSessions: 0,\n      totalMarked: 0,\n      todaySessions: 0,\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// STUDENT DASHBOARD QUERIES\n// ============================================\n\nexport const studentFetchEnrolledCourses = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error\n    } = await supabase.from('enrollments').select(`\n        id,\n        course_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title,\n          program,\n          year_level\n        )\n      `).eq('student_id', studentId);\n    if (error) throw error;\n    return {\n      courses: (enrollments || []).map(e => {\n        var _e$courses, _e$courses2, _e$courses3, _e$courses4, _e$courses5;\n        return {\n          id: (_e$courses = e.courses) === null || _e$courses === void 0 ? void 0 : _e$courses.id,\n          courseCode: (_e$courses2 = e.courses) === null || _e$courses2 === void 0 ? void 0 : _e$courses2.course_code,\n          courseTitle: (_e$courses3 = e.courses) === null || _e$courses3 === void 0 ? void 0 : _e$courses3.course_title,\n          program: (_e$courses4 = e.courses) === null || _e$courses4 === void 0 ? void 0 : _e$courses4.program,\n          yearLevel: (_e$courses5 = e.courses) === null || _e$courses5 === void 0 ? void 0 : _e$courses5.year_level,\n          enrollmentId: e.id\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching enrolled courses:', error);\n    return {\n      courses: [],\n      error: error.message\n    };\n  }\n};\nexport const studentFetchActiveSessions = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('course_id').eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const courseIds = (enrollments || []).map(e => e.course_id);\n    const {\n      data: classes\n    } = await supabase.from('classes').select('id').in('course_id', courseIds);\n    const classIds = (classes || []).map(c => c.id);\n    const now = new Date();\n    const {\n      data: sessions,\n      error: sessionError\n    } = await supabase.from('sessions').select(`\n        id,\n        session_date,\n        start_time,\n        end_time,\n        expires_at,\n        token,\n        classes!inner (\n          id,\n          class_name,\n          delegate_id,\n          users!delegate_id (name),\n          courses!inner (course_code, course_title)\n        )\n      `).in('class_id', classIds).gt('expires_at', now.toISOString());\n    if (sessionError) throw sessionError;\n\n    // Check which sessions student has already marked\n    const {\n      data: studentAttendance\n    } = await supabase.from('attendance').select('session_id').eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n    const markedSessionIds = (studentAttendance || []).map(a => a.session_id);\n    return {\n      sessions: (sessions || []).map(s => {\n        var _s$classes, _s$classes$courses, _s$classes2, _s$classes2$courses, _s$classes3, _s$classes4, _s$classes4$users;\n        return {\n          id: s.id,\n          courseCode: (_s$classes = s.classes) === null || _s$classes === void 0 ? void 0 : (_s$classes$courses = _s$classes.courses) === null || _s$classes$courses === void 0 ? void 0 : _s$classes$courses.course_code,\n          courseTitle: (_s$classes2 = s.classes) === null || _s$classes2 === void 0 ? void 0 : (_s$classes2$courses = _s$classes2.courses) === null || _s$classes2$courses === void 0 ? void 0 : _s$classes2$courses.course_title,\n          className: (_s$classes3 = s.classes) === null || _s$classes3 === void 0 ? void 0 : _s$classes3.class_name,\n          delegateName: (_s$classes4 = s.classes) === null || _s$classes4 === void 0 ? void 0 : (_s$classes4$users = _s$classes4.users) === null || _s$classes4$users === void 0 ? void 0 : _s$classes4$users.name,\n          date: new Date(s.session_date).toLocaleDateString(),\n          startTime: s.start_time,\n          endTime: s.end_time,\n          token: s.token,\n          isMarked: markedSessionIds.includes(s.id),\n          status: 'Open'\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching active sessions:', error);\n    return {\n      sessions: [],\n      error: error.message\n    };\n  }\n};\nexport const studentFetchAttendanceSummary = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('course_id').eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const courseIds = (enrollments || []).map(e => e.course_id);\n    const {\n      data: classes\n    } = await supabase.from('classes').select('id').in('course_id', courseIds);\n    const classIds = (classes || []).map(c => c.id);\n    const {\n      data: sessions\n    } = await supabase.from('sessions').select('id').in('class_id', classIds);\n    const {\n      data: attendance\n    } = await supabase.from('attendance').select('id').eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n    const totalSessions = (sessions || []).length;\n    const totalAttended = (attendance || []).length;\n    const percentage = totalSessions > 0 ? Math.round(totalAttended / totalSessions * 100) : 0;\n    return {\n      summary: {\n        totalSessions,\n        totalAttended,\n        attendancePercentage: percentage,\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\n      },\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching attendance summary:', error);\n    return {\n      summary: {\n        totalSessions: 0,\n        totalAttended: 0,\n        attendancePercentage: 0,\n        status: 'Unknown'\n      },\n      error: error.message\n    };\n  }\n};\nexport const studentFetchCourseAttendance = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select(`\n        course_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title\n        )\n      `).eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const courseAttendance = await Promise.all((enrollments || []).map(async enrollment => {\n      var _enrollment$courses, _enrollment$courses2;\n      const {\n        data: classes\n      } = await supabase.from('classes').select('id').eq('course_id', enrollment.course_id);\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id').in('class_id', (classes || []).map(c => c.id));\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n      const totalSessions = (sessions || []).length;\n      const percentage = totalSessions > 0 ? Math.round(attendanceCount / totalSessions * 100) : 0;\n      return {\n        courseCode: (_enrollment$courses = enrollment.courses) === null || _enrollment$courses === void 0 ? void 0 : _enrollment$courses.course_code,\n        courseTitle: (_enrollment$courses2 = enrollment.courses) === null || _enrollment$courses2 === void 0 ? void 0 : _enrollment$courses2.course_title,\n        courseId: enrollment.course_id,\n        totalSessions,\n        attended: attendanceCount || 0,\n        attendancePercentage: percentage,\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\n      };\n    }));\n    return {\n      courseAttendance,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching course attendance:', error);\n    return {\n      courseAttendance: [],\n      error: error.message\n    };\n  }\n};\nexport const studentFetchAlerts = async studentId => {\n  try {\n    const alerts = [];\n    const threshold = 75;\n    const {\n      data: enrollments\n    } = await supabase.from('enrollments').select(`\n        course_id,\n        courses!inner (course_code, course_title)\n      `).eq('student_id', studentId);\n    for (const enrollment of enrollments || []) {\n      const {\n        data: classes\n      } = await supabase.from('classes').select('id').eq('course_id', enrollment.course_id);\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id').in('class_id', (classes || []).map(c => c.id));\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n      const percentage = ((sessions === null || sessions === void 0 ? void 0 : sessions.length) || 0) > 0 ? attendanceCount / sessions.length * 100 : 0;\n      if (percentage < threshold) {\n        var _enrollment$courses3, _enrollment$courses4, _enrollment$courses5;\n        alerts.push({\n          type: 'low-attendance',\n          severity: percentage < 60 ? 'critical' : 'warning',\n          message: `Your attendance in ${(_enrollment$courses3 = enrollment.courses) === null || _enrollment$courses3 === void 0 ? void 0 : _enrollment$courses3.course_title} is ${Math.round(percentage)}%. You may face academic penalties.`,\n          courseTitle: (_enrollment$courses4 = enrollment.courses) === null || _enrollment$courses4 === void 0 ? void 0 : _enrollment$courses4.course_title,\n          courseCode: (_enrollment$courses5 = enrollment.courses) === null || _enrollment$courses5 === void 0 ? void 0 : _enrollment$courses5.course_code,\n          percentage: Math.round(percentage)\n        });\n      }\n    }\n    return {\n      alerts,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching alerts:', error);\n    return {\n      alerts: [],\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// COURSE MANAGEMENT\n// ============================================\n\nexport const createCourse = async courseData => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('courses').insert({\n      course_code: courseData.courseCode,\n      course_title: courseData.courseTitle,\n      program: courseData.program,\n      year_level: courseData.yearLevel,\n      instructor: courseData.instructor,\n      course_status: 'scheduled'\n    }).select();\n    if (error) throw error;\n    return {\n      course: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error creating course:', error);\n    return {\n      course: null,\n      error: error.message\n    };\n  }\n};\nexport const createDelegate = async delegateData => {\n  try {\n    // NOTE: Creating delegates requires admin privileges to create auth users first.\n    // This is a limitation when using client-side Supabase without service role.\n    // For production, this should be done server-side or with proper auth setup.\n\n    alert('Creating delegates requires admin setup. Please use the setup script or contact administrator to add delegates.');\n    return {\n      delegate: null,\n      error: 'Admin privileges required for user creation'\n    };\n  } catch (error) {\n    console.error('Error creating delegate:', error);\n    return {\n      delegate: null,\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllClasses = async () => {\n  try {\n    const {\n      data: classes,\n      error\n    } = await supabase.from('classes').select(`\n        id,\n        class_name,\n        delegate_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title\n        ),\n        users!delegate_id (\n          id,\n          name\n        )\n      `);\n    if (error) throw error;\n    return {\n      classes: (classes || []).map(cls => {\n        var _cls$courses5, _cls$courses6, _cls$users;\n        return {\n          id: cls.id,\n          className: cls.class_name,\n          courseCode: (_cls$courses5 = cls.courses) === null || _cls$courses5 === void 0 ? void 0 : _cls$courses5.course_code,\n          courseTitle: (_cls$courses6 = cls.courses) === null || _cls$courses6 === void 0 ? void 0 : _cls$courses6.course_title,\n          delegateId: cls.delegate_id,\n          delegateName: (_cls$users = cls.users) === null || _cls$users === void 0 ? void 0 : _cls$users.name\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all classes:', error);\n    return {\n      classes: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllStudents = async () => {\n  try {\n    const {\n      data: students,\n      error\n    } = await supabase.from('users').select('id, name, matricule').eq('role', 'student');\n    if (error) throw error;\n    return {\n      students: (students || []).map(student => ({\n        id: student.id,\n        name: student.name,\n        matricule: student.matricule\n      })),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all students:', error);\n    return {\n      students: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllCourses = async () => {\n  try {\n    const {\n      data: courses,\n      error\n    } = await supabase.from('courses').select('id, course_code, course_title, program, year_level');\n    if (error) throw error;\n    return {\n      courses: (courses || []).map(course => ({\n        id: course.id,\n        courseCode: course.course_code,\n        courseTitle: course.course_title,\n        program: course.program,\n        yearLevel: course.year_level\n      })),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all courses:', error);\n    return {\n      courses: [],\n      error: error.message\n    };\n  }\n};\nexport const promoteStudentToDelegate = async studentId => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('users').update({\n      role: 'delegate'\n    }).eq('id', studentId).select();\n    if (error) throw error;\n    return {\n      delegate: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error promoting student to delegate:', error);\n    return {\n      delegate: null,\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// SESSION MANAGEMENT\n// ============================================\n\nexport const createSession = async (delegateId, classId, sessionDate, startTime, endTime) => {\n  try {\n    // Generate a unique token\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n\n    // Calculate expires_at (30 minutes after end time)\n    const [endHour, endMin] = endTime.split(':');\n    const expiresAt = new Date(sessionDate);\n    expiresAt.setHours(parseInt(endHour) + 1, parseInt(endMin), 0);\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').insert({\n      class_id: classId,\n      session_date: sessionDate,\n      start_time: startTime,\n      end_time: endTime,\n      token,\n      expires_at: expiresAt.toISOString()\n    }).select();\n    if (error) throw error;\n    return {\n      session: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error creating session:', error);\n    return {\n      session: null,\n      error: error.message\n    };\n  }\n};\nexport const markAttendance = async (studentId, sessionId) => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('attendance').insert({\n      student_id: studentId,\n      session_id: sessionId\n    }).select();\n    if (error) throw error;\n    return {\n      success: true,\n      attendance: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error marking attendance:', error);\n    return {\n      success: false,\n      attendance: null,\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// ATTENDANCE HISTORY & EXPORT QUERIES\n// ============================================\n\nexport const studentFetchAttendanceHistory = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const history = [];\n    for (const enrollment of enrollments || []) {\n      var _enrollment$courses6, _enrollment$courses7;\n      const courseId = enrollment.course_id;\n      const courseName = ((_enrollment$courses6 = enrollment.courses) === null || _enrollment$courses6 === void 0 ? void 0 : _enrollment$courses6.course_title) || '';\n      const courseCode = ((_enrollment$courses7 = enrollment.courses) === null || _enrollment$courses7 === void 0 ? void 0 : _enrollment$courses7.course_code) || '';\n\n      // Get classes for this course\n      const {\n        data: classes\n      } = await supabase.from('classes').select('id, class_name').eq('course_id', courseId);\n      const classIds = (classes || []).map(c => c.id);\n\n      // Get all sessions for these classes\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id', classIds).order('session_date', {\n        ascending: false\n      });\n\n      // Get attendance records for this student in these sessions\n      const {\n        data: attendance\n      } = await supabase.from('attendance').select('id, session_id, created_at').eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n      const attendanceMap = new Set((attendance || []).map(a => a.session_id));\n\n      // Create history records\n      for (const session of sessions || []) {\n        const classInfo = classes === null || classes === void 0 ? void 0 : classes.find(c => c.id === session.class_id);\n        history.push({\n          courseCode,\n          courseName,\n          className: (classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name) || 'Unknown',\n          sessionDate: new Date(session.session_date).toLocaleDateString(),\n          startTime: session.start_time,\n          endTime: session.end_time,\n          status: attendanceMap.has(session.id) ? 'Present' : 'Absent',\n          sessionId: session.id\n        });\n      }\n    }\n\n    // Calculate per-course statistics\n    const courseStats = {};\n    for (const record of history) {\n      if (!courseStats[record.courseCode]) {\n        courseStats[record.courseCode] = {\n          courseCode: record.courseCode,\n          courseName: record.courseName,\n          totalSessions: 0,\n          attended: 0,\n          percentage: 0\n        };\n      }\n      courseStats[record.courseCode].totalSessions++;\n      if (record.status === 'Present') {\n        courseStats[record.courseCode].attended++;\n      }\n    }\n\n    // Calculate percentages\n    for (const key in courseStats) {\n      const stat = courseStats[key];\n      stat.percentage = stat.totalSessions > 0 ? Math.round(stat.attended / stat.totalSessions * 100) : 0;\n    }\n    return {\n      history: history.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate)),\n      courseStats: Object.values(courseStats),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching attendance history:', error);\n    return {\n      history: [],\n      courseStats: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAttendanceExportData = async (filters = {}) => {\n  try {\n    // Fetch all students\n    const {\n      data: students,\n      error: studentError\n    } = await supabase.from('users').select('id, name, matricule').eq('role', 'student');\n    if (studentError) throw studentError;\n    const exportData = [];\n    for (const student of students || []) {\n      // Get student's enrollments\n      const {\n        data: enrollments\n      } = await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id', student.id);\n      for (const enrollment of enrollments || []) {\n        var _enrollment$courses8;\n        // Apply course filter if provided\n        if (filters.courseCode && ((_enrollment$courses8 = enrollment.courses) === null || _enrollment$courses8 === void 0 ? void 0 : _enrollment$courses8.course_code) !== filters.courseCode) {\n          continue;\n        }\n        const courseId = enrollment.course_id;\n\n        // Get classes for this course\n        const {\n          data: classes\n        } = await supabase.from('classes').select('id, class_name').eq('course_id', courseId);\n        const classIds = (classes || []).map(c => c.id);\n\n        // Get sessions\n        let sessionsQuery = supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id', classIds);\n\n        // Apply date range filter if provided\n        if (filters.startDate) {\n          sessionsQuery = sessionsQuery.gte('session_date', filters.startDate);\n        }\n        if (filters.endDate) {\n          sessionsQuery = sessionsQuery.lte('session_date', filters.endDate);\n        }\n        const {\n          data: sessions\n        } = await sessionsQuery.order('session_date', {\n          ascending: false\n        });\n\n        // Get attendance records\n        const {\n          data: attendance\n        } = await supabase.from('attendance').select('id, session_id, created_at').eq('student_id', student.id).in('session_id', (sessions || []).map(s => s.id));\n        const attendanceMap = new Map((attendance || []).map(a => [a.session_id, true]));\n\n        // Create export records\n        for (const session of sessions || []) {\n          var _enrollment$courses9, _enrollment$courses0;\n          const classInfo = classes === null || classes === void 0 ? void 0 : classes.find(c => c.id === session.class_id);\n          exportData.push({\n            studentName: student.name,\n            studentId: student.matricule,\n            course: (_enrollment$courses9 = enrollment.courses) === null || _enrollment$courses9 === void 0 ? void 0 : _enrollment$courses9.course_code,\n            courseName: (_enrollment$courses0 = enrollment.courses) === null || _enrollment$courses0 === void 0 ? void 0 : _enrollment$courses0.course_title,\n            class: (classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name) || 'Unknown',\n            sessionDate: new Date(session.session_date).toLocaleDateString(),\n            sessionTime: `${session.start_time} - ${session.end_time}`,\n            status: attendanceMap.has(session.id) ? 'Present' : 'Absent'\n          });\n        }\n      }\n    }\n    return {\n      data: exportData,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching export data:', error);\n    return {\n      data: [],\n      error: error.message\n    };\n  }\n};","map":{"version":3,"names":["supabase","adminFetchStats","count","studentCount","error","studentError","delegateCount","delegateError","courseCount","courseError","classCount","classError","Promise","all","from","select","eq","today","Date","toISOString","split","data","todaySessions","sessionsError","Error","totalStudents","totalDelegates","totalCourses","totalClasses","sessionsToday","length","console","message","adminFetchOpenSessions","now","sessions","order","ascending","limit","openSessions","filter","s","expires_at","map","session","_session$classes","_session$classes$cour","_session$classes2","_session$classes2$cou","_session$classes3","_session$classes3$use","_session$token","id","className","classes","courses","course_title","courseCode","course_code","delegateName","users","name","date","session_date","toLocaleDateString","startTime","start_time","endTime","end_time","status","tokenPreview","token","slice","toUpperCase","adminFetchCourseAttendance","courseStats","course","enrollments","enrollError","attendance","in","enrollmentCount","totalAttendance","percentage","Math","round","courseTitle","enrolledStudents","attendancePercentage","courseAttendance","adminFetchAttendanceAlerts","threshold","alerts","enrollment","_await$supabase$from$","course_id","c","attendanceCount","student_id","student","single","push","type","severity","studentName","studentId","expiredSessions","lt","forEach","_session$classes4","class_name","sessionId","delegateFetchAssignedClasses","delegateId","classesWithSessions","cls","_cls$courses","_cls$courses2","_cls$courses3","_cls$courses4","todaySession","program","yearLevel","year_level","sessionToday","hasActiveSession","delegateFetchSessions","enrichedSessions","_session$classes5","_session$classes6","_session$classes6$cou","_session$classes7","_session$classes7$cou","_session$classes8","_session$classes8$use","_session$classes9","isOwnClass","delegate_id","delegateFetchSessionAttendance","a","_a$users","_a$users2","studentMatricule","matricule","timestamp","created_at","toLocaleTimeString","delegateFetchStats","classIds","ownSessions","activeSessions","totalSessions","totalMarked","studentFetchEnrolledCourses","e","_e$courses","_e$courses2","_e$courses3","_e$courses4","_e$courses5","enrollmentId","studentFetchActiveSessions","courseIds","sessionError","gt","studentAttendance","markedSessionIds","session_id","_s$classes","_s$classes$courses","_s$classes2","_s$classes2$courses","_s$classes3","_s$classes4","_s$classes4$users","isMarked","includes","studentFetchAttendanceSummary","totalAttended","summary","studentFetchCourseAttendance","_enrollment$courses","_enrollment$courses2","courseId","attended","studentFetchAlerts","_enrollment$courses3","_enrollment$courses4","_enrollment$courses5","createCourse","courseData","insert","instructor","course_status","createDelegate","delegateData","alert","delegate","adminFetchAllClasses","_cls$courses5","_cls$courses6","_cls$users","adminFetchAllStudents","students","adminFetchAllCourses","promoteStudentToDelegate","update","role","createSession","classId","sessionDate","random","toString","substring","endHour","endMin","expiresAt","setHours","parseInt","class_id","markAttendance","success","studentFetchAttendanceHistory","history","_enrollment$courses6","_enrollment$courses7","courseName","attendanceMap","Set","classInfo","find","has","record","key","stat","sort","b","Object","values","adminFetchAttendanceExportData","filters","exportData","_enrollment$courses8","sessionsQuery","startDate","gte","endDate","lte","Map","_enrollment$courses9","_enrollment$courses0","class","sessionTime"],"sources":["C:/Users/PFI/Desktop/ictuattennce_portal/ATTENDANCE/src/utils/dashboardQueries.js"],"sourcesContent":["import { supabase } from '../supabase/supabase';\r\n\r\n// ============================================\r\n// ADMIN DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const adminFetchStats = async () => {\r\n  try {\r\n    const [\r\n      { count: studentCount, error: studentError },\r\n      { count: delegateCount, error: delegateError },\r\n      { count: courseCount, error: courseError },\r\n      { count: classCount, error: classError }\r\n    ] = await Promise.all([\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'student'),\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'delegate'),\r\n      supabase\r\n        .from('courses')\r\n        .select('id', { count: 'exact' }),\r\n      supabase\r\n        .from('classes')\r\n        .select('id', { count: 'exact' })\r\n    ]);\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions, error: sessionsError } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .eq('session_date', today);\r\n\r\n    if (studentError || delegateError || courseError || classError || sessionsError) {\r\n      throw new Error('Failed to fetch stats');\r\n    }\r\n\r\n    return {\r\n      totalStudents: studentCount || 0,\r\n      totalDelegates: delegateCount || 0,\r\n      totalCourses: courseCount || 0,\r\n      totalClasses: classCount || 0,\r\n      sessionsToday: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching admin stats:', error);\r\n    return {\r\n      totalStudents: 0,\r\n      totalDelegates: 0,\r\n      totalCourses: 0,\r\n      totalClasses: 0,\r\n      sessionsToday: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const adminFetchOpenSessions = async () => {\r\n  try {\r\n    const now = new Date();\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(20);\r\n\r\n    if (error) throw error;\r\n\r\n    // Filter for open sessions\r\n    const openSessions = (sessions || [])\r\n      .filter(s => new Date(s.expires_at) > now)\r\n      .map(session => ({\r\n        id: session.id,\r\n        className: session.classes?.courses?.course_title || 'Unknown',\r\n        courseCode: session.classes?.courses?.course_code || 'N/A',\r\n        delegateName: session.classes?.users?.name || 'Unknown',\r\n        date: new Date(session.session_date).toLocaleDateString(),\r\n        startTime: session.start_time,\r\n        endTime: session.end_time,\r\n        status: 'Open',\r\n        tokenPreview: session.token?.slice(0, 8).toUpperCase() || 'N/A'\r\n      }));\r\n\r\n    return { sessions: openSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching open sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchCourseAttendance = async (limit = 10) => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title')\r\n      .limit(limit);\r\n\r\n    if (error) throw error;\r\n\r\n    const courseStats = await Promise.all(\r\n      (courses || []).map(async (course) => {\r\n        const { data: enrollments, error: enrollError } = await supabase\r\n          .from('enrollments')\r\n          .select('id')\r\n          .eq('course_id', course.id);\r\n\r\n        const { data: sessions, error: sessionsError } = await supabase\r\n          .from('sessions')\r\n          .select('id', { count: 'exact' })\r\n          .eq('classes.course_id', course.id);\r\n\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id')\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const enrollmentCount = (enrollments || []).length;\r\n        const totalAttendance = (attendance || []).length;\r\n        const percentage = enrollmentCount > 0 ? Math.round((totalAttendance / enrollmentCount) * 100) : 0;\r\n\r\n        return {\r\n          id: course.id,\r\n          courseCode: course.course_code,\r\n          courseTitle: course.course_title,\r\n          enrolledStudents: enrollmentCount,\r\n          totalAttendance,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance: courseStats, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceAlerts = async () => {\r\n  try {\r\n    const threshold = 75; // 75% attendance threshold\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('student_id, course_id');\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const alerts = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      // Get sessions for this course\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (\r\n          await supabase\r\n            .from('classes')\r\n            .select('id')\r\n            .eq('course_id', enrollment.course_id)\r\n        ).data?.map(c => c.id) || []);\r\n\r\n      // Count attendance for this student in these sessions\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', enrollment.student_id)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        const { data: student } = await supabase\r\n          .from('users')\r\n          .select('name, matricule')\r\n          .eq('id', enrollment.student_id)\r\n          .single();\r\n\r\n        const { data: course } = await supabase\r\n          .from('courses')\r\n          .select('course_title, course_code')\r\n          .eq('id', enrollment.course_id)\r\n          .single();\r\n\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          studentName: student?.name || 'Unknown',\r\n          studentId: enrollment.student_id,\r\n          courseTitle: course?.course_title || 'Unknown',\r\n          courseCode: course?.course_code || 'N/A',\r\n          attendance: `${Math.round(percentage)}%`,\r\n          message: `${student?.name || 'Student'} has ${Math.round(percentage)}% attendance in ${course?.course_title || 'Course'}`\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check for expired sessions\r\n    const { data: expiredSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at, classes!inner(class_name)')\r\n      .lt('expires_at', new Date().toISOString());\r\n\r\n    (expiredSessions || []).forEach(session => {\r\n      alerts.push({\r\n        type: 'expired-session',\r\n        severity: 'warning',\r\n        message: `Session for ${session.classes?.class_name || 'Class'} was left open beyond allowed time`,\r\n        sessionId: session.id\r\n      });\r\n    });\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// DELEGATE DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const delegateFetchAssignedClasses = async (delegateId) => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('delegate_id', delegateId);\r\n\r\n    if (error) throw error;\r\n\r\n    const classesWithSessions = await Promise.all(\r\n      (classes || []).map(async (cls) => {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const { data: todaySession } = await supabase\r\n          .from('sessions')\r\n          .select('id, status, start_time, end_time')\r\n          .eq('class_id', cls.id)\r\n          .eq('session_date', today)\r\n          .limit(1);\r\n\r\n        return {\r\n          id: cls.id,\r\n          className: cls.class_name,\r\n          courseCode: cls.courses?.course_code,\r\n          courseTitle: cls.courses?.course_title,\r\n          program: cls.courses?.program,\r\n          yearLevel: cls.courses?.year_level,\r\n          sessionToday: (todaySession || []).length > 0 ? 'Open' : 'None',\r\n          hasActiveSession: (todaySession || []).length > 0\r\n        };\r\n      })\r\n    );\r\n\r\n    return { classes: classesWithSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching assigned classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessions = async (delegateId) => {\r\n  try {\r\n    // Fetch ALL sessions (not just for delegate's classes) so delegates can see admin-created sessions\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          courses!inner (course_code, course_title),\r\n          users!delegate_id (name)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(50);\r\n\r\n    if (error) throw error;\r\n\r\n    const enrichedSessions = await Promise.all(\r\n      (sessions || []).map(async (session) => {\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('session_id', session.id);\r\n\r\n        return {\r\n          id: session.id,\r\n          className: session.classes?.class_name,\r\n          courseTitle: session.classes?.courses?.course_title,\r\n          courseCode: session.classes?.courses?.course_code,\r\n          delegateName: session.classes?.users?.name || 'Admin',\r\n          date: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: new Date(session.expires_at) > new Date() ? 'Open' : 'Closed',\r\n          attendanceCount: attendanceCount || 0,\r\n          token: session.token,\r\n          isOwnClass: session.classes?.delegate_id === delegateId\r\n        };\r\n      })\r\n    );\r\n\r\n    return { sessions: enrichedSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessionAttendance = async (sessionId) => {\r\n  try {\r\n    const { data: attendance, error } = await supabase\r\n      .from('attendance')\r\n      .select(`\r\n        id,\r\n        created_at,\r\n        users!student_id (\r\n          id,\r\n          name,\r\n          matricule\r\n        )\r\n      `)\r\n      .eq('session_id', sessionId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      attendance: (attendance || []).map(a => ({\r\n        id: a.id,\r\n        studentName: a.users?.name,\r\n        studentMatricule: a.users?.matricule,\r\n        timestamp: new Date(a.created_at).toLocaleTimeString(),\r\n        status: 'Present'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching session attendance:', error);\r\n    return { attendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchStats = async (delegateId) => {\r\n  try {\r\n    // Get stats for delegate's own classes\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .eq('delegate_id', delegateId);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: ownSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at')\r\n      .in('class_id', classIds);\r\n\r\n    const now = new Date();\r\n    const activeSessions = (ownSessions || []).filter(s => new Date(s.expires_at) > now);\r\n\r\n    const { count: totalAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('id', { count: 'exact' })\r\n      .in('session_id', (ownSessions || []).map(s => s.id));\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds)\r\n      .eq('session_date', today);\r\n\r\n    return {\r\n      activeSessions: activeSessions.length,\r\n      totalSessions: ownSessions?.length || 0,\r\n      totalMarked: totalAttendance || 0,\r\n      todaySessions: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching delegate stats:', error);\r\n    return {\r\n      activeSessions: 0,\r\n      totalSessions: 0,\r\n      totalMarked: 0,\r\n      todaySessions: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// STUDENT DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchEnrolledCourses = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        id,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (enrollments || []).map(e => ({\r\n        id: e.courses?.id,\r\n        courseCode: e.courses?.course_code,\r\n        courseTitle: e.courses?.course_title,\r\n        program: e.courses?.program,\r\n        yearLevel: e.courses?.year_level,\r\n        enrollmentId: e.id\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching enrolled courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchActiveSessions = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n    const now = new Date();\r\n\r\n    const { data: sessions, error: sessionError } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        expires_at,\r\n        token,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .in('class_id', classIds)\r\n      .gt('expires_at', now.toISOString());\r\n\r\n    if (sessionError) throw sessionError;\r\n\r\n    // Check which sessions student has already marked\r\n    const { data: studentAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('session_id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const markedSessionIds = (studentAttendance || []).map(a => a.session_id);\r\n\r\n    return {\r\n      sessions: (sessions || []).map(s => ({\r\n        id: s.id,\r\n        courseCode: s.classes?.courses?.course_code,\r\n        courseTitle: s.classes?.courses?.course_title,\r\n        className: s.classes?.class_name,\r\n        delegateName: s.classes?.users?.name,\r\n        date: new Date(s.session_date).toLocaleDateString(),\r\n        startTime: s.start_time,\r\n        endTime: s.end_time,\r\n        token: s.token,\r\n        isMarked: markedSessionIds.includes(s.id),\r\n        status: 'Open'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching active sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAttendanceSummary = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: sessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds);\r\n\r\n    const { data: attendance } = await supabase\r\n      .from('attendance')\r\n      .select('id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const totalSessions = (sessions || []).length;\r\n    const totalAttended = (attendance || []).length;\r\n    const percentage = totalSessions > 0 ? Math.round((totalAttended / totalSessions) * 100) : 0;\r\n\r\n    return {\r\n      summary: {\r\n        totalSessions,\r\n        totalAttended,\r\n        attendancePercentage: percentage,\r\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n      },\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance summary:', error);\r\n    return {\r\n      summary: {\r\n        totalSessions: 0,\r\n        totalAttended: 0,\r\n        attendancePercentage: 0,\r\n        status: 'Unknown'\r\n      },\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const studentFetchCourseAttendance = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseAttendance = await Promise.all(\r\n      (enrollments || []).map(async (enrollment) => {\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id')\r\n          .eq('course_id', enrollment.course_id);\r\n\r\n        const { data: sessions } = await supabase\r\n          .from('sessions')\r\n          .select('id')\r\n          .in('class_id', (classes || []).map(c => c.id));\r\n\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('student_id', studentId)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const totalSessions = (sessions || []).length;\r\n        const percentage = totalSessions > 0 ? Math.round((attendanceCount / totalSessions) * 100) : 0;\r\n\r\n        return {\r\n          courseCode: enrollment.courses?.course_code,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseId: enrollment.course_id,\r\n          totalSessions,\r\n          attended: attendanceCount || 0,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAlerts = async (studentId) => {\r\n  try {\r\n    const alerts = [];\r\n    const threshold = 75;\r\n\r\n    const { data: enrollments } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (course_code, course_title)\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id')\r\n        .eq('course_id', enrollment.course_id);\r\n\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (classes || []).map(c => c.id));\r\n\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          message: `Your attendance in ${enrollment.courses?.course_title} is ${Math.round(percentage)}%. You may face academic penalties.`,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseCode: enrollment.courses?.course_code,\r\n          percentage: Math.round(percentage)\r\n        });\r\n      }\r\n    }\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// COURSE MANAGEMENT\r\n// ============================================\r\n\r\nexport const createCourse = async (courseData) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('courses')\r\n      .insert({\r\n        course_code: courseData.courseCode,\r\n        course_title: courseData.courseTitle,\r\n        program: courseData.program,\r\n        year_level: courseData.yearLevel,\r\n        instructor: courseData.instructor,\r\n        course_status: 'scheduled'\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { course: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating course:', error);\r\n    return { course: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const createDelegate = async (delegateData) => {\r\n  try {\r\n    // NOTE: Creating delegates requires admin privileges to create auth users first.\r\n    // This is a limitation when using client-side Supabase without service role.\r\n    // For production, this should be done server-side or with proper auth setup.\r\n\r\n    alert('Creating delegates requires admin setup. Please use the setup script or contact administrator to add delegates.');\r\n    return { delegate: null, error: 'Admin privileges required for user creation' };\r\n  } catch (error) {\r\n    console.error('Error creating delegate:', error);\r\n    return { delegate: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllClasses = async () => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        delegate_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        ),\r\n        users!delegate_id (\r\n          id,\r\n          name\r\n        )\r\n      `);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      classes: (classes || []).map(cls => ({\r\n        id: cls.id,\r\n        className: cls.class_name,\r\n        courseCode: cls.courses?.course_code,\r\n        courseTitle: cls.courses?.course_title,\r\n        delegateId: cls.delegate_id,\r\n        delegateName: cls.users?.name\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllStudents = async () => {\r\n  try {\r\n    const { data: students, error } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      students: (students || []).map(student => ({\r\n        id: student.id,\r\n        name: student.name,\r\n        matricule: student.matricule\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all students:', error);\r\n    return { students: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllCourses = async () => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title, program, year_level');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (courses || []).map(course => ({\r\n        id: course.id,\r\n        courseCode: course.course_code,\r\n        courseTitle: course.course_title,\r\n        program: course.program,\r\n        yearLevel: course.year_level\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const promoteStudentToDelegate = async (studentId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('users')\r\n      .update({ role: 'delegate' })\r\n      .eq('id', studentId)\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { delegate: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error promoting student to delegate:', error);\r\n    return { delegate: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// SESSION MANAGEMENT\r\n// ============================================\r\n\r\nexport const createSession = async (delegateId, classId, sessionDate, startTime, endTime) => {\r\n  try {\r\n    // Generate a unique token\r\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\r\n\r\n    // Calculate expires_at (30 minutes after end time)\r\n    const [endHour, endMin] = endTime.split(':');\r\n    const expiresAt = new Date(sessionDate);\r\n    expiresAt.setHours(parseInt(endHour) + 1, parseInt(endMin), 0);\r\n\r\n    const { data, error } = await supabase\r\n      .from('sessions')\r\n      .insert({\r\n        class_id: classId,\r\n        session_date: sessionDate,\r\n        start_time: startTime,\r\n        end_time: endTime,\r\n        token,\r\n        expires_at: expiresAt.toISOString()\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { session: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating session:', error);\r\n    return { session: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const markAttendance = async (studentId, sessionId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('attendance')\r\n      .insert({\r\n        student_id: studentId,\r\n        session_id: sessionId\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { success: true, attendance: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error marking attendance:', error);\r\n    return { success: false, attendance: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// ATTENDANCE HISTORY & EXPORT QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchAttendanceHistory = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id, courses!inner(id, course_code, course_title)')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const history = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const courseId = enrollment.course_id;\r\n      const courseName = enrollment.courses?.course_title || '';\r\n      const courseCode = enrollment.courses?.course_code || '';\r\n\r\n      // Get classes for this course\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id, class_name')\r\n        .eq('course_id', courseId);\r\n\r\n      const classIds = (classes || []).map(c => c.id);\r\n\r\n      // Get all sessions for these classes\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n        .in('class_id', classIds)\r\n        .order('session_date', { ascending: false });\r\n\r\n      // Get attendance records for this student in these sessions\r\n      const { data: attendance } = await supabase\r\n        .from('attendance')\r\n        .select('id, session_id, created_at')\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const attendanceMap = new Set((attendance || []).map(a => a.session_id));\r\n\r\n      // Create history records\r\n      for (const session of (sessions || [])) {\r\n        const classInfo = classes?.find(c => c.id === session.class_id);\r\n        history.push({\r\n          courseCode,\r\n          courseName,\r\n          className: classInfo?.class_name || 'Unknown',\r\n          sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: attendanceMap.has(session.id) ? 'Present' : 'Absent',\r\n          sessionId: session.id\r\n        });\r\n      }\r\n    }\r\n\r\n    // Calculate per-course statistics\r\n    const courseStats = {};\r\n    for (const record of history) {\r\n      if (!courseStats[record.courseCode]) {\r\n        courseStats[record.courseCode] = {\r\n          courseCode: record.courseCode,\r\n          courseName: record.courseName,\r\n          totalSessions: 0,\r\n          attended: 0,\r\n          percentage: 0\r\n        };\r\n      }\r\n      courseStats[record.courseCode].totalSessions++;\r\n      if (record.status === 'Present') {\r\n        courseStats[record.courseCode].attended++;\r\n      }\r\n    }\r\n\r\n    // Calculate percentages\r\n    for (const key in courseStats) {\r\n      const stat = courseStats[key];\r\n      stat.percentage = stat.totalSessions > 0\r\n        ? Math.round((stat.attended / stat.totalSessions) * 100)\r\n        : 0;\r\n    }\r\n\r\n    return {\r\n      history: history.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate)),\r\n      courseStats: Object.values(courseStats),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance history:', error);\r\n    return { history: [], courseStats: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceExportData = async (filters = {}) => {\r\n  try {\r\n    // Fetch all students\r\n    const { data: students, error: studentError } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (studentError) throw studentError;\r\n\r\n    const exportData = [];\r\n\r\n    for (const student of (students || [])) {\r\n      // Get student's enrollments\r\n      const { data: enrollments } = await supabase\r\n        .from('enrollments')\r\n        .select('course_id, courses!inner(id, course_code, course_title)')\r\n        .eq('student_id', student.id);\r\n\r\n      for (const enrollment of (enrollments || [])) {\r\n        // Apply course filter if provided\r\n        if (filters.courseCode && enrollment.courses?.course_code !== filters.courseCode) {\r\n          continue;\r\n        }\r\n\r\n        const courseId = enrollment.course_id;\r\n\r\n        // Get classes for this course\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id, class_name')\r\n          .eq('course_id', courseId);\r\n\r\n        const classIds = (classes || []).map(c => c.id);\r\n\r\n        // Get sessions\r\n        let sessionsQuery = supabase\r\n          .from('sessions')\r\n          .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n          .in('class_id', classIds);\r\n\r\n        // Apply date range filter if provided\r\n        if (filters.startDate) {\r\n          sessionsQuery = sessionsQuery.gte('session_date', filters.startDate);\r\n        }\r\n        if (filters.endDate) {\r\n          sessionsQuery = sessionsQuery.lte('session_date', filters.endDate);\r\n        }\r\n\r\n        const { data: sessions } = await sessionsQuery.order('session_date', { ascending: false });\r\n\r\n        // Get attendance records\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id, session_id, created_at')\r\n          .eq('student_id', student.id)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const attendanceMap = new Map(\r\n          (attendance || []).map(a => [a.session_id, true])\r\n        );\r\n\r\n        // Create export records\r\n        for (const session of (sessions || [])) {\r\n          const classInfo = classes?.find(c => c.id === session.class_id);\r\n          exportData.push({\r\n            studentName: student.name,\r\n            studentId: student.matricule,\r\n            course: enrollment.courses?.course_code,\r\n            courseName: enrollment.courses?.course_title,\r\n            class: classInfo?.class_name || 'Unknown',\r\n            sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n            sessionTime: `${session.start_time} - ${session.end_time}`,\r\n            status: attendanceMap.has(session.id) ? 'Present' : 'Absent'\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return { data: exportData, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching export data:', error);\r\n    return { data: [], error: error.message };\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}