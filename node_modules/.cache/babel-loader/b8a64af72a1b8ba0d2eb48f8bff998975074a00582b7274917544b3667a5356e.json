{"ast":null,"code":"import { supabase } from '../supabase/supabase';\n\n// ============================================\n// ADMIN DASHBOARD QUERIES\n// ============================================\n\nexport const adminFetchStats = async () => {\n  try {\n    const [{\n      count: studentCount,\n      error: studentError\n    }, {\n      count: delegateCount,\n      error: delegateError\n    }, {\n      count: courseCount,\n      error: courseError\n    }, {\n      count: classCount,\n      error: classError\n    }] = await Promise.all([supabase.from('users').select('id', {\n      count: 'exact'\n    }).eq('role', 'student'), supabase.from('users').select('id', {\n      count: 'exact'\n    }).eq('role', 'delegate'), supabase.from('courses').select('id', {\n      count: 'exact'\n    }), supabase.from('classes').select('id', {\n      count: 'exact'\n    })]);\n    const today = new Date().toISOString().split('T')[0];\n    const {\n      data: todaySessions,\n      error: sessionsError\n    } = await supabase.from('sessions').select('id').eq('session_date', today);\n    if (studentError || delegateError || courseError || classError || sessionsError) {\n      throw new Error('Failed to fetch stats');\n    }\n    return {\n      totalStudents: studentCount || 0,\n      totalDelegates: delegateCount || 0,\n      totalCourses: courseCount || 0,\n      totalClasses: classCount || 0,\n      sessionsToday: (todaySessions || []).length,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching admin stats:', error);\n    return {\n      totalStudents: 0,\n      totalDelegates: 0,\n      totalCourses: 0,\n      totalClasses: 0,\n      sessionsToday: 0,\n      error: error.message\n    };\n  }\n};\nexport const adminFetchOpenSessions = async () => {\n  try {\n    const {\n      data: sessions,\n      error\n    } = await supabase.from('sessions').select(`\n        id,\n        session_date,\n        start_time,\n        end_time,\n        token,\n        expires_at,\n        classes!inner (\n          id,\n          class_name,\n          delegate_id,\n          users!delegate_id (name),\n          courses!inner (course_code, course_title)\n        )\n      `).order('session_date', {\n      ascending: false\n    }).limit(20);\n    if (error) throw error;\n\n    // Return all sessions with calculated status\n    const allSessions = (sessions || []).map(session => {\n      var _session$classes, _session$classes$cour, _session$classes2, _session$classes2$cou, _session$classes3, _session$classes3$use, _session$token;\n      // Calculate status based on Cameroon time\n      const now = new Date();\n      const sessionDate = session.session_date;\n      const [startHour, startMin] = session.start_time.split(':').map(Number);\n      const [endHour, endMin] = session.end_time.split(':').map(Number);\n      const startDateTimeUTC = new Date(sessionDate);\n      startDateTimeUTC.setHours(startHour, startMin, 0, 0);\n      startDateTimeUTC.setTime(startDateTimeUTC.getTime() - 1 * 60 * 60 * 1000);\n      const endDateTimeUTC = new Date(sessionDate);\n      endDateTimeUTC.setHours(endHour, endMin, 0, 0);\n      endDateTimeUTC.setTime(endDateTimeUTC.getTime() - 1 * 60 * 60 * 1000);\n      const nowUTC = new Date(now.getTime() - now.getTimezoneOffset() * 60 * 1000);\n      let status = 'Closed';\n      if (nowUTC < startDateTimeUTC) {\n        status = 'Scheduled';\n      } else if (nowUTC >= startDateTimeUTC && nowUTC < endDateTimeUTC) {\n        status = 'Open';\n      }\n      return {\n        id: session.id,\n        className: ((_session$classes = session.classes) === null || _session$classes === void 0 ? void 0 : (_session$classes$cour = _session$classes.courses) === null || _session$classes$cour === void 0 ? void 0 : _session$classes$cour.course_title) || 'Unknown',\n        courseCode: ((_session$classes2 = session.classes) === null || _session$classes2 === void 0 ? void 0 : (_session$classes2$cou = _session$classes2.courses) === null || _session$classes2$cou === void 0 ? void 0 : _session$classes2$cou.course_code) || 'N/A',\n        delegateName: ((_session$classes3 = session.classes) === null || _session$classes3 === void 0 ? void 0 : (_session$classes3$use = _session$classes3.users) === null || _session$classes3$use === void 0 ? void 0 : _session$classes3$use.name) || 'Unknown',\n        date: new Date(session.session_date).toLocaleDateString(),\n        startTime: session.start_time,\n        endTime: session.end_time,\n        status: status,\n        tokenPreview: ((_session$token = session.token) === null || _session$token === void 0 ? void 0 : _session$token.slice(0, 8).toUpperCase()) || 'N/A'\n      };\n    });\n    return {\n      sessions: allSessions,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching sessions:', error);\n    return {\n      sessions: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchCourseAttendance = async (limit = 10) => {\n  try {\n    const {\n      data: courses,\n      error\n    } = await supabase.from('courses').select('id, course_code, course_title').limit(limit);\n    if (error) throw error;\n    const courseStats = await Promise.all((courses || []).map(async course => {\n      const {\n        data: enrollments,\n        error: enrollError\n      } = await supabase.from('enrollments').select('id').eq('course_id', course.id);\n      const {\n        data: sessions,\n        error: sessionsError\n      } = await supabase.from('sessions').select('id', {\n        count: 'exact'\n      }).eq('classes.course_id', course.id);\n      const {\n        data: attendance\n      } = await supabase.from('attendance').select('id').in('session_id', (sessions || []).map(s => s.id));\n      const enrollmentCount = (enrollments || []).length;\n      const totalAttendance = (attendance || []).length;\n      const percentage = enrollmentCount > 0 ? Math.round(totalAttendance / enrollmentCount * 100) : 0;\n      return {\n        id: course.id,\n        courseCode: course.course_code,\n        courseTitle: course.course_title,\n        enrolledStudents: enrollmentCount,\n        totalAttendance,\n        attendancePercentage: percentage,\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\n      };\n    }));\n    return {\n      courseAttendance: courseStats,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching course attendance:', error);\n    return {\n      courseAttendance: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAttendanceAlerts = async () => {\n  try {\n    const threshold = 75; // 75% attendance threshold\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('student_id, course_id');\n    if (enrollError) throw enrollError;\n    const alerts = [];\n    for (const enrollment of enrollments || []) {\n      var _await$supabase$from$;\n      // Get sessions for this course\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id').in('class_id', ((_await$supabase$from$ = (await supabase.from('classes').select('id').eq('course_id', enrollment.course_id)).data) === null || _await$supabase$from$ === void 0 ? void 0 : _await$supabase$from$.map(c => c.id)) || []);\n\n      // Count attendance for this student in these sessions\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('student_id', enrollment.student_id).in('session_id', (sessions || []).map(s => s.id));\n      const percentage = ((sessions === null || sessions === void 0 ? void 0 : sessions.length) || 0) > 0 ? attendanceCount / sessions.length * 100 : 0;\n      if (percentage < threshold) {\n        const {\n          data: student\n        } = await supabase.from('users').select('name, matricule').eq('id', enrollment.student_id).single();\n        const {\n          data: course\n        } = await supabase.from('courses').select('course_title, course_code').eq('id', enrollment.course_id).single();\n        alerts.push({\n          type: 'low-attendance',\n          severity: percentage < 60 ? 'critical' : 'warning',\n          studentName: (student === null || student === void 0 ? void 0 : student.name) || 'Unknown',\n          studentId: enrollment.student_id,\n          courseTitle: (course === null || course === void 0 ? void 0 : course.course_title) || 'Unknown',\n          courseCode: (course === null || course === void 0 ? void 0 : course.course_code) || 'N/A',\n          attendance: `${Math.round(percentage)}%`,\n          message: `${(student === null || student === void 0 ? void 0 : student.name) || 'Student'} has ${Math.round(percentage)}% attendance in ${(course === null || course === void 0 ? void 0 : course.course_title) || 'Course'}`\n        });\n      }\n    }\n\n    // Check for expired sessions\n    const {\n      data: expiredSessions\n    } = await supabase.from('sessions').select('id, expires_at, classes!inner(class_name)').lt('expires_at', new Date().toISOString());\n    (expiredSessions || []).forEach(session => {\n      var _session$classes4;\n      alerts.push({\n        type: 'expired-session',\n        severity: 'warning',\n        message: `Session for ${((_session$classes4 = session.classes) === null || _session$classes4 === void 0 ? void 0 : _session$classes4.class_name) || 'Class'} was left open beyond allowed time`,\n        sessionId: session.id\n      });\n    });\n    return {\n      alerts,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching alerts:', error);\n    return {\n      alerts: [],\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// DELEGATE DASHBOARD QUERIES\n// ============================================\n\nexport const delegateFetchAssignedClasses = async delegateId => {\n  try {\n    const {\n      data: classes,\n      error\n    } = await supabase.from('classes').select(`\n        id,\n        class_name,\n        course_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title,\n          program,\n          year_level\n        )\n      `).eq('delegate_id', delegateId);\n    if (error) throw error;\n    const classesWithSessions = await Promise.all((classes || []).map(async cls => {\n      var _cls$courses, _cls$courses2, _cls$courses3, _cls$courses4;\n      const today = new Date().toISOString().split('T')[0];\n      const {\n        data: todaySession\n      } = await supabase.from('sessions').select('id, status, start_time, end_time').eq('class_id', cls.id).eq('session_date', today).limit(1);\n      return {\n        id: cls.id,\n        className: cls.class_name,\n        courseCode: (_cls$courses = cls.courses) === null || _cls$courses === void 0 ? void 0 : _cls$courses.course_code,\n        courseTitle: (_cls$courses2 = cls.courses) === null || _cls$courses2 === void 0 ? void 0 : _cls$courses2.course_title,\n        program: (_cls$courses3 = cls.courses) === null || _cls$courses3 === void 0 ? void 0 : _cls$courses3.program,\n        yearLevel: (_cls$courses4 = cls.courses) === null || _cls$courses4 === void 0 ? void 0 : _cls$courses4.year_level,\n        sessionToday: (todaySession || []).length > 0 ? 'Open' : 'None',\n        hasActiveSession: (todaySession || []).length > 0\n      };\n    }));\n    return {\n      classes: classesWithSessions,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching assigned classes:', error);\n    return {\n      classes: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchAssignedCourses = async delegateId => {\n  try {\n    const {\n      data: courses,\n      error\n    } = await supabase.from('classes').select(`\n        courses!inner (\n          id,\n          course_code,\n          course_title,\n          program,\n          year_level\n        )\n      `).eq('delegate_id', delegateId);\n    if (error) throw error;\n\n    // Remove duplicates\n    const uniqueCourses = [];\n    const seen = new Set();\n    (courses || []).forEach(item => {\n      if (item.courses && !seen.has(item.courses.id)) {\n        seen.add(item.courses.id);\n        uniqueCourses.push({\n          id: item.courses.id,\n          courseCode: item.courses.course_code,\n          courseTitle: item.courses.course_title,\n          program: item.courses.program,\n          yearLevel: item.courses.year_level\n        });\n      }\n    });\n    return {\n      courses: uniqueCourses,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching assigned courses:', error);\n    return {\n      courses: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchSessions = async delegateId => {\n  try {\n    // Fetch ALL sessions (not just for delegate's classes) so delegates can see admin-created sessions\n    const {\n      data: sessions,\n      error\n    } = await supabase.from('sessions').select(`\n        id,\n        session_date,\n        start_time,\n        end_time,\n        token,\n        expires_at,\n        classes!inner (\n          id,\n          class_name,\n          delegate_id,\n          courses!inner (course_code, course_title),\n          users!delegate_id (name)\n        )\n      `).order('session_date', {\n      ascending: false\n    }).limit(50);\n    if (error) throw error;\n    const enrichedSessions = await Promise.all((sessions || []).map(async session => {\n      var _session$classes5, _session$classes6, _session$classes6$cou, _session$classes7, _session$classes7$cou, _session$classes8, _session$classes8$use, _session$classes9;\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('session_id', session.id);\n      return {\n        id: session.id,\n        className: (_session$classes5 = session.classes) === null || _session$classes5 === void 0 ? void 0 : _session$classes5.class_name,\n        courseTitle: (_session$classes6 = session.classes) === null || _session$classes6 === void 0 ? void 0 : (_session$classes6$cou = _session$classes6.courses) === null || _session$classes6$cou === void 0 ? void 0 : _session$classes6$cou.course_title,\n        courseCode: (_session$classes7 = session.classes) === null || _session$classes7 === void 0 ? void 0 : (_session$classes7$cou = _session$classes7.courses) === null || _session$classes7$cou === void 0 ? void 0 : _session$classes7$cou.course_code,\n        delegateName: ((_session$classes8 = session.classes) === null || _session$classes8 === void 0 ? void 0 : (_session$classes8$use = _session$classes8.users) === null || _session$classes8$use === void 0 ? void 0 : _session$classes8$use.name) || 'Admin',\n        date: new Date(session.session_date).toLocaleDateString(),\n        startTime: session.start_time,\n        endTime: session.end_time,\n        status: new Date(session.expires_at) > new Date() ? 'Open' : 'Closed',\n        attendanceCount: attendanceCount || 0,\n        token: session.token,\n        isOwnClass: ((_session$classes9 = session.classes) === null || _session$classes9 === void 0 ? void 0 : _session$classes9.delegate_id) === delegateId\n      };\n    }));\n    return {\n      sessions: enrichedSessions,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching sessions:', error);\n    return {\n      sessions: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchSessionAttendance = async sessionId => {\n  try {\n    const {\n      data: attendance,\n      error\n    } = await supabase.from('attendance').select(`\n        id,\n        created_at,\n        users!student_id (\n          id,\n          name,\n          matricule\n        )\n      `).eq('session_id', sessionId);\n    if (error) throw error;\n    return {\n      attendance: (attendance || []).map(a => {\n        var _a$users, _a$users2;\n        return {\n          id: a.id,\n          studentName: (_a$users = a.users) === null || _a$users === void 0 ? void 0 : _a$users.name,\n          studentMatricule: (_a$users2 = a.users) === null || _a$users2 === void 0 ? void 0 : _a$users2.matricule,\n          timestamp: new Date(a.created_at).toLocaleTimeString(),\n          status: 'Present'\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching session attendance:', error);\n    return {\n      attendance: [],\n      error: error.message\n    };\n  }\n};\nexport const delegateFetchStats = async delegateId => {\n  try {\n    // Get stats for delegate's own classes\n    const {\n      data: classes\n    } = await supabase.from('classes').select('id').eq('delegate_id', delegateId);\n    const classIds = (classes || []).map(c => c.id);\n    const {\n      data: ownSessions\n    } = await supabase.from('sessions').select('id, expires_at').in('class_id', classIds);\n    const now = new Date();\n    const activeSessions = (ownSessions || []).filter(s => new Date(s.expires_at) > now);\n    const {\n      count: totalAttendance\n    } = await supabase.from('attendance').select('id', {\n      count: 'exact'\n    }).in('session_id', (ownSessions || []).map(s => s.id));\n    const today = new Date().toISOString().split('T')[0];\n    const {\n      data: todaySessions\n    } = await supabase.from('sessions').select('id').in('class_id', classIds).eq('session_date', today);\n    return {\n      activeSessions: activeSessions.length,\n      totalSessions: (ownSessions === null || ownSessions === void 0 ? void 0 : ownSessions.length) || 0,\n      totalMarked: totalAttendance || 0,\n      todaySessions: (todaySessions || []).length,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching delegate stats:', error);\n    return {\n      activeSessions: 0,\n      totalSessions: 0,\n      totalMarked: 0,\n      todaySessions: 0,\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// STUDENT DASHBOARD QUERIES\n// ============================================\n\nexport const studentFetchEnrolledCourses = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error\n    } = await supabase.from('enrollments').select(`\n        id,\n        course_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title,\n          program,\n          year_level\n        )\n      `).eq('student_id', studentId);\n    if (error) throw error;\n    return {\n      courses: (enrollments || []).map(e => {\n        var _e$courses, _e$courses2, _e$courses3, _e$courses4, _e$courses5;\n        return {\n          id: (_e$courses = e.courses) === null || _e$courses === void 0 ? void 0 : _e$courses.id,\n          courseCode: (_e$courses2 = e.courses) === null || _e$courses2 === void 0 ? void 0 : _e$courses2.course_code,\n          courseTitle: (_e$courses3 = e.courses) === null || _e$courses3 === void 0 ? void 0 : _e$courses3.course_title,\n          program: (_e$courses4 = e.courses) === null || _e$courses4 === void 0 ? void 0 : _e$courses4.program,\n          yearLevel: (_e$courses5 = e.courses) === null || _e$courses5 === void 0 ? void 0 : _e$courses5.year_level,\n          enrollmentId: e.id\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching enrolled courses:', error);\n    return {\n      courses: [],\n      error: error.message\n    };\n  }\n};\nexport const studentFetchActiveSessions = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('course_id').eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const courseIds = (enrollments || []).map(e => e.course_id);\n    const {\n      data: classes\n    } = await supabase.from('classes').select('id').in('course_id', courseIds);\n    const classIds = (classes || []).map(c => c.id);\n    const now = new Date();\n    const {\n      data: sessions,\n      error: sessionError\n    } = await supabase.from('sessions').select(`\n        id,\n        session_date,\n        start_time,\n        end_time,\n        expires_at,\n        token,\n        classes!inner (\n          id,\n          class_name,\n          delegate_id,\n          users!delegate_id (name),\n          courses!inner (course_code, course_title)\n        )\n      `).in('class_id', classIds).gt('expires_at', now.toISOString());\n    if (sessionError) throw sessionError;\n\n    // Check which sessions student has already marked\n    const {\n      data: studentAttendance\n    } = await supabase.from('attendance').select('session_id').eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n    const markedSessionIds = (studentAttendance || []).map(a => a.session_id);\n    return {\n      sessions: (sessions || []).map(s => {\n        var _s$classes, _s$classes$courses, _s$classes2, _s$classes2$courses, _s$classes3, _s$classes4, _s$classes4$users;\n        return {\n          id: s.id,\n          courseCode: (_s$classes = s.classes) === null || _s$classes === void 0 ? void 0 : (_s$classes$courses = _s$classes.courses) === null || _s$classes$courses === void 0 ? void 0 : _s$classes$courses.course_code,\n          courseTitle: (_s$classes2 = s.classes) === null || _s$classes2 === void 0 ? void 0 : (_s$classes2$courses = _s$classes2.courses) === null || _s$classes2$courses === void 0 ? void 0 : _s$classes2$courses.course_title,\n          className: (_s$classes3 = s.classes) === null || _s$classes3 === void 0 ? void 0 : _s$classes3.class_name,\n          delegateName: (_s$classes4 = s.classes) === null || _s$classes4 === void 0 ? void 0 : (_s$classes4$users = _s$classes4.users) === null || _s$classes4$users === void 0 ? void 0 : _s$classes4$users.name,\n          date: new Date(s.session_date).toLocaleDateString(),\n          startTime: s.start_time,\n          endTime: s.end_time,\n          token: s.token,\n          isMarked: markedSessionIds.includes(s.id),\n          status: 'Open'\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching active sessions:', error);\n    return {\n      sessions: [],\n      error: error.message\n    };\n  }\n};\nexport const studentFetchAttendanceSummary = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('course_id').eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const courseIds = (enrollments || []).map(e => e.course_id);\n    const {\n      data: classes\n    } = await supabase.from('classes').select('id').in('course_id', courseIds);\n    const classIds = (classes || []).map(c => c.id);\n    const {\n      data: sessions\n    } = await supabase.from('sessions').select('id').in('class_id', classIds);\n    const {\n      data: attendance\n    } = await supabase.from('attendance').select('id').eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n    const totalSessions = (sessions || []).length;\n    const totalAttended = (attendance || []).length;\n    const percentage = totalSessions > 0 ? Math.round(totalAttended / totalSessions * 100) : 0;\n    return {\n      summary: {\n        totalSessions,\n        totalAttended,\n        attendancePercentage: percentage,\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\n      },\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching attendance summary:', error);\n    return {\n      summary: {\n        totalSessions: 0,\n        totalAttended: 0,\n        attendancePercentage: 0,\n        status: 'Unknown'\n      },\n      error: error.message\n    };\n  }\n};\nexport const studentFetchCourseAttendance = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select(`\n        course_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title\n        )\n      `).eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const courseAttendance = await Promise.all((enrollments || []).map(async enrollment => {\n      var _enrollment$courses, _enrollment$courses2;\n      const {\n        data: classes\n      } = await supabase.from('classes').select('id').eq('course_id', enrollment.course_id);\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id').in('class_id', (classes || []).map(c => c.id));\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n      const totalSessions = (sessions || []).length;\n      const percentage = totalSessions > 0 ? Math.round(attendanceCount / totalSessions * 100) : 0;\n      return {\n        courseCode: (_enrollment$courses = enrollment.courses) === null || _enrollment$courses === void 0 ? void 0 : _enrollment$courses.course_code,\n        courseTitle: (_enrollment$courses2 = enrollment.courses) === null || _enrollment$courses2 === void 0 ? void 0 : _enrollment$courses2.course_title,\n        courseId: enrollment.course_id,\n        totalSessions,\n        attended: attendanceCount || 0,\n        attendancePercentage: percentage,\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\n      };\n    }));\n    return {\n      courseAttendance,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching course attendance:', error);\n    return {\n      courseAttendance: [],\n      error: error.message\n    };\n  }\n};\nexport const studentFetchAlerts = async studentId => {\n  try {\n    const alerts = [];\n    const threshold = 75;\n    const {\n      data: enrollments\n    } = await supabase.from('enrollments').select(`\n        course_id,\n        courses!inner (course_code, course_title)\n      `).eq('student_id', studentId);\n    for (const enrollment of enrollments || []) {\n      const {\n        data: classes\n      } = await supabase.from('classes').select('id').eq('course_id', enrollment.course_id);\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id').in('class_id', (classes || []).map(c => c.id));\n      const {\n        count: attendanceCount\n      } = await supabase.from('attendance').select('id', {\n        count: 'exact'\n      }).eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n      const percentage = ((sessions === null || sessions === void 0 ? void 0 : sessions.length) || 0) > 0 ? attendanceCount / sessions.length * 100 : 0;\n      if (percentage < threshold) {\n        var _enrollment$courses3, _enrollment$courses4, _enrollment$courses5;\n        alerts.push({\n          type: 'low-attendance',\n          severity: percentage < 60 ? 'critical' : 'warning',\n          message: `Your attendance in ${(_enrollment$courses3 = enrollment.courses) === null || _enrollment$courses3 === void 0 ? void 0 : _enrollment$courses3.course_title} is ${Math.round(percentage)}%. You may face academic penalties.`,\n          courseTitle: (_enrollment$courses4 = enrollment.courses) === null || _enrollment$courses4 === void 0 ? void 0 : _enrollment$courses4.course_title,\n          courseCode: (_enrollment$courses5 = enrollment.courses) === null || _enrollment$courses5 === void 0 ? void 0 : _enrollment$courses5.course_code,\n          percentage: Math.round(percentage)\n        });\n      }\n    }\n    return {\n      alerts,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching alerts:', error);\n    return {\n      alerts: [],\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// COURSE MANAGEMENT\n// ============================================\n\nexport const createCourse = async courseData => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('courses').insert({\n      course_code: courseData.courseCode,\n      course_title: courseData.courseTitle,\n      program: courseData.program,\n      year_level: courseData.yearLevel,\n      instructor: courseData.instructor,\n      course_status: 'scheduled'\n    }).select();\n    if (error) throw error;\n    return {\n      course: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error creating course:', error);\n    return {\n      course: null,\n      error: error.message\n    };\n  }\n};\nexport const createDelegate = async delegateData => {\n  try {\n    // NOTE: Creating delegates requires admin privileges to create auth users first.\n    // This is a limitation when using client-side Supabase without service role.\n    // For production, this should be done server-side or with proper auth setup.\n\n    alert('Creating delegates requires admin setup. Please use the setup script or contact administrator to add delegates.');\n    return {\n      delegate: null,\n      error: 'Admin privileges required for user creation'\n    };\n  } catch (error) {\n    console.error('Error creating delegate:', error);\n    return {\n      delegate: null,\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllClasses = async () => {\n  try {\n    const {\n      data: classes,\n      error\n    } = await supabase.from('classes').select(`\n        id,\n        class_name,\n        delegate_id,\n        courses!inner (\n          id,\n          course_code,\n          course_title\n        ),\n        users!delegate_id (\n          id,\n          name\n        )\n      `);\n    if (error) throw error;\n    return {\n      classes: (classes || []).map(cls => {\n        var _cls$courses5, _cls$courses6, _cls$users;\n        return {\n          id: cls.id,\n          className: cls.class_name,\n          courseCode: (_cls$courses5 = cls.courses) === null || _cls$courses5 === void 0 ? void 0 : _cls$courses5.course_code,\n          courseTitle: (_cls$courses6 = cls.courses) === null || _cls$courses6 === void 0 ? void 0 : _cls$courses6.course_title,\n          delegateId: cls.delegate_id,\n          delegateName: (_cls$users = cls.users) === null || _cls$users === void 0 ? void 0 : _cls$users.name\n        };\n      }),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all classes:', error);\n    return {\n      classes: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllStudents = async () => {\n  try {\n    const {\n      data: students,\n      error\n    } = await supabase.from('users').select('id, name, matricule').eq('role', 'student');\n    if (error) throw error;\n    return {\n      students: (students || []).map(student => ({\n        id: student.id,\n        name: student.name,\n        matricule: student.matricule\n      })),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all students:', error);\n    return {\n      students: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllCourses = async () => {\n  try {\n    const {\n      data: courses,\n      error\n    } = await supabase.from('courses').select('id, course_code, course_title, program, year_level');\n    if (error) throw error;\n    return {\n      courses: (courses || []).map(course => ({\n        id: course.id,\n        courseCode: course.course_code,\n        courseTitle: course.course_title,\n        program: course.program,\n        yearLevel: course.year_level\n      })),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all courses:', error);\n    return {\n      courses: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAllDelegates = async () => {\n  try {\n    const {\n      data: delegates,\n      error\n    } = await supabase.from('users').select('id, name').eq('role', 'delegate');\n    if (error) throw error;\n    return {\n      delegates: (delegates || []).map(delegate => ({\n        id: delegate.id,\n        name: delegate.name\n      })),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching all delegates:', error);\n    return {\n      delegates: [],\n      error: error.message\n    };\n  }\n};\nexport const promoteStudentToDelegate = async studentId => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('users').update({\n      role: 'delegate'\n    }).eq('id', studentId).select();\n    if (error) throw error;\n    return {\n      delegate: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error promoting student to delegate:', error);\n    return {\n      delegate: null,\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// SESSION MANAGEMENT\n// ============================================\n\nexport const createSession = async (courseId, delegateId, sessionDate, startTime, endTime) => {\n  try {\n    // First, find or create the class for this course and delegate\n    let {\n      data: existingClass,\n      error: classError\n    } = await supabase.from('classes').select('id').eq('course_id', courseId).eq('delegate_id', delegateId).single();\n    let classId;\n    if (classError && classError.code === 'PGRST116') {\n      // No rows returned\n      // Create new class\n      const {\n        data: course,\n        error: courseError\n      } = await supabase.from('courses').select('course_title').eq('id', courseId).single();\n      if (courseError) throw courseError;\n      const {\n        data: newClass,\n        error: createClassError\n      } = await supabase.from('classes').insert({\n        class_name: course.course_title,\n        course_id: courseId,\n        delegate_id: delegateId\n      }).select('id').single();\n      if (createClassError) throw createClassError;\n      classId = newClass.id;\n    } else if (classError) {\n      throw classError;\n    } else {\n      classId = existingClass.id;\n    }\n\n    // Generate a unique token\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n\n    // Calculate expires_at (1 hour after end time) in UTC\n    const [endHour, endMin] = endTime.split(':');\n    const endDateTimeCameroon = new Date(sessionDate);\n    endDateTimeCameroon.setHours(parseInt(endHour), parseInt(endMin), 0, 0);\n    const expiresAt = new Date(endDateTimeCameroon.getTime() + 60 * 60 * 1000 - 1 * 60 * 60 * 1000); // Add 1 hour, then convert Cameroon to UTC\n\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').insert({\n      class_id: classId,\n      session_date: sessionDate,\n      start_time: startTime,\n      end_time: endTime,\n      token,\n      expires_at: expiresAt.toISOString()\n    }).select();\n    if (error) throw error;\n    return {\n      session: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error creating session:', error);\n    return {\n      session: null,\n      error: error.message\n    };\n  }\n};\nexport const markAttendance = async (studentId, sessionId) => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('attendance').insert({\n      student_id: studentId,\n      session_id: sessionId\n    }).select();\n    if (error) throw error;\n    return {\n      success: true,\n      attendance: data === null || data === void 0 ? void 0 : data[0],\n      error: null\n    };\n  } catch (error) {\n    console.error('Error marking attendance:', error);\n    return {\n      success: false,\n      attendance: null,\n      error: error.message\n    };\n  }\n};\n\n// ============================================\n// ATTENDANCE HISTORY & EXPORT QUERIES\n// ============================================\n\nexport const studentFetchAttendanceHistory = async studentId => {\n  try {\n    const {\n      data: enrollments,\n      error: enrollError\n    } = await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id', studentId);\n    if (enrollError) throw enrollError;\n    const history = [];\n    for (const enrollment of enrollments || []) {\n      var _enrollment$courses6, _enrollment$courses7;\n      const courseId = enrollment.course_id;\n      const courseName = ((_enrollment$courses6 = enrollment.courses) === null || _enrollment$courses6 === void 0 ? void 0 : _enrollment$courses6.course_title) || '';\n      const courseCode = ((_enrollment$courses7 = enrollment.courses) === null || _enrollment$courses7 === void 0 ? void 0 : _enrollment$courses7.course_code) || '';\n\n      // Get classes for this course\n      const {\n        data: classes\n      } = await supabase.from('classes').select('id, class_name').eq('course_id', courseId);\n      const classIds = (classes || []).map(c => c.id);\n\n      // Get all sessions for these classes\n      const {\n        data: sessions\n      } = await supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id', classIds).order('session_date', {\n        ascending: false\n      });\n\n      // Get attendance records for this student in these sessions\n      const {\n        data: attendance\n      } = await supabase.from('attendance').select('id, session_id, created_at').eq('student_id', studentId).in('session_id', (sessions || []).map(s => s.id));\n      const attendanceMap = new Set((attendance || []).map(a => a.session_id));\n\n      // Create history records\n      for (const session of sessions || []) {\n        const classInfo = classes === null || classes === void 0 ? void 0 : classes.find(c => c.id === session.class_id);\n        history.push({\n          courseCode,\n          courseName,\n          className: (classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name) || 'Unknown',\n          sessionDate: new Date(session.session_date).toLocaleDateString(),\n          startTime: session.start_time,\n          endTime: session.end_time,\n          status: attendanceMap.has(session.id) ? 'Present' : 'Absent',\n          sessionId: session.id\n        });\n      }\n    }\n\n    // Calculate per-course statistics\n    const courseStats = {};\n    for (const record of history) {\n      if (!courseStats[record.courseCode]) {\n        courseStats[record.courseCode] = {\n          courseCode: record.courseCode,\n          courseName: record.courseName,\n          totalSessions: 0,\n          attended: 0,\n          percentage: 0\n        };\n      }\n      courseStats[record.courseCode].totalSessions++;\n      if (record.status === 'Present') {\n        courseStats[record.courseCode].attended++;\n      }\n    }\n\n    // Calculate percentages\n    for (const key in courseStats) {\n      const stat = courseStats[key];\n      stat.percentage = stat.totalSessions > 0 ? Math.round(stat.attended / stat.totalSessions * 100) : 0;\n    }\n    return {\n      history: history.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate)),\n      courseStats: Object.values(courseStats),\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching attendance history:', error);\n    return {\n      history: [],\n      courseStats: [],\n      error: error.message\n    };\n  }\n};\nexport const adminFetchAttendanceExportData = async (filters = {}) => {\n  try {\n    // Fetch all students\n    const {\n      data: students,\n      error: studentError\n    } = await supabase.from('users').select('id, name, matricule').eq('role', 'student');\n    if (studentError) throw studentError;\n    const exportData = [];\n    for (const student of students || []) {\n      // Get student's enrollments\n      const {\n        data: enrollments\n      } = await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id', student.id);\n      for (const enrollment of enrollments || []) {\n        var _enrollment$courses8;\n        // Apply course filter if provided\n        if (filters.courseCode && ((_enrollment$courses8 = enrollment.courses) === null || _enrollment$courses8 === void 0 ? void 0 : _enrollment$courses8.course_code) !== filters.courseCode) {\n          continue;\n        }\n        const courseId = enrollment.course_id;\n\n        // Get classes for this course\n        const {\n          data: classes\n        } = await supabase.from('classes').select('id, class_name').eq('course_id', courseId);\n        const classIds = (classes || []).map(c => c.id);\n\n        // Get sessions\n        let sessionsQuery = supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id', classIds);\n\n        // Apply date range filter if provided\n        if (filters.startDate) {\n          sessionsQuery = sessionsQuery.gte('session_date', filters.startDate);\n        }\n        if (filters.endDate) {\n          sessionsQuery = sessionsQuery.lte('session_date', filters.endDate);\n        }\n        const {\n          data: sessions\n        } = await sessionsQuery.order('session_date', {\n          ascending: false\n        });\n\n        // Get attendance records\n        const {\n          data: attendance\n        } = await supabase.from('attendance').select('id, session_id, created_at').eq('student_id', student.id).in('session_id', (sessions || []).map(s => s.id));\n        const attendanceMap = new Map((attendance || []).map(a => [a.session_id, true]));\n\n        // Create export records\n        for (const session of sessions || []) {\n          var _enrollment$courses9, _enrollment$courses0;\n          const classInfo = classes === null || classes === void 0 ? void 0 : classes.find(c => c.id === session.class_id);\n          exportData.push({\n            studentName: student.name,\n            studentId: student.matricule,\n            course: (_enrollment$courses9 = enrollment.courses) === null || _enrollment$courses9 === void 0 ? void 0 : _enrollment$courses9.course_code,\n            courseName: (_enrollment$courses0 = enrollment.courses) === null || _enrollment$courses0 === void 0 ? void 0 : _enrollment$courses0.course_title,\n            class: (classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name) || 'Unknown',\n            sessionDate: new Date(session.session_date).toLocaleDateString(),\n            sessionTime: `${session.start_time} - ${session.end_time}`,\n            status: attendanceMap.has(session.id) ? 'Present' : 'Absent'\n          });\n        }\n      }\n    }\n    return {\n      data: exportData,\n      error: null\n    };\n  } catch (error) {\n    console.error('Error fetching export data:', error);\n    return {\n      data: [],\n      error: error.message\n    };\n  }\n};","map":{"version":3,"names":["supabase","adminFetchStats","count","studentCount","error","studentError","delegateCount","delegateError","courseCount","courseError","classCount","classError","Promise","all","from","select","eq","today","Date","toISOString","split","data","todaySessions","sessionsError","Error","totalStudents","totalDelegates","totalCourses","totalClasses","sessionsToday","length","console","message","adminFetchOpenSessions","sessions","order","ascending","limit","allSessions","map","session","_session$classes","_session$classes$cour","_session$classes2","_session$classes2$cou","_session$classes3","_session$classes3$use","_session$token","now","sessionDate","session_date","startHour","startMin","start_time","Number","endHour","endMin","end_time","startDateTimeUTC","setHours","setTime","getTime","endDateTimeUTC","nowUTC","getTimezoneOffset","status","id","className","classes","courses","course_title","courseCode","course_code","delegateName","users","name","date","toLocaleDateString","startTime","endTime","tokenPreview","token","slice","toUpperCase","adminFetchCourseAttendance","courseStats","course","enrollments","enrollError","attendance","in","s","enrollmentCount","totalAttendance","percentage","Math","round","courseTitle","enrolledStudents","attendancePercentage","courseAttendance","adminFetchAttendanceAlerts","threshold","alerts","enrollment","_await$supabase$from$","course_id","c","attendanceCount","student_id","student","single","push","type","severity","studentName","studentId","expiredSessions","lt","forEach","_session$classes4","class_name","sessionId","delegateFetchAssignedClasses","delegateId","classesWithSessions","cls","_cls$courses","_cls$courses2","_cls$courses3","_cls$courses4","todaySession","program","yearLevel","year_level","sessionToday","hasActiveSession","delegateFetchAssignedCourses","uniqueCourses","seen","Set","item","has","add","delegateFetchSessions","enrichedSessions","_session$classes5","_session$classes6","_session$classes6$cou","_session$classes7","_session$classes7$cou","_session$classes8","_session$classes8$use","_session$classes9","expires_at","isOwnClass","delegate_id","delegateFetchSessionAttendance","a","_a$users","_a$users2","studentMatricule","matricule","timestamp","created_at","toLocaleTimeString","delegateFetchStats","classIds","ownSessions","activeSessions","filter","totalSessions","totalMarked","studentFetchEnrolledCourses","e","_e$courses","_e$courses2","_e$courses3","_e$courses4","_e$courses5","enrollmentId","studentFetchActiveSessions","courseIds","sessionError","gt","studentAttendance","markedSessionIds","session_id","_s$classes","_s$classes$courses","_s$classes2","_s$classes2$courses","_s$classes3","_s$classes4","_s$classes4$users","isMarked","includes","studentFetchAttendanceSummary","totalAttended","summary","studentFetchCourseAttendance","_enrollment$courses","_enrollment$courses2","courseId","attended","studentFetchAlerts","_enrollment$courses3","_enrollment$courses4","_enrollment$courses5","createCourse","courseData","insert","instructor","course_status","createDelegate","delegateData","alert","delegate","adminFetchAllClasses","_cls$courses5","_cls$courses6","_cls$users","adminFetchAllStudents","students","adminFetchAllCourses","adminFetchAllDelegates","delegates","promoteStudentToDelegate","update","role","createSession","existingClass","classId","code","newClass","createClassError","random","toString","substring","endDateTimeCameroon","parseInt","expiresAt","class_id","markAttendance","success","studentFetchAttendanceHistory","history","_enrollment$courses6","_enrollment$courses7","courseName","attendanceMap","classInfo","find","record","key","stat","sort","b","Object","values","adminFetchAttendanceExportData","filters","exportData","_enrollment$courses8","sessionsQuery","startDate","gte","endDate","lte","Map","_enrollment$courses9","_enrollment$courses0","class","sessionTime"],"sources":["C:/Users/PFI/Desktop/ictuattennce_portal/ATTENDANCE/src/utils/dashboardQueries.js"],"sourcesContent":["import { supabase } from '../supabase/supabase';\r\n\r\n// ============================================\r\n// ADMIN DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const adminFetchStats = async () => {\r\n  try {\r\n    const [\r\n      { count: studentCount, error: studentError },\r\n      { count: delegateCount, error: delegateError },\r\n      { count: courseCount, error: courseError },\r\n      { count: classCount, error: classError }\r\n    ] = await Promise.all([\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'student'),\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'delegate'),\r\n      supabase\r\n        .from('courses')\r\n        .select('id', { count: 'exact' }),\r\n      supabase\r\n        .from('classes')\r\n        .select('id', { count: 'exact' })\r\n    ]);\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions, error: sessionsError } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .eq('session_date', today);\r\n\r\n    if (studentError || delegateError || courseError || classError || sessionsError) {\r\n      throw new Error('Failed to fetch stats');\r\n    }\r\n\r\n    return {\r\n      totalStudents: studentCount || 0,\r\n      totalDelegates: delegateCount || 0,\r\n      totalCourses: courseCount || 0,\r\n      totalClasses: classCount || 0,\r\n      sessionsToday: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching admin stats:', error);\r\n    return {\r\n      totalStudents: 0,\r\n      totalDelegates: 0,\r\n      totalCourses: 0,\r\n      totalClasses: 0,\r\n      sessionsToday: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const adminFetchOpenSessions = async () => {\r\n  try {\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(20);\r\n\r\n    if (error) throw error;\r\n\r\n    // Return all sessions with calculated status\r\n    const allSessions = (sessions || []).map(session => {\r\n      // Calculate status based on Cameroon time\r\n      const now = new Date();\r\n      const sessionDate = session.session_date;\r\n      const [startHour, startMin] = session.start_time.split(':').map(Number);\r\n      const [endHour, endMin] = session.end_time.split(':').map(Number);\r\n\r\n      const startDateTimeUTC = new Date(sessionDate);\r\n      startDateTimeUTC.setHours(startHour, startMin, 0, 0);\r\n      startDateTimeUTC.setTime(startDateTimeUTC.getTime() - (1 * 60 * 60 * 1000));\r\n\r\n      const endDateTimeUTC = new Date(sessionDate);\r\n      endDateTimeUTC.setHours(endHour, endMin, 0, 0);\r\n      endDateTimeUTC.setTime(endDateTimeUTC.getTime() - (1 * 60 * 60 * 1000));\r\n\r\n      const nowUTC = new Date(now.getTime() - (now.getTimezoneOffset() * 60 * 1000));\r\n\r\n      let status = 'Closed';\r\n      if (nowUTC < startDateTimeUTC) {\r\n        status = 'Scheduled';\r\n      } else if (nowUTC >= startDateTimeUTC && nowUTC < endDateTimeUTC) {\r\n        status = 'Open';\r\n      }\r\n\r\n      return {\r\n        id: session.id,\r\n        className: session.classes?.courses?.course_title || 'Unknown',\r\n        courseCode: session.classes?.courses?.course_code || 'N/A',\r\n        delegateName: session.classes?.users?.name || 'Unknown',\r\n        date: new Date(session.session_date).toLocaleDateString(),\r\n        startTime: session.start_time,\r\n        endTime: session.end_time,\r\n        status: status,\r\n        tokenPreview: session.token?.slice(0, 8).toUpperCase() || 'N/A'\r\n      };\r\n    });\r\n\r\n    return { sessions: allSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchCourseAttendance = async (limit = 10) => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title')\r\n      .limit(limit);\r\n\r\n    if (error) throw error;\r\n\r\n    const courseStats = await Promise.all(\r\n      (courses || []).map(async (course) => {\r\n        const { data: enrollments, error: enrollError } = await supabase\r\n          .from('enrollments')\r\n          .select('id')\r\n          .eq('course_id', course.id);\r\n\r\n        const { data: sessions, error: sessionsError } = await supabase\r\n          .from('sessions')\r\n          .select('id', { count: 'exact' })\r\n          .eq('classes.course_id', course.id);\r\n\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id')\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const enrollmentCount = (enrollments || []).length;\r\n        const totalAttendance = (attendance || []).length;\r\n        const percentage = enrollmentCount > 0 ? Math.round((totalAttendance / enrollmentCount) * 100) : 0;\r\n\r\n        return {\r\n          id: course.id,\r\n          courseCode: course.course_code,\r\n          courseTitle: course.course_title,\r\n          enrolledStudents: enrollmentCount,\r\n          totalAttendance,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance: courseStats, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceAlerts = async () => {\r\n  try {\r\n    const threshold = 75; // 75% attendance threshold\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('student_id, course_id');\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const alerts = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      // Get sessions for this course\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (\r\n          await supabase\r\n            .from('classes')\r\n            .select('id')\r\n            .eq('course_id', enrollment.course_id)\r\n        ).data?.map(c => c.id) || []);\r\n\r\n      // Count attendance for this student in these sessions\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', enrollment.student_id)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        const { data: student } = await supabase\r\n          .from('users')\r\n          .select('name, matricule')\r\n          .eq('id', enrollment.student_id)\r\n          .single();\r\n\r\n        const { data: course } = await supabase\r\n          .from('courses')\r\n          .select('course_title, course_code')\r\n          .eq('id', enrollment.course_id)\r\n          .single();\r\n\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          studentName: student?.name || 'Unknown',\r\n          studentId: enrollment.student_id,\r\n          courseTitle: course?.course_title || 'Unknown',\r\n          courseCode: course?.course_code || 'N/A',\r\n          attendance: `${Math.round(percentage)}%`,\r\n          message: `${student?.name || 'Student'} has ${Math.round(percentage)}% attendance in ${course?.course_title || 'Course'}`\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check for expired sessions\r\n    const { data: expiredSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at, classes!inner(class_name)')\r\n      .lt('expires_at', new Date().toISOString());\r\n\r\n    (expiredSessions || []).forEach(session => {\r\n      alerts.push({\r\n        type: 'expired-session',\r\n        severity: 'warning',\r\n        message: `Session for ${session.classes?.class_name || 'Class'} was left open beyond allowed time`,\r\n        sessionId: session.id\r\n      });\r\n    });\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// DELEGATE DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const delegateFetchAssignedClasses = async (delegateId) => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('delegate_id', delegateId);\r\n\r\n    if (error) throw error;\r\n\r\n    const classesWithSessions = await Promise.all(\r\n      (classes || []).map(async (cls) => {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const { data: todaySession } = await supabase\r\n          .from('sessions')\r\n          .select('id, status, start_time, end_time')\r\n          .eq('class_id', cls.id)\r\n          .eq('session_date', today)\r\n          .limit(1);\r\n\r\n        return {\r\n          id: cls.id,\r\n          className: cls.class_name,\r\n          courseCode: cls.courses?.course_code,\r\n          courseTitle: cls.courses?.course_title,\r\n          program: cls.courses?.program,\r\n          yearLevel: cls.courses?.year_level,\r\n          sessionToday: (todaySession || []).length > 0 ? 'Open' : 'None',\r\n          hasActiveSession: (todaySession || []).length > 0\r\n        };\r\n      })\r\n    );\r\n\r\n    return { classes: classesWithSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching assigned classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchAssignedCourses = async (delegateId) => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('delegate_id', delegateId);\r\n\r\n    if (error) throw error;\r\n\r\n    // Remove duplicates\r\n    const uniqueCourses = [];\r\n    const seen = new Set();\r\n    (courses || []).forEach(item => {\r\n      if (item.courses && !seen.has(item.courses.id)) {\r\n        seen.add(item.courses.id);\r\n        uniqueCourses.push({\r\n          id: item.courses.id,\r\n          courseCode: item.courses.course_code,\r\n          courseTitle: item.courses.course_title,\r\n          program: item.courses.program,\r\n          yearLevel: item.courses.year_level\r\n        });\r\n      }\r\n    });\r\n\r\n    return {\r\n      courses: uniqueCourses,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching assigned courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessions = async (delegateId) => {\r\n  try {\r\n    // Fetch ALL sessions (not just for delegate's classes) so delegates can see admin-created sessions\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          courses!inner (course_code, course_title),\r\n          users!delegate_id (name)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(50);\r\n\r\n    if (error) throw error;\r\n\r\n    const enrichedSessions = await Promise.all(\r\n      (sessions || []).map(async (session) => {\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('session_id', session.id);\r\n\r\n        return {\r\n          id: session.id,\r\n          className: session.classes?.class_name,\r\n          courseTitle: session.classes?.courses?.course_title,\r\n          courseCode: session.classes?.courses?.course_code,\r\n          delegateName: session.classes?.users?.name || 'Admin',\r\n          date: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: new Date(session.expires_at) > new Date() ? 'Open' : 'Closed',\r\n          attendanceCount: attendanceCount || 0,\r\n          token: session.token,\r\n          isOwnClass: session.classes?.delegate_id === delegateId\r\n        };\r\n      })\r\n    );\r\n\r\n    return { sessions: enrichedSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessionAttendance = async (sessionId) => {\r\n  try {\r\n    const { data: attendance, error } = await supabase\r\n      .from('attendance')\r\n      .select(`\r\n        id,\r\n        created_at,\r\n        users!student_id (\r\n          id,\r\n          name,\r\n          matricule\r\n        )\r\n      `)\r\n      .eq('session_id', sessionId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      attendance: (attendance || []).map(a => ({\r\n        id: a.id,\r\n        studentName: a.users?.name,\r\n        studentMatricule: a.users?.matricule,\r\n        timestamp: new Date(a.created_at).toLocaleTimeString(),\r\n        status: 'Present'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching session attendance:', error);\r\n    return { attendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchStats = async (delegateId) => {\r\n  try {\r\n    // Get stats for delegate's own classes\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .eq('delegate_id', delegateId);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: ownSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at')\r\n      .in('class_id', classIds);\r\n\r\n    const now = new Date();\r\n    const activeSessions = (ownSessions || []).filter(s => new Date(s.expires_at) > now);\r\n\r\n    const { count: totalAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('id', { count: 'exact' })\r\n      .in('session_id', (ownSessions || []).map(s => s.id));\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds)\r\n      .eq('session_date', today);\r\n\r\n    return {\r\n      activeSessions: activeSessions.length,\r\n      totalSessions: ownSessions?.length || 0,\r\n      totalMarked: totalAttendance || 0,\r\n      todaySessions: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching delegate stats:', error);\r\n    return {\r\n      activeSessions: 0,\r\n      totalSessions: 0,\r\n      totalMarked: 0,\r\n      todaySessions: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// STUDENT DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchEnrolledCourses = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        id,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (enrollments || []).map(e => ({\r\n        id: e.courses?.id,\r\n        courseCode: e.courses?.course_code,\r\n        courseTitle: e.courses?.course_title,\r\n        program: e.courses?.program,\r\n        yearLevel: e.courses?.year_level,\r\n        enrollmentId: e.id\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching enrolled courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchActiveSessions = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n    const now = new Date();\r\n\r\n    const { data: sessions, error: sessionError } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        expires_at,\r\n        token,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .in('class_id', classIds)\r\n      .gt('expires_at', now.toISOString());\r\n\r\n    if (sessionError) throw sessionError;\r\n\r\n    // Check which sessions student has already marked\r\n    const { data: studentAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('session_id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const markedSessionIds = (studentAttendance || []).map(a => a.session_id);\r\n\r\n    return {\r\n      sessions: (sessions || []).map(s => ({\r\n        id: s.id,\r\n        courseCode: s.classes?.courses?.course_code,\r\n        courseTitle: s.classes?.courses?.course_title,\r\n        className: s.classes?.class_name,\r\n        delegateName: s.classes?.users?.name,\r\n        date: new Date(s.session_date).toLocaleDateString(),\r\n        startTime: s.start_time,\r\n        endTime: s.end_time,\r\n        token: s.token,\r\n        isMarked: markedSessionIds.includes(s.id),\r\n        status: 'Open'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching active sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAttendanceSummary = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: sessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds);\r\n\r\n    const { data: attendance } = await supabase\r\n      .from('attendance')\r\n      .select('id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const totalSessions = (sessions || []).length;\r\n    const totalAttended = (attendance || []).length;\r\n    const percentage = totalSessions > 0 ? Math.round((totalAttended / totalSessions) * 100) : 0;\r\n\r\n    return {\r\n      summary: {\r\n        totalSessions,\r\n        totalAttended,\r\n        attendancePercentage: percentage,\r\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n      },\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance summary:', error);\r\n    return {\r\n      summary: {\r\n        totalSessions: 0,\r\n        totalAttended: 0,\r\n        attendancePercentage: 0,\r\n        status: 'Unknown'\r\n      },\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const studentFetchCourseAttendance = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseAttendance = await Promise.all(\r\n      (enrollments || []).map(async (enrollment) => {\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id')\r\n          .eq('course_id', enrollment.course_id);\r\n\r\n        const { data: sessions } = await supabase\r\n          .from('sessions')\r\n          .select('id')\r\n          .in('class_id', (classes || []).map(c => c.id));\r\n\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('student_id', studentId)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const totalSessions = (sessions || []).length;\r\n        const percentage = totalSessions > 0 ? Math.round((attendanceCount / totalSessions) * 100) : 0;\r\n\r\n        return {\r\n          courseCode: enrollment.courses?.course_code,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseId: enrollment.course_id,\r\n          totalSessions,\r\n          attended: attendanceCount || 0,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAlerts = async (studentId) => {\r\n  try {\r\n    const alerts = [];\r\n    const threshold = 75;\r\n\r\n    const { data: enrollments } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (course_code, course_title)\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id')\r\n        .eq('course_id', enrollment.course_id);\r\n\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (classes || []).map(c => c.id));\r\n\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          message: `Your attendance in ${enrollment.courses?.course_title} is ${Math.round(percentage)}%. You may face academic penalties.`,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseCode: enrollment.courses?.course_code,\r\n          percentage: Math.round(percentage)\r\n        });\r\n      }\r\n    }\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// COURSE MANAGEMENT\r\n// ============================================\r\n\r\nexport const createCourse = async (courseData) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('courses')\r\n      .insert({\r\n        course_code: courseData.courseCode,\r\n        course_title: courseData.courseTitle,\r\n        program: courseData.program,\r\n        year_level: courseData.yearLevel,\r\n        instructor: courseData.instructor,\r\n        course_status: 'scheduled'\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { course: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating course:', error);\r\n    return { course: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const createDelegate = async (delegateData) => {\r\n  try {\r\n    // NOTE: Creating delegates requires admin privileges to create auth users first.\r\n    // This is a limitation when using client-side Supabase without service role.\r\n    // For production, this should be done server-side or with proper auth setup.\r\n\r\n    alert('Creating delegates requires admin setup. Please use the setup script or contact administrator to add delegates.');\r\n    return { delegate: null, error: 'Admin privileges required for user creation' };\r\n  } catch (error) {\r\n    console.error('Error creating delegate:', error);\r\n    return { delegate: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllClasses = async () => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        delegate_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        ),\r\n        users!delegate_id (\r\n          id,\r\n          name\r\n        )\r\n      `);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      classes: (classes || []).map(cls => ({\r\n        id: cls.id,\r\n        className: cls.class_name,\r\n        courseCode: cls.courses?.course_code,\r\n        courseTitle: cls.courses?.course_title,\r\n        delegateId: cls.delegate_id,\r\n        delegateName: cls.users?.name\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllStudents = async () => {\r\n  try {\r\n    const { data: students, error } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      students: (students || []).map(student => ({\r\n        id: student.id,\r\n        name: student.name,\r\n        matricule: student.matricule\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all students:', error);\r\n    return { students: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllCourses = async () => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title, program, year_level');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (courses || []).map(course => ({\r\n        id: course.id,\r\n        courseCode: course.course_code,\r\n        courseTitle: course.course_title,\r\n        program: course.program,\r\n        yearLevel: course.year_level\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAllDelegates = async () => {\r\n  try {\r\n    const { data: delegates, error } = await supabase\r\n      .from('users')\r\n      .select('id, name')\r\n      .eq('role', 'delegate');\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      delegates: (delegates || []).map(delegate => ({\r\n        id: delegate.id,\r\n        name: delegate.name\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching all delegates:', error);\r\n    return { delegates: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const promoteStudentToDelegate = async (studentId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('users')\r\n      .update({ role: 'delegate' })\r\n      .eq('id', studentId)\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { delegate: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error promoting student to delegate:', error);\r\n    return { delegate: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// SESSION MANAGEMENT\r\n// ============================================\r\n\r\nexport const createSession = async (courseId, delegateId, sessionDate, startTime, endTime) => {\r\n  try {\r\n    // First, find or create the class for this course and delegate\r\n    let { data: existingClass, error: classError } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .eq('course_id', courseId)\r\n      .eq('delegate_id', delegateId)\r\n      .single();\r\n\r\n    let classId;\r\n    if (classError && classError.code === 'PGRST116') { // No rows returned\r\n      // Create new class\r\n      const { data: course, error: courseError } = await supabase\r\n        .from('courses')\r\n        .select('course_title')\r\n        .eq('id', courseId)\r\n        .single();\r\n\r\n      if (courseError) throw courseError;\r\n\r\n      const { data: newClass, error: createClassError } = await supabase\r\n        .from('classes')\r\n        .insert({\r\n          class_name: course.course_title,\r\n          course_id: courseId,\r\n          delegate_id: delegateId\r\n        })\r\n        .select('id')\r\n        .single();\r\n\r\n      if (createClassError) throw createClassError;\r\n      classId = newClass.id;\r\n    } else if (classError) {\r\n      throw classError;\r\n    } else {\r\n      classId = existingClass.id;\r\n    }\r\n\r\n    // Generate a unique token\r\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\r\n\r\n    // Calculate expires_at (1 hour after end time) in UTC\r\n    const [endHour, endMin] = endTime.split(':');\r\n    const endDateTimeCameroon = new Date(sessionDate);\r\n    endDateTimeCameroon.setHours(parseInt(endHour), parseInt(endMin), 0, 0);\r\n    const expiresAt = new Date(endDateTimeCameroon.getTime() + (60 * 60 * 1000) - (1 * 60 * 60 * 1000)); // Add 1 hour, then convert Cameroon to UTC\r\n\r\n    const { data, error } = await supabase\r\n      .from('sessions')\r\n      .insert({\r\n        class_id: classId,\r\n        session_date: sessionDate,\r\n        start_time: startTime,\r\n        end_time: endTime,\r\n        token,\r\n        expires_at: expiresAt.toISOString()\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { session: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating session:', error);\r\n    return { session: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const markAttendance = async (studentId, sessionId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('attendance')\r\n      .insert({\r\n        student_id: studentId,\r\n        session_id: sessionId\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { success: true, attendance: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error marking attendance:', error);\r\n    return { success: false, attendance: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// ATTENDANCE HISTORY & EXPORT QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchAttendanceHistory = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id, courses!inner(id, course_code, course_title)')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const history = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const courseId = enrollment.course_id;\r\n      const courseName = enrollment.courses?.course_title || '';\r\n      const courseCode = enrollment.courses?.course_code || '';\r\n\r\n      // Get classes for this course\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id, class_name')\r\n        .eq('course_id', courseId);\r\n\r\n      const classIds = (classes || []).map(c => c.id);\r\n\r\n      // Get all sessions for these classes\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n        .in('class_id', classIds)\r\n        .order('session_date', { ascending: false });\r\n\r\n      // Get attendance records for this student in these sessions\r\n      const { data: attendance } = await supabase\r\n        .from('attendance')\r\n        .select('id, session_id, created_at')\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const attendanceMap = new Set((attendance || []).map(a => a.session_id));\r\n\r\n      // Create history records\r\n      for (const session of (sessions || [])) {\r\n        const classInfo = classes?.find(c => c.id === session.class_id);\r\n        history.push({\r\n          courseCode,\r\n          courseName,\r\n          className: classInfo?.class_name || 'Unknown',\r\n          sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: attendanceMap.has(session.id) ? 'Present' : 'Absent',\r\n          sessionId: session.id\r\n        });\r\n      }\r\n    }\r\n\r\n    // Calculate per-course statistics\r\n    const courseStats = {};\r\n    for (const record of history) {\r\n      if (!courseStats[record.courseCode]) {\r\n        courseStats[record.courseCode] = {\r\n          courseCode: record.courseCode,\r\n          courseName: record.courseName,\r\n          totalSessions: 0,\r\n          attended: 0,\r\n          percentage: 0\r\n        };\r\n      }\r\n      courseStats[record.courseCode].totalSessions++;\r\n      if (record.status === 'Present') {\r\n        courseStats[record.courseCode].attended++;\r\n      }\r\n    }\r\n\r\n    // Calculate percentages\r\n    for (const key in courseStats) {\r\n      const stat = courseStats[key];\r\n      stat.percentage = stat.totalSessions > 0\r\n        ? Math.round((stat.attended / stat.totalSessions) * 100)\r\n        : 0;\r\n    }\r\n\r\n    return {\r\n      history: history.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate)),\r\n      courseStats: Object.values(courseStats),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance history:', error);\r\n    return { history: [], courseStats: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceExportData = async (filters = {}) => {\r\n  try {\r\n    // Fetch all students\r\n    const { data: students, error: studentError } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (studentError) throw studentError;\r\n\r\n    const exportData = [];\r\n\r\n    for (const student of (students || [])) {\r\n      // Get student's enrollments\r\n      const { data: enrollments } = await supabase\r\n        .from('enrollments')\r\n        .select('course_id, courses!inner(id, course_code, course_title)')\r\n        .eq('student_id', student.id);\r\n\r\n      for (const enrollment of (enrollments || [])) {\r\n        // Apply course filter if provided\r\n        if (filters.courseCode && enrollment.courses?.course_code !== filters.courseCode) {\r\n          continue;\r\n        }\r\n\r\n        const courseId = enrollment.course_id;\r\n\r\n        // Get classes for this course\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id, class_name')\r\n          .eq('course_id', courseId);\r\n\r\n        const classIds = (classes || []).map(c => c.id);\r\n\r\n        // Get sessions\r\n        let sessionsQuery = supabase\r\n          .from('sessions')\r\n          .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n          .in('class_id', classIds);\r\n\r\n        // Apply date range filter if provided\r\n        if (filters.startDate) {\r\n          sessionsQuery = sessionsQuery.gte('session_date', filters.startDate);\r\n        }\r\n        if (filters.endDate) {\r\n          sessionsQuery = sessionsQuery.lte('session_date', filters.endDate);\r\n        }\r\n\r\n        const { data: sessions } = await sessionsQuery.order('session_date', { ascending: false });\r\n\r\n        // Get attendance records\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id, session_id, created_at')\r\n          .eq('student_id', student.id)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const attendanceMap = new Map(\r\n          (attendance || []).map(a => [a.session_id, true])\r\n        );\r\n\r\n        // Create export records\r\n        for (const session of (sessions || [])) {\r\n          const classInfo = classes?.find(c => c.id === session.class_id);\r\n          exportData.push({\r\n            studentName: student.name,\r\n            studentId: student.matricule,\r\n            course: enrollment.courses?.course_code,\r\n            courseName: enrollment.courses?.course_title,\r\n            class: classInfo?.class_name || 'Unknown',\r\n            sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n            sessionTime: `${session.start_time} - ${session.end_time}`,\r\n            status: attendanceMap.has(session.id) ? 'Present' : 'Absent'\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return { data: exportData, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching export data:', error);\r\n    return { data: [], error: error.message };\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}