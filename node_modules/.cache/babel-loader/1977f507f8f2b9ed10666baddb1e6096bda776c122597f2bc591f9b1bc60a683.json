{"ast":null,"code":"import{supabase}from'../supabase/supabase';// ============================================\n// ADMIN DASHBOARD QUERIES\n// ============================================\nexport const adminFetchStats=async()=>{try{const[{count:studentCount,error:studentError},{count:delegateCount,error:delegateError},{count:courseCount,error:courseError},{count:classCount,error:classError}]=await Promise.all([supabase.from('users').select('id',{count:'exact'}).eq('role','student'),supabase.from('users').select('id',{count:'exact'}).eq('role','delegate'),supabase.from('courses').select('id',{count:'exact'}),supabase.from('classes').select('id',{count:'exact'})]);const today=new Date().toISOString().split('T')[0];const{data:todaySessions,error:sessionsError}=await supabase.from('sessions').select('id').eq('session_date',today);if(studentError||delegateError||courseError||classError||sessionsError){throw new Error('Failed to fetch stats');}return{totalStudents:studentCount||0,totalDelegates:delegateCount||0,totalCourses:courseCount||0,totalClasses:classCount||0,sessionsToday:(todaySessions||[]).length,error:null};}catch(error){console.error('Error fetching admin stats:',error);return{totalStudents:0,totalDelegates:0,totalCourses:0,totalClasses:0,sessionsToday:0,error:error.message};}};export const adminFetchOpenSessions=async()=>{try{const now=new Date();const{data:sessions,error}=await supabase.from('sessions').select(\"\\n        id,\\n        session_date,\\n        start_time,\\n        end_time,\\n        token,\\n        expires_at,\\n        classes!inner (\\n          id,\\n          class_name,\\n          delegate_id,\\n          users!delegate_id (name),\\n          courses!inner (course_code, course_title)\\n        )\\n      \").order('session_date',{ascending:false}).limit(20);if(error)throw error;// Filter for open sessions\nconst openSessions=(sessions||[]).filter(s=>new Date(s.expires_at)>now).map(session=>{var _session$classes,_session$classes$cour,_session$classes2,_session$classes2$cou,_session$classes3,_session$classes3$use,_session$token;return{id:session.id,className:((_session$classes=session.classes)===null||_session$classes===void 0?void 0:(_session$classes$cour=_session$classes.courses)===null||_session$classes$cour===void 0?void 0:_session$classes$cour.course_title)||'Unknown',courseCode:((_session$classes2=session.classes)===null||_session$classes2===void 0?void 0:(_session$classes2$cou=_session$classes2.courses)===null||_session$classes2$cou===void 0?void 0:_session$classes2$cou.course_code)||'N/A',delegateName:((_session$classes3=session.classes)===null||_session$classes3===void 0?void 0:(_session$classes3$use=_session$classes3.users)===null||_session$classes3$use===void 0?void 0:_session$classes3$use.name)||'Unknown',date:new Date(session.session_date).toLocaleDateString(),startTime:session.start_time,endTime:session.end_time,status:'Open',tokenPreview:((_session$token=session.token)===null||_session$token===void 0?void 0:_session$token.slice(0,8).toUpperCase())||'N/A'};});return{sessions:openSessions,error:null};}catch(error){console.error('Error fetching open sessions:',error);return{sessions:[],error:error.message};}};export const adminFetchCourseAttendance=async function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;try{const{data:courses,error}=await supabase.from('courses').select('id, course_code, course_title').limit(limit);if(error)throw error;const courseStats=await Promise.all((courses||[]).map(async course=>{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('id').eq('course_id',course.id);const{data:sessions,error:sessionsError}=await supabase.from('sessions').select('id',{count:'exact'}).eq('classes.course_id',course.id);const{data:attendance}=await supabase.from('attendance').select('id').in('session_id',(sessions||[]).map(s=>s.id));const enrollmentCount=(enrollments||[]).length;const totalAttendance=(attendance||[]).length;const percentage=enrollmentCount>0?Math.round(totalAttendance/enrollmentCount*100):0;return{id:course.id,courseCode:course.course_code,courseTitle:course.course_title,enrolledStudents:enrollmentCount,totalAttendance,attendancePercentage:percentage,status:percentage>=80?'Good':percentage>=60?'Fair':'Low'};}));return{courseAttendance:courseStats,error:null};}catch(error){console.error('Error fetching course attendance:',error);return{courseAttendance:[],error:error.message};}};export const adminFetchAttendanceAlerts=async()=>{try{const threshold=75;// 75% attendance threshold\nconst{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('student_id, course_id');if(enrollError)throw enrollError;const alerts=[];for(const enrollment of enrollments||[]){var _await$supabase$from$;// Get sessions for this course\nconst{data:sessions}=await supabase.from('sessions').select('id').in('class_id',((_await$supabase$from$=(await supabase.from('classes').select('id').eq('course_id',enrollment.course_id)).data)===null||_await$supabase$from$===void 0?void 0:_await$supabase$from$.map(c=>c.id))||[]);// Count attendance for this student in these sessions\nconst{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('student_id',enrollment.student_id).in('session_id',(sessions||[]).map(s=>s.id));const percentage=((sessions===null||sessions===void 0?void 0:sessions.length)||0)>0?attendanceCount/sessions.length*100:0;if(percentage<threshold){const{data:student}=await supabase.from('users').select('name, matricule').eq('id',enrollment.student_id).single();const{data:course}=await supabase.from('courses').select('course_title, course_code').eq('id',enrollment.course_id).single();alerts.push({type:'low-attendance',severity:percentage<60?'critical':'warning',studentName:(student===null||student===void 0?void 0:student.name)||'Unknown',studentId:enrollment.student_id,courseTitle:(course===null||course===void 0?void 0:course.course_title)||'Unknown',courseCode:(course===null||course===void 0?void 0:course.course_code)||'N/A',attendance:\"\".concat(Math.round(percentage),\"%\"),message:\"\".concat((student===null||student===void 0?void 0:student.name)||'Student',\" has \").concat(Math.round(percentage),\"% attendance in \").concat((course===null||course===void 0?void 0:course.course_title)||'Course')});}}// Check for expired sessions\nconst{data:expiredSessions}=await supabase.from('sessions').select('id, expires_at, classes!inner(class_name)').lt('expires_at',new Date().toISOString());(expiredSessions||[]).forEach(session=>{var _session$classes4;alerts.push({type:'expired-session',severity:'warning',message:\"Session for \".concat(((_session$classes4=session.classes)===null||_session$classes4===void 0?void 0:_session$classes4.class_name)||'Class',\" was left open beyond allowed time\"),sessionId:session.id});});return{alerts,error:null};}catch(error){console.error('Error fetching alerts:',error);return{alerts:[],error:error.message};}};// ============================================\n// DELEGATE DASHBOARD QUERIES\n// ============================================\nexport const delegateFetchAssignedClasses=async delegateId=>{try{const{data:classes,error}=await supabase.from('classes').select(\"\\n        id,\\n        class_name,\\n        course_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title,\\n          program\\n        )\\n      \").eq('delegate_id',delegateId);if(error)throw error;const classesWithSessions=await Promise.all((classes||[]).map(async cls=>{var _cls$courses,_cls$courses2,_cls$courses3;const today=new Date().toISOString().split('T')[0];const{data:todaySession}=await supabase.from('sessions').select('id, status, start_time, end_time').eq('class_id',cls.id).eq('session_date',today).limit(1);return{id:cls.id,className:cls.class_name,courseCode:(_cls$courses=cls.courses)===null||_cls$courses===void 0?void 0:_cls$courses.course_code,courseTitle:(_cls$courses2=cls.courses)===null||_cls$courses2===void 0?void 0:_cls$courses2.course_title,program:(_cls$courses3=cls.courses)===null||_cls$courses3===void 0?void 0:_cls$courses3.program,sessionToday:(todaySession||[]).length>0?'Open':'None',hasActiveSession:(todaySession||[]).length>0};}));return{classes:classesWithSessions,error:null};}catch(error){console.error('Error fetching assigned classes:',error);return{classes:[],error:error.message};}};export const delegateFetchSessions=async delegateId=>{try{var _await$supabase$from$2;const{data:sessions,error}=await supabase.from('sessions').select(\"\\n        id,\\n        session_date,\\n        start_time,\\n        end_time,\\n        token,\\n        expires_at,\\n        classes!inner (\\n          id,\\n          class_name,\\n          courses!inner (course_code, course_title)\\n        )\\n      \").in('class_id',((_await$supabase$from$2=(await supabase.from('classes').select('id').eq('delegate_id',delegateId)).data)===null||_await$supabase$from$2===void 0?void 0:_await$supabase$from$2.map(c=>c.id))||[]).order('session_date',{ascending:false}).limit(50);if(error)throw error;const enrichedSessions=await Promise.all((sessions||[]).map(async session=>{var _session$classes5,_session$classes6,_session$classes6$cou,_session$classes7,_session$classes7$cou;const{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('session_id',session.id);return{id:session.id,className:(_session$classes5=session.classes)===null||_session$classes5===void 0?void 0:_session$classes5.class_name,courseTitle:(_session$classes6=session.classes)===null||_session$classes6===void 0?void 0:(_session$classes6$cou=_session$classes6.courses)===null||_session$classes6$cou===void 0?void 0:_session$classes6$cou.course_title,courseCode:(_session$classes7=session.classes)===null||_session$classes7===void 0?void 0:(_session$classes7$cou=_session$classes7.courses)===null||_session$classes7$cou===void 0?void 0:_session$classes7$cou.course_code,date:new Date(session.session_date).toLocaleDateString(),startTime:session.start_time,endTime:session.end_time,status:new Date(session.expires_at)>new Date()?'Open':'Closed',attendanceCount:attendanceCount||0,token:session.token};}));return{sessions:enrichedSessions,error:null};}catch(error){console.error('Error fetching sessions:',error);return{sessions:[],error:error.message};}};export const delegateFetchSessionAttendance=async sessionId=>{try{const{data:attendance,error}=await supabase.from('attendance').select(\"\\n        id,\\n        created_at,\\n        users!student_id (\\n          id,\\n          name,\\n          matricule\\n        )\\n      \").eq('session_id',sessionId);if(error)throw error;return{attendance:(attendance||[]).map(a=>{var _a$users,_a$users2;return{id:a.id,studentName:(_a$users=a.users)===null||_a$users===void 0?void 0:_a$users.name,studentMatricule:(_a$users2=a.users)===null||_a$users2===void 0?void 0:_a$users2.matricule,timestamp:new Date(a.created_at).toLocaleTimeString(),status:'Present'};}),error:null};}catch(error){console.error('Error fetching session attendance:',error);return{attendance:[],error:error.message};}};export const delegateFetchStats=async delegateId=>{try{const{data:classes}=await supabase.from('classes').select('id').eq('delegate_id',delegateId);const classIds=(classes||[]).map(c=>c.id);const{data:sessions}=await supabase.from('sessions').select('id, expires_at').in('class_id',classIds);const now=new Date();const activeSessions=(sessions||[]).filter(s=>new Date(s.expires_at)>now);const{count:totalAttendance}=await supabase.from('attendance').select('id',{count:'exact'}).in('session_id',(sessions||[]).map(s=>s.id));const today=new Date().toISOString().split('T')[0];const{data:todaySessions}=await supabase.from('sessions').select('id').in('class_id',classIds).eq('session_date',today);return{activeSessions:activeSessions.length,totalSessions:(sessions===null||sessions===void 0?void 0:sessions.length)||0,totalMarked:totalAttendance||0,todaySessions:(todaySessions||[]).length,error:null};}catch(error){console.error('Error fetching delegate stats:',error);return{activeSessions:0,totalSessions:0,totalMarked:0,todaySessions:0,error:error.message};}};// ============================================\n// STUDENT DASHBOARD QUERIES\n// ============================================\nexport const studentFetchEnrolledCourses=async studentId=>{try{const{data:enrollments,error}=await supabase.from('enrollments').select(\"\\n        id,\\n        course_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title,\\n          program,\\n          year_level\\n        )\\n      \").eq('student_id',studentId);if(error)throw error;return{courses:(enrollments||[]).map(e=>{var _e$courses,_e$courses2,_e$courses3,_e$courses4,_e$courses5;return{id:(_e$courses=e.courses)===null||_e$courses===void 0?void 0:_e$courses.id,courseCode:(_e$courses2=e.courses)===null||_e$courses2===void 0?void 0:_e$courses2.course_code,courseTitle:(_e$courses3=e.courses)===null||_e$courses3===void 0?void 0:_e$courses3.course_title,program:(_e$courses4=e.courses)===null||_e$courses4===void 0?void 0:_e$courses4.program,yearLevel:(_e$courses5=e.courses)===null||_e$courses5===void 0?void 0:_e$courses5.year_level,enrollmentId:e.id};}),error:null};}catch(error){console.error('Error fetching enrolled courses:',error);return{courses:[],error:error.message};}};export const studentFetchActiveSessions=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('course_id').eq('student_id',studentId);if(enrollError)throw enrollError;const courseIds=(enrollments||[]).map(e=>e.course_id);const{data:classes}=await supabase.from('classes').select('id').in('course_id',courseIds);const classIds=(classes||[]).map(c=>c.id);const now=new Date();const{data:sessions,error:sessionError}=await supabase.from('sessions').select(\"\\n        id,\\n        session_date,\\n        start_time,\\n        end_time,\\n        expires_at,\\n        token,\\n        classes!inner (\\n          id,\\n          class_name,\\n          delegate_id,\\n          users!delegate_id (name),\\n          courses!inner (course_code, course_title)\\n        )\\n      \").in('class_id',classIds).gt('expires_at',now.toISOString());if(sessionError)throw sessionError;// Check which sessions student has already marked\nconst{data:studentAttendance}=await supabase.from('attendance').select('session_id').eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const markedSessionIds=(studentAttendance||[]).map(a=>a.session_id);return{sessions:(sessions||[]).map(s=>{var _s$classes,_s$classes$courses,_s$classes2,_s$classes2$courses,_s$classes3,_s$classes4,_s$classes4$users;return{id:s.id,courseCode:(_s$classes=s.classes)===null||_s$classes===void 0?void 0:(_s$classes$courses=_s$classes.courses)===null||_s$classes$courses===void 0?void 0:_s$classes$courses.course_code,courseTitle:(_s$classes2=s.classes)===null||_s$classes2===void 0?void 0:(_s$classes2$courses=_s$classes2.courses)===null||_s$classes2$courses===void 0?void 0:_s$classes2$courses.course_title,className:(_s$classes3=s.classes)===null||_s$classes3===void 0?void 0:_s$classes3.class_name,delegateName:(_s$classes4=s.classes)===null||_s$classes4===void 0?void 0:(_s$classes4$users=_s$classes4.users)===null||_s$classes4$users===void 0?void 0:_s$classes4$users.name,date:new Date(s.session_date).toLocaleDateString(),startTime:s.start_time,endTime:s.end_time,token:s.token,isMarked:markedSessionIds.includes(s.id),status:'Open'};}),error:null};}catch(error){console.error('Error fetching active sessions:',error);return{sessions:[],error:error.message};}};export const studentFetchAttendanceSummary=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('course_id').eq('student_id',studentId);if(enrollError)throw enrollError;const courseIds=(enrollments||[]).map(e=>e.course_id);const{data:classes}=await supabase.from('classes').select('id').in('course_id',courseIds);const classIds=(classes||[]).map(c=>c.id);const{data:sessions}=await supabase.from('sessions').select('id').in('class_id',classIds);const{data:attendance}=await supabase.from('attendance').select('id').eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const totalSessions=(sessions||[]).length;const totalAttended=(attendance||[]).length;const percentage=totalSessions>0?Math.round(totalAttended/totalSessions*100):0;return{summary:{totalSessions,totalAttended,attendancePercentage:percentage,status:percentage>=80?'Good':percentage>=60?'Fair':'Low'},error:null};}catch(error){console.error('Error fetching attendance summary:',error);return{summary:{totalSessions:0,totalAttended:0,attendancePercentage:0,status:'Unknown'},error:error.message};}};export const studentFetchCourseAttendance=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select(\"\\n        course_id,\\n        courses!inner (\\n          id,\\n          course_code,\\n          course_title\\n        )\\n      \").eq('student_id',studentId);if(enrollError)throw enrollError;const courseAttendance=await Promise.all((enrollments||[]).map(async enrollment=>{var _enrollment$courses,_enrollment$courses2;const{data:classes}=await supabase.from('classes').select('id').eq('course_id',enrollment.course_id);const{data:sessions}=await supabase.from('sessions').select('id').in('class_id',(classes||[]).map(c=>c.id));const{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const totalSessions=(sessions||[]).length;const percentage=totalSessions>0?Math.round(attendanceCount/totalSessions*100):0;return{courseCode:(_enrollment$courses=enrollment.courses)===null||_enrollment$courses===void 0?void 0:_enrollment$courses.course_code,courseTitle:(_enrollment$courses2=enrollment.courses)===null||_enrollment$courses2===void 0?void 0:_enrollment$courses2.course_title,courseId:enrollment.course_id,totalSessions,attended:attendanceCount||0,attendancePercentage:percentage,status:percentage>=80?'Good':percentage>=60?'Fair':'Low'};}));return{courseAttendance,error:null};}catch(error){console.error('Error fetching course attendance:',error);return{courseAttendance:[],error:error.message};}};export const studentFetchAlerts=async studentId=>{try{const alerts=[];const threshold=75;const{data:enrollments}=await supabase.from('enrollments').select(\"\\n        course_id,\\n        courses!inner (course_code, course_title)\\n      \").eq('student_id',studentId);for(const enrollment of enrollments||[]){const{data:classes}=await supabase.from('classes').select('id').eq('course_id',enrollment.course_id);const{data:sessions}=await supabase.from('sessions').select('id').in('class_id',(classes||[]).map(c=>c.id));const{count:attendanceCount}=await supabase.from('attendance').select('id',{count:'exact'}).eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const percentage=((sessions===null||sessions===void 0?void 0:sessions.length)||0)>0?attendanceCount/sessions.length*100:0;if(percentage<threshold){var _enrollment$courses3,_enrollment$courses4,_enrollment$courses5;alerts.push({type:'low-attendance',severity:percentage<60?'critical':'warning',message:\"Your attendance in \".concat((_enrollment$courses3=enrollment.courses)===null||_enrollment$courses3===void 0?void 0:_enrollment$courses3.course_title,\" is \").concat(Math.round(percentage),\"%. You may face academic penalties.\"),courseTitle:(_enrollment$courses4=enrollment.courses)===null||_enrollment$courses4===void 0?void 0:_enrollment$courses4.course_title,courseCode:(_enrollment$courses5=enrollment.courses)===null||_enrollment$courses5===void 0?void 0:_enrollment$courses5.course_code,percentage:Math.round(percentage)});}}return{alerts,error:null};}catch(error){console.error('Error fetching alerts:',error);return{alerts:[],error:error.message};}};// ============================================\n// SESSION MANAGEMENT\n// ============================================\nexport const createSession=async(delegateId,classId,sessionDate,startTime,endTime)=>{try{// Generate a unique token\nconst token=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);// Calculate expires_at (30 minutes after end time)\nconst[endHour,endMin]=endTime.split(':');const expiresAt=new Date(sessionDate);expiresAt.setHours(parseInt(endHour)+1,parseInt(endMin),0);const{data,error}=await supabase.from('sessions').insert({class_id:classId,session_date:sessionDate,start_time:startTime,end_time:endTime,token,expires_at:expiresAt.toISOString()}).select();if(error)throw error;return{session:data===null||data===void 0?void 0:data[0],error:null};}catch(error){console.error('Error creating session:',error);return{session:null,error:error.message};}};export const markAttendance=async(studentId,sessionId)=>{try{const{data,error}=await supabase.from('attendance').insert({student_id:studentId,session_id:sessionId}).select();if(error)throw error;return{success:true,attendance:data===null||data===void 0?void 0:data[0],error:null};}catch(error){console.error('Error marking attendance:',error);return{success:false,attendance:null,error:error.message};}};// ============================================\n// ATTENDANCE HISTORY & EXPORT QUERIES\n// ============================================\nexport const studentFetchAttendanceHistory=async studentId=>{try{const{data:enrollments,error:enrollError}=await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id',studentId);if(enrollError)throw enrollError;const history=[];for(const enrollment of enrollments||[]){var _enrollment$courses6,_enrollment$courses7;const courseId=enrollment.course_id;const courseName=((_enrollment$courses6=enrollment.courses)===null||_enrollment$courses6===void 0?void 0:_enrollment$courses6.course_title)||'';const courseCode=((_enrollment$courses7=enrollment.courses)===null||_enrollment$courses7===void 0?void 0:_enrollment$courses7.course_code)||'';// Get classes for this course\nconst{data:classes}=await supabase.from('classes').select('id, class_name').eq('course_id',courseId);const classIds=(classes||[]).map(c=>c.id);// Get all sessions for these classes\nconst{data:sessions}=await supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id',classIds).order('session_date',{ascending:false});// Get attendance records for this student in these sessions\nconst{data:attendance}=await supabase.from('attendance').select('id, session_id, created_at').eq('student_id',studentId).in('session_id',(sessions||[]).map(s=>s.id));const attendanceMap=new Set((attendance||[]).map(a=>a.session_id));// Create history records\nfor(const session of sessions||[]){const classInfo=classes===null||classes===void 0?void 0:classes.find(c=>c.id===session.class_id);history.push({courseCode,courseName,className:(classInfo===null||classInfo===void 0?void 0:classInfo.class_name)||'Unknown',sessionDate:new Date(session.session_date).toLocaleDateString(),startTime:session.start_time,endTime:session.end_time,status:attendanceMap.has(session.id)?'Present':'Absent',sessionId:session.id});}}// Calculate per-course statistics\nconst courseStats={};for(const record of history){if(!courseStats[record.courseCode]){courseStats[record.courseCode]={courseCode:record.courseCode,courseName:record.courseName,totalSessions:0,attended:0,percentage:0};}courseStats[record.courseCode].totalSessions++;if(record.status==='Present'){courseStats[record.courseCode].attended++;}}// Calculate percentages\nfor(const key in courseStats){const stat=courseStats[key];stat.percentage=stat.totalSessions>0?Math.round(stat.attended/stat.totalSessions*100):0;}return{history:history.sort((a,b)=>new Date(b.sessionDate)-new Date(a.sessionDate)),courseStats:Object.values(courseStats),error:null};}catch(error){console.error('Error fetching attendance history:',error);return{history:[],courseStats:[],error:error.message};}};export const adminFetchAttendanceExportData=async function(){let filters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};try{// Fetch all students\nconst{data:students,error:studentError}=await supabase.from('users').select('id, name, matricule').eq('role','student');if(studentError)throw studentError;const exportData=[];for(const student of students||[]){// Get student's enrollments\nconst{data:enrollments}=await supabase.from('enrollments').select('course_id, courses!inner(id, course_code, course_title)').eq('student_id',student.id);for(const enrollment of enrollments||[]){var _enrollment$courses8;// Apply course filter if provided\nif(filters.courseCode&&((_enrollment$courses8=enrollment.courses)===null||_enrollment$courses8===void 0?void 0:_enrollment$courses8.course_code)!==filters.courseCode){continue;}const courseId=enrollment.course_id;// Get classes for this course\nconst{data:classes}=await supabase.from('classes').select('id, class_name').eq('course_id',courseId);const classIds=(classes||[]).map(c=>c.id);// Get sessions\nlet sessionsQuery=supabase.from('sessions').select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)').in('class_id',classIds);// Apply date range filter if provided\nif(filters.startDate){sessionsQuery=sessionsQuery.gte('session_date',filters.startDate);}if(filters.endDate){sessionsQuery=sessionsQuery.lte('session_date',filters.endDate);}const{data:sessions}=await sessionsQuery.order('session_date',{ascending:false});// Get attendance records\nconst{data:attendance}=await supabase.from('attendance').select('id, session_id, created_at').eq('student_id',student.id).in('session_id',(sessions||[]).map(s=>s.id));const attendanceMap=new Map((attendance||[]).map(a=>[a.session_id,true]));// Create export records\nfor(const session of sessions||[]){var _enrollment$courses9,_enrollment$courses0;const classInfo=classes===null||classes===void 0?void 0:classes.find(c=>c.id===session.class_id);exportData.push({studentName:student.name,studentId:student.matricule,course:(_enrollment$courses9=enrollment.courses)===null||_enrollment$courses9===void 0?void 0:_enrollment$courses9.course_code,courseName:(_enrollment$courses0=enrollment.courses)===null||_enrollment$courses0===void 0?void 0:_enrollment$courses0.course_title,class:(classInfo===null||classInfo===void 0?void 0:classInfo.class_name)||'Unknown',sessionDate:new Date(session.session_date).toLocaleDateString(),sessionTime:\"\".concat(session.start_time,\" - \").concat(session.end_time),status:attendanceMap.has(session.id)?'Present':'Absent'});}}}return{data:exportData,error:null};}catch(error){console.error('Error fetching export data:',error);return{data:[],error:error.message};}};","map":{"version":3,"names":["supabase","adminFetchStats","count","studentCount","error","studentError","delegateCount","delegateError","courseCount","courseError","classCount","classError","Promise","all","from","select","eq","today","Date","toISOString","split","data","todaySessions","sessionsError","Error","totalStudents","totalDelegates","totalCourses","totalClasses","sessionsToday","length","console","message","adminFetchOpenSessions","now","sessions","order","ascending","limit","openSessions","filter","s","expires_at","map","session","_session$classes","_session$classes$cour","_session$classes2","_session$classes2$cou","_session$classes3","_session$classes3$use","_session$token","id","className","classes","courses","course_title","courseCode","course_code","delegateName","users","name","date","session_date","toLocaleDateString","startTime","start_time","endTime","end_time","status","tokenPreview","token","slice","toUpperCase","adminFetchCourseAttendance","arguments","undefined","courseStats","course","enrollments","enrollError","attendance","in","enrollmentCount","totalAttendance","percentage","Math","round","courseTitle","enrolledStudents","attendancePercentage","courseAttendance","adminFetchAttendanceAlerts","threshold","alerts","enrollment","_await$supabase$from$","course_id","c","attendanceCount","student_id","student","single","push","type","severity","studentName","studentId","concat","expiredSessions","lt","forEach","_session$classes4","class_name","sessionId","delegateFetchAssignedClasses","delegateId","classesWithSessions","cls","_cls$courses","_cls$courses2","_cls$courses3","todaySession","program","sessionToday","hasActiveSession","delegateFetchSessions","_await$supabase$from$2","enrichedSessions","_session$classes5","_session$classes6","_session$classes6$cou","_session$classes7","_session$classes7$cou","delegateFetchSessionAttendance","a","_a$users","_a$users2","studentMatricule","matricule","timestamp","created_at","toLocaleTimeString","delegateFetchStats","classIds","activeSessions","totalSessions","totalMarked","studentFetchEnrolledCourses","e","_e$courses","_e$courses2","_e$courses3","_e$courses4","_e$courses5","yearLevel","year_level","enrollmentId","studentFetchActiveSessions","courseIds","sessionError","gt","studentAttendance","markedSessionIds","session_id","_s$classes","_s$classes$courses","_s$classes2","_s$classes2$courses","_s$classes3","_s$classes4","_s$classes4$users","isMarked","includes","studentFetchAttendanceSummary","totalAttended","summary","studentFetchCourseAttendance","_enrollment$courses","_enrollment$courses2","courseId","attended","studentFetchAlerts","_enrollment$courses3","_enrollment$courses4","_enrollment$courses5","createSession","classId","sessionDate","random","toString","substring","endHour","endMin","expiresAt","setHours","parseInt","insert","class_id","markAttendance","success","studentFetchAttendanceHistory","history","_enrollment$courses6","_enrollment$courses7","courseName","attendanceMap","Set","classInfo","find","has","record","key","stat","sort","b","Object","values","adminFetchAttendanceExportData","filters","students","exportData","_enrollment$courses8","sessionsQuery","startDate","gte","endDate","lte","Map","_enrollment$courses9","_enrollment$courses0","class","sessionTime"],"sources":["C:/Users/PFI/Desktop/ATTENDANCE/ATTENDANCE/src/utils/dashboardQueries.js"],"sourcesContent":["                                                                                         import { supabase } from '../supabase/supabase';\r\n\r\n// ============================================\r\n// ADMIN DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const adminFetchStats = async () => {\r\n  try {\r\n    const [\r\n      { count: studentCount, error: studentError },\r\n      { count: delegateCount, error: delegateError },\r\n      { count: courseCount, error: courseError },\r\n      { count: classCount, error: classError }\r\n    ] = await Promise.all([\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'student'),\r\n      supabase\r\n        .from('users')\r\n        .select('id', { count: 'exact' })\r\n        .eq('role', 'delegate'),\r\n      supabase\r\n        .from('courses')\r\n        .select('id', { count: 'exact' }),\r\n      supabase\r\n        .from('classes')\r\n        .select('id', { count: 'exact' })\r\n    ]);\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions, error: sessionsError } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .eq('session_date', today);\r\n\r\n    if (studentError || delegateError || courseError || classError || sessionsError) {\r\n      throw new Error('Failed to fetch stats');\r\n    }\r\n\r\n    return {\r\n      totalStudents: studentCount || 0,\r\n      totalDelegates: delegateCount || 0,\r\n      totalCourses: courseCount || 0,\r\n      totalClasses: classCount || 0,\r\n      sessionsToday: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching admin stats:', error);\r\n    return {\r\n      totalStudents: 0,\r\n      totalDelegates: 0,\r\n      totalCourses: 0,\r\n      totalClasses: 0,\r\n      sessionsToday: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const adminFetchOpenSessions = async () => {\r\n  try {\r\n    const now = new Date();\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .order('session_date', { ascending: false })\r\n      .limit(20);\r\n\r\n    if (error) throw error;\r\n\r\n    // Filter for open sessions\r\n    const openSessions = (sessions || [])\r\n      .filter(s => new Date(s.expires_at) > now)\r\n      .map(session => ({\r\n        id: session.id,\r\n        className: session.classes?.courses?.course_title || 'Unknown',\r\n        courseCode: session.classes?.courses?.course_code || 'N/A',\r\n        delegateName: session.classes?.users?.name || 'Unknown',\r\n        date: new Date(session.session_date).toLocaleDateString(),\r\n        startTime: session.start_time,\r\n        endTime: session.end_time,\r\n        status: 'Open',\r\n        tokenPreview: session.token?.slice(0, 8).toUpperCase() || 'N/A'\r\n      }));\r\n\r\n    return { sessions: openSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching open sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchCourseAttendance = async (limit = 10) => {\r\n  try {\r\n    const { data: courses, error } = await supabase\r\n      .from('courses')\r\n      .select('id, course_code, course_title')\r\n      .limit(limit);\r\n\r\n    if (error) throw error;\r\n\r\n    const courseStats = await Promise.all(\r\n      (courses || []).map(async (course) => {\r\n        const { data: enrollments, error: enrollError } = await supabase\r\n          .from('enrollments')\r\n          .select('id')\r\n          .eq('course_id', course.id);\r\n\r\n        const { data: sessions, error: sessionsError } = await supabase\r\n          .from('sessions')\r\n          .select('id', { count: 'exact' })\r\n          .eq('classes.course_id', course.id);\r\n\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id')\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const enrollmentCount = (enrollments || []).length;\r\n        const totalAttendance = (attendance || []).length;\r\n        const percentage = enrollmentCount > 0 ? Math.round((totalAttendance / enrollmentCount) * 100) : 0;\r\n\r\n        return {\r\n          id: course.id,\r\n          courseCode: course.course_code,\r\n          courseTitle: course.course_title,\r\n          enrolledStudents: enrollmentCount,\r\n          totalAttendance,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance: courseStats, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceAlerts = async () => {\r\n  try {\r\n    const threshold = 75; // 75% attendance threshold\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('student_id, course_id');\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const alerts = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      // Get sessions for this course\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (\r\n          await supabase\r\n            .from('classes')\r\n            .select('id')\r\n            .eq('course_id', enrollment.course_id)\r\n        ).data?.map(c => c.id) || []);\r\n\r\n      // Count attendance for this student in these sessions\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', enrollment.student_id)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        const { data: student } = await supabase\r\n          .from('users')\r\n          .select('name, matricule')\r\n          .eq('id', enrollment.student_id)\r\n          .single();\r\n\r\n        const { data: course } = await supabase\r\n          .from('courses')\r\n          .select('course_title, course_code')\r\n          .eq('id', enrollment.course_id)\r\n          .single();\r\n\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          studentName: student?.name || 'Unknown',\r\n          studentId: enrollment.student_id,\r\n          courseTitle: course?.course_title || 'Unknown',\r\n          courseCode: course?.course_code || 'N/A',\r\n          attendance: `${Math.round(percentage)}%`,\r\n          message: `${student?.name || 'Student'} has ${Math.round(percentage)}% attendance in ${course?.course_title || 'Course'}`\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check for expired sessions\r\n    const { data: expiredSessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at, classes!inner(class_name)')\r\n      .lt('expires_at', new Date().toISOString());\r\n\r\n    (expiredSessions || []).forEach(session => {\r\n      alerts.push({\r\n        type: 'expired-session',\r\n        severity: 'warning',\r\n        message: `Session for ${session.classes?.class_name || 'Class'} was left open beyond allowed time`,\r\n        sessionId: session.id\r\n      });\r\n    });\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// DELEGATE DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const delegateFetchAssignedClasses = async (delegateId) => {\r\n  try {\r\n    const { data: classes, error } = await supabase\r\n      .from('classes')\r\n      .select(`\r\n        id,\r\n        class_name,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program\r\n        )\r\n      `)\r\n      .eq('delegate_id', delegateId);\r\n\r\n    if (error) throw error;\r\n\r\n    const classesWithSessions = await Promise.all(\r\n      (classes || []).map(async (cls) => {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const { data: todaySession } = await supabase\r\n          .from('sessions')\r\n          .select('id, status, start_time, end_time')\r\n          .eq('class_id', cls.id)\r\n          .eq('session_date', today)\r\n          .limit(1);\r\n\r\n        return {\r\n          id: cls.id,\r\n          className: cls.class_name,\r\n          courseCode: cls.courses?.course_code,\r\n          courseTitle: cls.courses?.course_title,\r\n          program: cls.courses?.program,\r\n          sessionToday: (todaySession || []).length > 0 ? 'Open' : 'None',\r\n          hasActiveSession: (todaySession || []).length > 0\r\n        };\r\n      })\r\n    );\r\n\r\n    return { classes: classesWithSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching assigned classes:', error);\r\n    return { classes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessions = async (delegateId) => {\r\n  try {\r\n    const { data: sessions, error } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        token,\r\n        expires_at,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .in('class_id', (\r\n        await supabase\r\n          .from('classes')\r\n          .select('id')\r\n          .eq('delegate_id', delegateId)\r\n      ).data?.map(c => c.id) || [])\r\n      .order('session_date', { ascending: false })\r\n      .limit(50);\r\n\r\n    if (error) throw error;\r\n\r\n    const enrichedSessions = await Promise.all(\r\n      (sessions || []).map(async (session) => {\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('session_id', session.id);\r\n\r\n        return {\r\n          id: session.id,\r\n          className: session.classes?.class_name,\r\n          courseTitle: session.classes?.courses?.course_title,\r\n          courseCode: session.classes?.courses?.course_code,\r\n          date: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: new Date(session.expires_at) > new Date() ? 'Open' : 'Closed',\r\n          attendanceCount: attendanceCount || 0,\r\n          token: session.token\r\n        };\r\n      })\r\n    );\r\n\r\n    return { sessions: enrichedSessions, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchSessionAttendance = async (sessionId) => {\r\n  try {\r\n    const { data: attendance, error } = await supabase\r\n      .from('attendance')\r\n      .select(`\r\n        id,\r\n        created_at,\r\n        users!student_id (\r\n          id,\r\n          name,\r\n          matricule\r\n        )\r\n      `)\r\n      .eq('session_id', sessionId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      attendance: (attendance || []).map(a => ({\r\n        id: a.id,\r\n        studentName: a.users?.name,\r\n        studentMatricule: a.users?.matricule,\r\n        timestamp: new Date(a.created_at).toLocaleTimeString(),\r\n        status: 'Present'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching session attendance:', error);\r\n    return { attendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const delegateFetchStats = async (delegateId) => {\r\n  try {\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .eq('delegate_id', delegateId);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: sessions } = await supabase\r\n      .from('sessions')\r\n      .select('id, expires_at')\r\n      .in('class_id', classIds);\r\n\r\n    const now = new Date();\r\n    const activeSessions = (sessions || []).filter(s => new Date(s.expires_at) > now);\r\n\r\n    const { count: totalAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('id', { count: 'exact' })\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const { data: todaySessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds)\r\n      .eq('session_date', today);\r\n\r\n    return {\r\n      activeSessions: activeSessions.length,\r\n      totalSessions: sessions?.length || 0,\r\n      totalMarked: totalAttendance || 0,\r\n      todaySessions: (todaySessions || []).length,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching delegate stats:', error);\r\n    return {\r\n      activeSessions: 0,\r\n      totalSessions: 0,\r\n      totalMarked: 0,\r\n      todaySessions: 0,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// STUDENT DASHBOARD QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchEnrolledCourses = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        id,\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title,\r\n          program,\r\n          year_level\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (error) throw error;\r\n\r\n    return {\r\n      courses: (enrollments || []).map(e => ({\r\n        id: e.courses?.id,\r\n        courseCode: e.courses?.course_code,\r\n        courseTitle: e.courses?.course_title,\r\n        program: e.courses?.program,\r\n        yearLevel: e.courses?.year_level,\r\n        enrollmentId: e.id\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching enrolled courses:', error);\r\n    return { courses: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchActiveSessions = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n    const now = new Date();\r\n\r\n    const { data: sessions, error: sessionError } = await supabase\r\n      .from('sessions')\r\n      .select(`\r\n        id,\r\n        session_date,\r\n        start_time,\r\n        end_time,\r\n        expires_at,\r\n        token,\r\n        classes!inner (\r\n          id,\r\n          class_name,\r\n          delegate_id,\r\n          users!delegate_id (name),\r\n          courses!inner (course_code, course_title)\r\n        )\r\n      `)\r\n      .in('class_id', classIds)\r\n      .gt('expires_at', now.toISOString());\r\n\r\n    if (sessionError) throw sessionError;\r\n\r\n    // Check which sessions student has already marked\r\n    const { data: studentAttendance } = await supabase\r\n      .from('attendance')\r\n      .select('session_id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const markedSessionIds = (studentAttendance || []).map(a => a.session_id);\r\n\r\n    return {\r\n      sessions: (sessions || []).map(s => ({\r\n        id: s.id,\r\n        courseCode: s.classes?.courses?.course_code,\r\n        courseTitle: s.classes?.courses?.course_title,\r\n        className: s.classes?.class_name,\r\n        delegateName: s.classes?.users?.name,\r\n        date: new Date(s.session_date).toLocaleDateString(),\r\n        startTime: s.start_time,\r\n        endTime: s.end_time,\r\n        token: s.token,\r\n        isMarked: markedSessionIds.includes(s.id),\r\n        status: 'Open'\r\n      })),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching active sessions:', error);\r\n    return { sessions: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAttendanceSummary = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseIds = (enrollments || []).map(e => e.course_id);\r\n\r\n    const { data: classes } = await supabase\r\n      .from('classes')\r\n      .select('id')\r\n      .in('course_id', courseIds);\r\n\r\n    const classIds = (classes || []).map(c => c.id);\r\n\r\n    const { data: sessions } = await supabase\r\n      .from('sessions')\r\n      .select('id')\r\n      .in('class_id', classIds);\r\n\r\n    const { data: attendance } = await supabase\r\n      .from('attendance')\r\n      .select('id')\r\n      .eq('student_id', studentId)\r\n      .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n    const totalSessions = (sessions || []).length;\r\n    const totalAttended = (attendance || []).length;\r\n    const percentage = totalSessions > 0 ? Math.round((totalAttended / totalSessions) * 100) : 0;\r\n\r\n    return {\r\n      summary: {\r\n        totalSessions,\r\n        totalAttended,\r\n        attendancePercentage: percentage,\r\n        status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n      },\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance summary:', error);\r\n    return {\r\n      summary: {\r\n        totalSessions: 0,\r\n        totalAttended: 0,\r\n        attendancePercentage: 0,\r\n        status: 'Unknown'\r\n      },\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const studentFetchCourseAttendance = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (\r\n          id,\r\n          course_code,\r\n          course_title\r\n        )\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const courseAttendance = await Promise.all(\r\n      (enrollments || []).map(async (enrollment) => {\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id')\r\n          .eq('course_id', enrollment.course_id);\r\n\r\n        const { data: sessions } = await supabase\r\n          .from('sessions')\r\n          .select('id')\r\n          .in('class_id', (classes || []).map(c => c.id));\r\n\r\n        const { count: attendanceCount } = await supabase\r\n          .from('attendance')\r\n          .select('id', { count: 'exact' })\r\n          .eq('student_id', studentId)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const totalSessions = (sessions || []).length;\r\n        const percentage = totalSessions > 0 ? Math.round((attendanceCount / totalSessions) * 100) : 0;\r\n\r\n        return {\r\n          courseCode: enrollment.courses?.course_code,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseId: enrollment.course_id,\r\n          totalSessions,\r\n          attended: attendanceCount || 0,\r\n          attendancePercentage: percentage,\r\n          status: percentage >= 80 ? 'Good' : percentage >= 60 ? 'Fair' : 'Low'\r\n        };\r\n      })\r\n    );\r\n\r\n    return { courseAttendance, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching course attendance:', error);\r\n    return { courseAttendance: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const studentFetchAlerts = async (studentId) => {\r\n  try {\r\n    const alerts = [];\r\n    const threshold = 75;\r\n\r\n    const { data: enrollments } = await supabase\r\n      .from('enrollments')\r\n      .select(`\r\n        course_id,\r\n        courses!inner (course_code, course_title)\r\n      `)\r\n      .eq('student_id', studentId);\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id')\r\n        .eq('course_id', enrollment.course_id);\r\n\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id')\r\n        .in('class_id', (classes || []).map(c => c.id));\r\n\r\n      const { count: attendanceCount } = await supabase\r\n        .from('attendance')\r\n        .select('id', { count: 'exact' })\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const percentage = (sessions?.length || 0) > 0 ? (attendanceCount / sessions.length) * 100 : 0;\r\n\r\n      if (percentage < threshold) {\r\n        alerts.push({\r\n          type: 'low-attendance',\r\n          severity: percentage < 60 ? 'critical' : 'warning',\r\n          message: `Your attendance in ${enrollment.courses?.course_title} is ${Math.round(percentage)}%. You may face academic penalties.`,\r\n          courseTitle: enrollment.courses?.course_title,\r\n          courseCode: enrollment.courses?.course_code,\r\n          percentage: Math.round(percentage)\r\n        });\r\n      }\r\n    }\r\n\r\n    return { alerts, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching alerts:', error);\r\n    return { alerts: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// SESSION MANAGEMENT\r\n// ============================================\r\n\r\nexport const createSession = async (delegateId, classId, sessionDate, startTime, endTime) => {\r\n  try {\r\n    // Generate a unique token\r\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\r\n\r\n    // Calculate expires_at (30 minutes after end time)\r\n    const [endHour, endMin] = endTime.split(':');\r\n    const expiresAt = new Date(sessionDate);\r\n    expiresAt.setHours(parseInt(endHour) + 1, parseInt(endMin), 0);\r\n\r\n    const { data, error } = await supabase\r\n      .from('sessions')\r\n      .insert({\r\n        class_id: classId,\r\n        session_date: sessionDate,\r\n        start_time: startTime,\r\n        end_time: endTime,\r\n        token,\r\n        expires_at: expiresAt.toISOString()\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { session: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error creating session:', error);\r\n    return { session: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const markAttendance = async (studentId, sessionId) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('attendance')\r\n      .insert({\r\n        student_id: studentId,\r\n        session_id: sessionId\r\n      })\r\n      .select();\r\n\r\n    if (error) throw error;\r\n\r\n    return { success: true, attendance: data?.[0], error: null };\r\n  } catch (error) {\r\n    console.error('Error marking attendance:', error);\r\n    return { success: false, attendance: null, error: error.message };\r\n  }\r\n};\r\n\r\n// ============================================\r\n// ATTENDANCE HISTORY & EXPORT QUERIES\r\n// ============================================\r\n\r\nexport const studentFetchAttendanceHistory = async (studentId) => {\r\n  try {\r\n    const { data: enrollments, error: enrollError } = await supabase\r\n      .from('enrollments')\r\n      .select('course_id, courses!inner(id, course_code, course_title)')\r\n      .eq('student_id', studentId);\r\n\r\n    if (enrollError) throw enrollError;\r\n\r\n    const history = [];\r\n\r\n    for (const enrollment of (enrollments || [])) {\r\n      const courseId = enrollment.course_id;\r\n      const courseName = enrollment.courses?.course_title || '';\r\n      const courseCode = enrollment.courses?.course_code || '';\r\n\r\n      // Get classes for this course\r\n      const { data: classes } = await supabase\r\n        .from('classes')\r\n        .select('id, class_name')\r\n        .eq('course_id', courseId);\r\n\r\n      const classIds = (classes || []).map(c => c.id);\r\n\r\n      // Get all sessions for these classes\r\n      const { data: sessions } = await supabase\r\n        .from('sessions')\r\n        .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n        .in('class_id', classIds)\r\n        .order('session_date', { ascending: false });\r\n\r\n      // Get attendance records for this student in these sessions\r\n      const { data: attendance } = await supabase\r\n        .from('attendance')\r\n        .select('id, session_id, created_at')\r\n        .eq('student_id', studentId)\r\n        .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n      const attendanceMap = new Set((attendance || []).map(a => a.session_id));\r\n\r\n      // Create history records\r\n      for (const session of (sessions || [])) {\r\n        const classInfo = classes?.find(c => c.id === session.class_id);\r\n        history.push({\r\n          courseCode,\r\n          courseName,\r\n          className: classInfo?.class_name || 'Unknown',\r\n          sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n          startTime: session.start_time,\r\n          endTime: session.end_time,\r\n          status: attendanceMap.has(session.id) ? 'Present' : 'Absent',\r\n          sessionId: session.id\r\n        });\r\n      }\r\n    }\r\n\r\n    // Calculate per-course statistics\r\n    const courseStats = {};\r\n    for (const record of history) {\r\n      if (!courseStats[record.courseCode]) {\r\n        courseStats[record.courseCode] = {\r\n          courseCode: record.courseCode,\r\n          courseName: record.courseName,\r\n          totalSessions: 0,\r\n          attended: 0,\r\n          percentage: 0\r\n        };\r\n      }\r\n      courseStats[record.courseCode].totalSessions++;\r\n      if (record.status === 'Present') {\r\n        courseStats[record.courseCode].attended++;\r\n      }\r\n    }\r\n\r\n    // Calculate percentages\r\n    for (const key in courseStats) {\r\n      const stat = courseStats[key];\r\n      stat.percentage = stat.totalSessions > 0 \r\n        ? Math.round((stat.attended / stat.totalSessions) * 100) \r\n        : 0;\r\n    }\r\n\r\n    return {\r\n      history: history.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate)),\r\n      courseStats: Object.values(courseStats),\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching attendance history:', error);\r\n    return { history: [], courseStats: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const adminFetchAttendanceExportData = async (filters = {}) => {\r\n  try {\r\n    // Fetch all students\r\n    const { data: students, error: studentError } = await supabase\r\n      .from('users')\r\n      .select('id, name, matricule')\r\n      .eq('role', 'student');\r\n\r\n    if (studentError) throw studentError;\r\n\r\n    const exportData = [];\r\n\r\n    for (const student of (students || [])) {\r\n      // Get student's enrollments\r\n      const { data: enrollments } = await supabase\r\n        .from('enrollments')\r\n        .select('course_id, courses!inner(id, course_code, course_title)')\r\n        .eq('student_id', student.id);\r\n\r\n      for (const enrollment of (enrollments || [])) {\r\n        // Apply course filter if provided\r\n        if (filters.courseCode && enrollment.courses?.course_code !== filters.courseCode) {\r\n          continue;\r\n        }\r\n\r\n        const courseId = enrollment.course_id;\r\n\r\n        // Get classes for this course\r\n        const { data: classes } = await supabase\r\n          .from('classes')\r\n          .select('id, class_name')\r\n          .eq('course_id', courseId);\r\n\r\n        const classIds = (classes || []).map(c => c.id);\r\n\r\n        // Get sessions\r\n        let sessionsQuery = supabase\r\n          .from('sessions')\r\n          .select('id, session_date, start_time, end_time, class_id, classes!inner(class_name)')\r\n          .in('class_id', classIds);\r\n\r\n        // Apply date range filter if provided\r\n        if (filters.startDate) {\r\n          sessionsQuery = sessionsQuery.gte('session_date', filters.startDate);\r\n        }\r\n        if (filters.endDate) {\r\n          sessionsQuery = sessionsQuery.lte('session_date', filters.endDate);\r\n        }\r\n\r\n        const { data: sessions } = await sessionsQuery.order('session_date', { ascending: false });\r\n\r\n        // Get attendance records\r\n        const { data: attendance } = await supabase\r\n          .from('attendance')\r\n          .select('id, session_id, created_at')\r\n          .eq('student_id', student.id)\r\n          .in('session_id', (sessions || []).map(s => s.id));\r\n\r\n        const attendanceMap = new Map(\r\n          (attendance || []).map(a => [a.session_id, true])\r\n        );\r\n\r\n        // Create export records\r\n        for (const session of (sessions || [])) {\r\n          const classInfo = classes?.find(c => c.id === session.class_id);\r\n          exportData.push({\r\n            studentName: student.name,\r\n            studentId: student.matricule,\r\n            course: enrollment.courses?.course_code,\r\n            courseName: enrollment.courses?.course_title,\r\n            class: classInfo?.class_name || 'Unknown',\r\n            sessionDate: new Date(session.session_date).toLocaleDateString(),\r\n            sessionTime: `${session.start_time} - ${session.end_time}`,\r\n            status: attendanceMap.has(session.id) ? 'Present' : 'Absent'\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return { data: exportData, error: null };\r\n  } catch (error) {\r\n    console.error('Error fetching export data:', error);\r\n    return { data: [], error: error.message };\r\n  }\r\n};\r\n"],"mappings":"AAAyF,OAASA,QAAQ,KAAQ,sBAAsB,CAExI;AACA;AACA;AAEA,MAAO,MAAM,CAAAC,eAAe,CAAG,KAAAA,CAAA,GAAY,CACzC,GAAI,CACF,KAAM,CACJ,CAAEC,KAAK,CAAEC,YAAY,CAAEC,KAAK,CAAEC,YAAa,CAAC,CAC5C,CAAEH,KAAK,CAAEI,aAAa,CAAEF,KAAK,CAAEG,aAAc,CAAC,CAC9C,CAAEL,KAAK,CAAEM,WAAW,CAAEJ,KAAK,CAAEK,WAAY,CAAC,CAC1C,CAAEP,KAAK,CAAEQ,UAAU,CAAEN,KAAK,CAAEO,UAAW,CAAC,CACzC,CAAG,KAAM,CAAAC,OAAO,CAACC,GAAG,CAAC,CACpBb,QAAQ,CACLc,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,MAAM,CAAE,SAAS,CAAC,CACxBhB,QAAQ,CACLc,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,MAAM,CAAE,UAAU,CAAC,CACzBhB,QAAQ,CACLc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CACnCF,QAAQ,CACLc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CACpC,CAAC,CAEF,KAAM,CAAAe,KAAK,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACpD,KAAM,CAAEC,IAAI,CAAEC,aAAa,CAAElB,KAAK,CAAEmB,aAAc,CAAC,CAAG,KAAM,CAAAvB,QAAQ,CACjEc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,cAAc,CAAEC,KAAK,CAAC,CAE5B,GAAIZ,YAAY,EAAIE,aAAa,EAAIE,WAAW,EAAIE,UAAU,EAAIY,aAAa,CAAE,CAC/E,KAAM,IAAI,CAAAC,KAAK,CAAC,uBAAuB,CAAC,CAC1C,CAEA,MAAO,CACLC,aAAa,CAAEtB,YAAY,EAAI,CAAC,CAChCuB,cAAc,CAAEpB,aAAa,EAAI,CAAC,CAClCqB,YAAY,CAAEnB,WAAW,EAAI,CAAC,CAC9BoB,YAAY,CAAElB,UAAU,EAAI,CAAC,CAC7BmB,aAAa,CAAE,CAACP,aAAa,EAAI,EAAE,EAAEQ,MAAM,CAC3C1B,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACnD,MAAO,CACLqB,aAAa,CAAE,CAAC,CAChBC,cAAc,CAAE,CAAC,CACjBC,YAAY,CAAE,CAAC,CACfC,YAAY,CAAE,CAAC,CACfC,aAAa,CAAE,CAAC,CAChBzB,KAAK,CAAEA,KAAK,CAAC4B,OACf,CAAC,CACH,CACF,CAAC,CAED,MAAO,MAAM,CAAAC,sBAAsB,CAAG,KAAAA,CAAA,GAAY,CAChD,GAAI,CACF,KAAM,CAAAC,GAAG,CAAG,GAAI,CAAAhB,IAAI,CAAC,CAAC,CACtB,KAAM,CAAEG,IAAI,CAAEc,QAAQ,CAAE/B,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAC7Cc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,wTAcN,CAAC,CACDqB,KAAK,CAAC,cAAc,CAAE,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CAC3CC,KAAK,CAAC,EAAE,CAAC,CAEZ,GAAIlC,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB;AACA,KAAM,CAAAmC,YAAY,CAAG,CAACJ,QAAQ,EAAI,EAAE,EACjCK,MAAM,CAACC,CAAC,EAAI,GAAI,CAAAvB,IAAI,CAACuB,CAAC,CAACC,UAAU,CAAC,CAAGR,GAAG,CAAC,CACzCS,GAAG,CAACC,OAAO,OAAAC,gBAAA,CAAAC,qBAAA,CAAAC,iBAAA,CAAAC,qBAAA,CAAAC,iBAAA,CAAAC,qBAAA,CAAAC,cAAA,OAAK,CACfC,EAAE,CAAER,OAAO,CAACQ,EAAE,CACdC,SAAS,CAAE,EAAAR,gBAAA,CAAAD,OAAO,CAACU,OAAO,UAAAT,gBAAA,kBAAAC,qBAAA,CAAfD,gBAAA,CAAiBU,OAAO,UAAAT,qBAAA,iBAAxBA,qBAAA,CAA0BU,YAAY,GAAI,SAAS,CAC9DC,UAAU,CAAE,EAAAV,iBAAA,CAAAH,OAAO,CAACU,OAAO,UAAAP,iBAAA,kBAAAC,qBAAA,CAAfD,iBAAA,CAAiBQ,OAAO,UAAAP,qBAAA,iBAAxBA,qBAAA,CAA0BU,WAAW,GAAI,KAAK,CAC1DC,YAAY,CAAE,EAAAV,iBAAA,CAAAL,OAAO,CAACU,OAAO,UAAAL,iBAAA,kBAAAC,qBAAA,CAAfD,iBAAA,CAAiBW,KAAK,UAAAV,qBAAA,iBAAtBA,qBAAA,CAAwBW,IAAI,GAAI,SAAS,CACvDC,IAAI,CAAE,GAAI,CAAA5C,IAAI,CAAC0B,OAAO,CAACmB,YAAY,CAAC,CAACC,kBAAkB,CAAC,CAAC,CACzDC,SAAS,CAAErB,OAAO,CAACsB,UAAU,CAC7BC,OAAO,CAAEvB,OAAO,CAACwB,QAAQ,CACzBC,MAAM,CAAE,MAAM,CACdC,YAAY,CAAE,EAAAnB,cAAA,CAAAP,OAAO,CAAC2B,KAAK,UAAApB,cAAA,iBAAbA,cAAA,CAAeqB,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,GAAI,KAC5D,CAAC,EAAC,CAAC,CAEL,MAAO,CAAEtC,QAAQ,CAAEI,YAAY,CAAEnC,KAAK,CAAE,IAAK,CAAC,CAChD,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,+BAA+B,CAAEA,KAAK,CAAC,CACrD,MAAO,CAAE+B,QAAQ,CAAE,EAAE,CAAE/B,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC/C,CACF,CAAC,CAED,MAAO,MAAM,CAAA0C,0BAA0B,CAAG,cAAAA,CAAA,CAAsB,IAAf,CAAApC,KAAK,CAAAqC,SAAA,CAAA7C,MAAA,IAAA6C,SAAA,MAAAC,SAAA,CAAAD,SAAA,IAAG,EAAE,CACzD,GAAI,CACF,KAAM,CAAEtD,IAAI,CAAEkC,OAAO,CAAEnD,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAC5Cc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,+BAA+B,CAAC,CACvCuB,KAAK,CAACA,KAAK,CAAC,CAEf,GAAIlC,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,KAAM,CAAAyE,WAAW,CAAG,KAAM,CAAAjE,OAAO,CAACC,GAAG,CACnC,CAAC0C,OAAO,EAAI,EAAE,EAAEZ,GAAG,CAAC,KAAO,CAAAmC,MAAM,EAAK,CACpC,KAAM,CAAEzD,IAAI,CAAE0D,WAAW,CAAE3E,KAAK,CAAE4E,WAAY,CAAC,CAAG,KAAM,CAAAhF,QAAQ,CAC7Dc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,WAAW,CAAE8D,MAAM,CAAC1B,EAAE,CAAC,CAE7B,KAAM,CAAE/B,IAAI,CAAEc,QAAQ,CAAE/B,KAAK,CAAEmB,aAAc,CAAC,CAAG,KAAM,CAAAvB,QAAQ,CAC5Dc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,mBAAmB,CAAE8D,MAAM,CAAC1B,EAAE,CAAC,CAErC,KAAM,CAAE/B,IAAI,CAAE4D,UAAW,CAAC,CAAG,KAAM,CAAAjF,QAAQ,CACxCc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAA+B,eAAe,CAAG,CAACJ,WAAW,EAAI,EAAE,EAAEjD,MAAM,CAClD,KAAM,CAAAsD,eAAe,CAAG,CAACH,UAAU,EAAI,EAAE,EAAEnD,MAAM,CACjD,KAAM,CAAAuD,UAAU,CAAGF,eAAe,CAAG,CAAC,CAAGG,IAAI,CAACC,KAAK,CAAEH,eAAe,CAAGD,eAAe,CAAI,GAAG,CAAC,CAAG,CAAC,CAElG,MAAO,CACL/B,EAAE,CAAE0B,MAAM,CAAC1B,EAAE,CACbK,UAAU,CAAEqB,MAAM,CAACpB,WAAW,CAC9B8B,WAAW,CAAEV,MAAM,CAACtB,YAAY,CAChCiC,gBAAgB,CAAEN,eAAe,CACjCC,eAAe,CACfM,oBAAoB,CAAEL,UAAU,CAChChB,MAAM,CAAEgB,UAAU,EAAI,EAAE,CAAG,MAAM,CAAGA,UAAU,EAAI,EAAE,CAAG,MAAM,CAAG,KAClE,CAAC,CACH,CAAC,CACH,CAAC,CAED,MAAO,CAAEM,gBAAgB,CAAEd,WAAW,CAAEzE,KAAK,CAAE,IAAK,CAAC,CACvD,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,mCAAmC,CAAEA,KAAK,CAAC,CACzD,MAAO,CAAEuF,gBAAgB,CAAE,EAAE,CAAEvF,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CACvD,CACF,CAAC,CAED,MAAO,MAAM,CAAA4D,0BAA0B,CAAG,KAAAA,CAAA,GAAY,CACpD,GAAI,CACF,KAAM,CAAAC,SAAS,CAAG,EAAE,CAAE;AACtB,KAAM,CAAExE,IAAI,CAAE0D,WAAW,CAAE3E,KAAK,CAAE4E,WAAY,CAAC,CAAG,KAAM,CAAAhF,QAAQ,CAC7Dc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,CAAC,uBAAuB,CAAC,CAElC,GAAIiE,WAAW,CAAE,KAAM,CAAAA,WAAW,CAElC,KAAM,CAAAc,MAAM,CAAG,EAAE,CAEjB,IAAK,KAAM,CAAAC,UAAU,GAAK,CAAAhB,WAAW,EAAI,EAAE,CAAG,KAAAiB,qBAAA,CAC5C;AACA,KAAM,CAAE3E,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAAnC,QAAQ,CACtCc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,UAAU,CAAE,EAAAc,qBAAA,EACd,KAAM,CAAAhG,QAAQ,CACXc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,WAAW,CAAE+E,UAAU,CAACE,SAAS,CAAC,EACxC5E,IAAI,UAAA2E,qBAAA,iBALUA,qBAAA,CAKRrD,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,GAAI,EAAE,CAAC,CAE/B;AACA,KAAM,CAAElD,KAAK,CAAEiG,eAAgB,CAAC,CAAG,KAAM,CAAAnG,QAAQ,CAC9Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,YAAY,CAAE+E,UAAU,CAACK,UAAU,CAAC,CACvClB,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAAiC,UAAU,CAAG,CAAC,CAAAlD,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEL,MAAM,GAAI,CAAC,EAAI,CAAC,CAAIqE,eAAe,CAAGhE,QAAQ,CAACL,MAAM,CAAI,GAAG,CAAG,CAAC,CAE9F,GAAIuD,UAAU,CAAGQ,SAAS,CAAE,CAC1B,KAAM,CAAExE,IAAI,CAAEgF,OAAQ,CAAC,CAAG,KAAM,CAAArG,QAAQ,CACrCc,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,iBAAiB,CAAC,CACzBC,EAAE,CAAC,IAAI,CAAE+E,UAAU,CAACK,UAAU,CAAC,CAC/BE,MAAM,CAAC,CAAC,CAEX,KAAM,CAAEjF,IAAI,CAAEyD,MAAO,CAAC,CAAG,KAAM,CAAA9E,QAAQ,CACpCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,2BAA2B,CAAC,CACnCC,EAAE,CAAC,IAAI,CAAE+E,UAAU,CAACE,SAAS,CAAC,CAC9BK,MAAM,CAAC,CAAC,CAEXR,MAAM,CAACS,IAAI,CAAC,CACVC,IAAI,CAAE,gBAAgB,CACtBC,QAAQ,CAAEpB,UAAU,CAAG,EAAE,CAAG,UAAU,CAAG,SAAS,CAClDqB,WAAW,CAAE,CAAAL,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAExC,IAAI,GAAI,SAAS,CACvC8C,SAAS,CAAEZ,UAAU,CAACK,UAAU,CAChCZ,WAAW,CAAE,CAAAV,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEtB,YAAY,GAAI,SAAS,CAC9CC,UAAU,CAAE,CAAAqB,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEpB,WAAW,GAAI,KAAK,CACxCuB,UAAU,IAAA2B,MAAA,CAAKtB,IAAI,CAACC,KAAK,CAACF,UAAU,CAAC,KAAG,CACxCrD,OAAO,IAAA4E,MAAA,CAAK,CAAAP,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAExC,IAAI,GAAI,SAAS,UAAA+C,MAAA,CAAQtB,IAAI,CAACC,KAAK,CAACF,UAAU,CAAC,qBAAAuB,MAAA,CAAmB,CAAA9B,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEtB,YAAY,GAAI,QAAQ,CACzH,CAAC,CAAC,CACJ,CACF,CAEA;AACA,KAAM,CAAEnC,IAAI,CAAEwF,eAAgB,CAAC,CAAG,KAAM,CAAA7G,QAAQ,CAC7Cc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,2CAA2C,CAAC,CACnD+F,EAAE,CAAC,YAAY,CAAE,GAAI,CAAA5F,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAAC,CAE7C,CAAC0F,eAAe,EAAI,EAAE,EAAEE,OAAO,CAACnE,OAAO,EAAI,KAAAoE,iBAAA,CACzClB,MAAM,CAACS,IAAI,CAAC,CACVC,IAAI,CAAE,iBAAiB,CACvBC,QAAQ,CAAE,SAAS,CACnBzE,OAAO,gBAAA4E,MAAA,CAAiB,EAAAI,iBAAA,CAAApE,OAAO,CAACU,OAAO,UAAA0D,iBAAA,iBAAfA,iBAAA,CAAiBC,UAAU,GAAI,OAAO,sCAAoC,CAClGC,SAAS,CAAEtE,OAAO,CAACQ,EACrB,CAAC,CAAC,CACJ,CAAC,CAAC,CAEF,MAAO,CAAE0C,MAAM,CAAE1F,KAAK,CAAE,IAAK,CAAC,CAChC,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAC9C,MAAO,CAAE0F,MAAM,CAAE,EAAE,CAAE1F,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC7C,CACF,CAAC,CAED;AACA;AACA;AAEA,MAAO,MAAM,CAAAmF,4BAA4B,CAAG,KAAO,CAAAC,UAAU,EAAK,CAChE,GAAI,CACF,KAAM,CAAE/F,IAAI,CAAEiC,OAAO,CAAElD,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAC5Cc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,wLAUN,CAAC,CACDC,EAAE,CAAC,aAAa,CAAEoG,UAAU,CAAC,CAEhC,GAAIhH,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,KAAM,CAAAiH,mBAAmB,CAAG,KAAM,CAAAzG,OAAO,CAACC,GAAG,CAC3C,CAACyC,OAAO,EAAI,EAAE,EAAEX,GAAG,CAAC,KAAO,CAAA2E,GAAG,EAAK,KAAAC,YAAA,CAAAC,aAAA,CAAAC,aAAA,CACjC,KAAM,CAAAxG,KAAK,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACpD,KAAM,CAAEC,IAAI,CAAEqG,YAAa,CAAC,CAAG,KAAM,CAAA1H,QAAQ,CAC1Cc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,kCAAkC,CAAC,CAC1CC,EAAE,CAAC,UAAU,CAAEsG,GAAG,CAAClE,EAAE,CAAC,CACtBpC,EAAE,CAAC,cAAc,CAAEC,KAAK,CAAC,CACzBqB,KAAK,CAAC,CAAC,CAAC,CAEX,MAAO,CACLc,EAAE,CAAEkE,GAAG,CAAClE,EAAE,CACVC,SAAS,CAAEiE,GAAG,CAACL,UAAU,CACzBxD,UAAU,EAAA8D,YAAA,CAAED,GAAG,CAAC/D,OAAO,UAAAgE,YAAA,iBAAXA,YAAA,CAAa7D,WAAW,CACpC8B,WAAW,EAAAgC,aAAA,CAAEF,GAAG,CAAC/D,OAAO,UAAAiE,aAAA,iBAAXA,aAAA,CAAahE,YAAY,CACtCmE,OAAO,EAAAF,aAAA,CAAEH,GAAG,CAAC/D,OAAO,UAAAkE,aAAA,iBAAXA,aAAA,CAAaE,OAAO,CAC7BC,YAAY,CAAE,CAACF,YAAY,EAAI,EAAE,EAAE5F,MAAM,CAAG,CAAC,CAAG,MAAM,CAAG,MAAM,CAC/D+F,gBAAgB,CAAE,CAACH,YAAY,EAAI,EAAE,EAAE5F,MAAM,CAAG,CAClD,CAAC,CACH,CAAC,CACH,CAAC,CAED,MAAO,CAAEwB,OAAO,CAAE+D,mBAAmB,CAAEjH,KAAK,CAAE,IAAK,CAAC,CACtD,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CACxD,MAAO,CAAEkD,OAAO,CAAE,EAAE,CAAElD,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC9C,CACF,CAAC,CAED,MAAO,MAAM,CAAA8F,qBAAqB,CAAG,KAAO,CAAAV,UAAU,EAAK,CACzD,GAAI,KAAAW,sBAAA,CACF,KAAM,CAAE1G,IAAI,CAAEc,QAAQ,CAAE/B,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAC7Cc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,2PAYN,CAAC,CACDmE,EAAE,CAAC,UAAU,CAAE,EAAA6C,sBAAA,EACd,KAAM,CAAA/H,QAAQ,CACXc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,aAAa,CAAEoG,UAAU,CAAC,EAChC/F,IAAI,UAAA0G,sBAAA,iBALUA,sBAAA,CAKRpF,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,GAAI,EAAE,CAAC,CAC5BhB,KAAK,CAAC,cAAc,CAAE,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CAC3CC,KAAK,CAAC,EAAE,CAAC,CAEZ,GAAIlC,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,KAAM,CAAA4H,gBAAgB,CAAG,KAAM,CAAApH,OAAO,CAACC,GAAG,CACxC,CAACsB,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAAC,KAAO,CAAAC,OAAO,EAAK,KAAAqF,iBAAA,CAAAC,iBAAA,CAAAC,qBAAA,CAAAC,iBAAA,CAAAC,qBAAA,CACtC,KAAM,CAAEnI,KAAK,CAAEiG,eAAgB,CAAC,CAAG,KAAM,CAAAnG,QAAQ,CAC9Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,YAAY,CAAE4B,OAAO,CAACQ,EAAE,CAAC,CAE/B,MAAO,CACLA,EAAE,CAAER,OAAO,CAACQ,EAAE,CACdC,SAAS,EAAA4E,iBAAA,CAAErF,OAAO,CAACU,OAAO,UAAA2E,iBAAA,iBAAfA,iBAAA,CAAiBhB,UAAU,CACtCzB,WAAW,EAAA0C,iBAAA,CAAEtF,OAAO,CAACU,OAAO,UAAA4E,iBAAA,kBAAAC,qBAAA,CAAfD,iBAAA,CAAiB3E,OAAO,UAAA4E,qBAAA,iBAAxBA,qBAAA,CAA0B3E,YAAY,CACnDC,UAAU,EAAA2E,iBAAA,CAAExF,OAAO,CAACU,OAAO,UAAA8E,iBAAA,kBAAAC,qBAAA,CAAfD,iBAAA,CAAiB7E,OAAO,UAAA8E,qBAAA,iBAAxBA,qBAAA,CAA0B3E,WAAW,CACjDI,IAAI,CAAE,GAAI,CAAA5C,IAAI,CAAC0B,OAAO,CAACmB,YAAY,CAAC,CAACC,kBAAkB,CAAC,CAAC,CACzDC,SAAS,CAAErB,OAAO,CAACsB,UAAU,CAC7BC,OAAO,CAAEvB,OAAO,CAACwB,QAAQ,CACzBC,MAAM,CAAE,GAAI,CAAAnD,IAAI,CAAC0B,OAAO,CAACF,UAAU,CAAC,CAAG,GAAI,CAAAxB,IAAI,CAAC,CAAC,CAAG,MAAM,CAAG,QAAQ,CACrEiF,eAAe,CAAEA,eAAe,EAAI,CAAC,CACrC5B,KAAK,CAAE3B,OAAO,CAAC2B,KACjB,CAAC,CACH,CAAC,CACH,CAAC,CAED,MAAO,CAAEpC,QAAQ,CAAE6F,gBAAgB,CAAE5H,KAAK,CAAE,IAAK,CAAC,CACpD,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChD,MAAO,CAAE+B,QAAQ,CAAE,EAAE,CAAE/B,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC/C,CACF,CAAC,CAED,MAAO,MAAM,CAAAsG,8BAA8B,CAAG,KAAO,CAAApB,SAAS,EAAK,CACjE,GAAI,CACF,KAAM,CAAE7F,IAAI,CAAE4D,UAAU,CAAE7E,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAC/Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,yIAQN,CAAC,CACDC,EAAE,CAAC,YAAY,CAAEkG,SAAS,CAAC,CAE9B,GAAI9G,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,MAAO,CACL6E,UAAU,CAAE,CAACA,UAAU,EAAI,EAAE,EAAEtC,GAAG,CAAC4F,CAAC,OAAAC,QAAA,CAAAC,SAAA,OAAK,CACvCrF,EAAE,CAAEmF,CAAC,CAACnF,EAAE,CACRsD,WAAW,EAAA8B,QAAA,CAAED,CAAC,CAAC3E,KAAK,UAAA4E,QAAA,iBAAPA,QAAA,CAAS3E,IAAI,CAC1B6E,gBAAgB,EAAAD,SAAA,CAAEF,CAAC,CAAC3E,KAAK,UAAA6E,SAAA,iBAAPA,SAAA,CAASE,SAAS,CACpCC,SAAS,CAAE,GAAI,CAAA1H,IAAI,CAACqH,CAAC,CAACM,UAAU,CAAC,CAACC,kBAAkB,CAAC,CAAC,CACtDzE,MAAM,CAAE,SACV,CAAC,EAAC,CAAC,CACHjE,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,oCAAoC,CAAEA,KAAK,CAAC,CAC1D,MAAO,CAAE6E,UAAU,CAAE,EAAE,CAAE7E,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CACjD,CACF,CAAC,CAED,MAAO,MAAM,CAAA+G,kBAAkB,CAAG,KAAO,CAAA3B,UAAU,EAAK,CACtD,GAAI,CACF,KAAM,CAAE/F,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,aAAa,CAAEoG,UAAU,CAAC,CAEhC,KAAM,CAAA4B,QAAQ,CAAG,CAAC1F,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAE/C,KAAM,CAAE/B,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAAnC,QAAQ,CACtCc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,gBAAgB,CAAC,CACxBmE,EAAE,CAAC,UAAU,CAAE8D,QAAQ,CAAC,CAE3B,KAAM,CAAA9G,GAAG,CAAG,GAAI,CAAAhB,IAAI,CAAC,CAAC,CACtB,KAAM,CAAA+H,cAAc,CAAG,CAAC9G,QAAQ,EAAI,EAAE,EAAEK,MAAM,CAACC,CAAC,EAAI,GAAI,CAAAvB,IAAI,CAACuB,CAAC,CAACC,UAAU,CAAC,CAAGR,GAAG,CAAC,CAEjF,KAAM,CAAEhC,KAAK,CAAEkF,eAAgB,CAAC,CAAG,KAAM,CAAApF,QAAQ,CAC9Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCgF,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAAnC,KAAK,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACpD,KAAM,CAAEC,IAAI,CAAEC,aAAc,CAAC,CAAG,KAAM,CAAAtB,QAAQ,CAC3Cc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,UAAU,CAAE8D,QAAQ,CAAC,CACxBhI,EAAE,CAAC,cAAc,CAAEC,KAAK,CAAC,CAE5B,MAAO,CACLgI,cAAc,CAAEA,cAAc,CAACnH,MAAM,CACrCoH,aAAa,CAAE,CAAA/G,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEL,MAAM,GAAI,CAAC,CACpCqH,WAAW,CAAE/D,eAAe,EAAI,CAAC,CACjC9D,aAAa,CAAE,CAACA,aAAa,EAAI,EAAE,EAAEQ,MAAM,CAC3C1B,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,gCAAgC,CAAEA,KAAK,CAAC,CACtD,MAAO,CACL6I,cAAc,CAAE,CAAC,CACjBC,aAAa,CAAE,CAAC,CAChBC,WAAW,CAAE,CAAC,CACd7H,aAAa,CAAE,CAAC,CAChBlB,KAAK,CAAEA,KAAK,CAAC4B,OACf,CAAC,CACH,CACF,CAAC,CAED;AACA;AACA;AAEA,MAAO,MAAM,CAAAoH,2BAA2B,CAAG,KAAO,CAAAzC,SAAS,EAAK,CAC9D,GAAI,CACF,KAAM,CAAEtF,IAAI,CAAE0D,WAAW,CAAE3E,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAChDc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,0LAUN,CAAC,CACDC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAE9B,GAAIvG,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,MAAO,CACLmD,OAAO,CAAE,CAACwB,WAAW,EAAI,EAAE,EAAEpC,GAAG,CAAC0G,CAAC,OAAAC,UAAA,CAAAC,WAAA,CAAAC,WAAA,CAAAC,WAAA,CAAAC,WAAA,OAAK,CACrCtG,EAAE,EAAAkG,UAAA,CAAED,CAAC,CAAC9F,OAAO,UAAA+F,UAAA,iBAATA,UAAA,CAAWlG,EAAE,CACjBK,UAAU,EAAA8F,WAAA,CAAEF,CAAC,CAAC9F,OAAO,UAAAgG,WAAA,iBAATA,WAAA,CAAW7F,WAAW,CAClC8B,WAAW,EAAAgE,WAAA,CAAEH,CAAC,CAAC9F,OAAO,UAAAiG,WAAA,iBAATA,WAAA,CAAWhG,YAAY,CACpCmE,OAAO,EAAA8B,WAAA,CAAEJ,CAAC,CAAC9F,OAAO,UAAAkG,WAAA,iBAATA,WAAA,CAAW9B,OAAO,CAC3BgC,SAAS,EAAAD,WAAA,CAAEL,CAAC,CAAC9F,OAAO,UAAAmG,WAAA,iBAATA,WAAA,CAAWE,UAAU,CAChCC,YAAY,CAAER,CAAC,CAACjG,EAClB,CAAC,EAAC,CAAC,CACHhD,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CACxD,MAAO,CAAEmD,OAAO,CAAE,EAAE,CAAEnD,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC9C,CACF,CAAC,CAED,MAAO,MAAM,CAAA8H,0BAA0B,CAAG,KAAO,CAAAnD,SAAS,EAAK,CAC7D,GAAI,CACF,KAAM,CAAEtF,IAAI,CAAE0D,WAAW,CAAE3E,KAAK,CAAE4E,WAAY,CAAC,CAAG,KAAM,CAAAhF,QAAQ,CAC7Dc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,CAAC,WAAW,CAAC,CACnBC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAE9B,GAAI3B,WAAW,CAAE,KAAM,CAAAA,WAAW,CAElC,KAAM,CAAA+E,SAAS,CAAG,CAAChF,WAAW,EAAI,EAAE,EAAEpC,GAAG,CAAC0G,CAAC,EAAIA,CAAC,CAACpD,SAAS,CAAC,CAE3D,KAAM,CAAE5E,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,WAAW,CAAE6E,SAAS,CAAC,CAE7B,KAAM,CAAAf,QAAQ,CAAG,CAAC1F,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAC/C,KAAM,CAAAlB,GAAG,CAAG,GAAI,CAAAhB,IAAI,CAAC,CAAC,CAEtB,KAAM,CAAEG,IAAI,CAAEc,QAAQ,CAAE/B,KAAK,CAAE4J,YAAa,CAAC,CAAG,KAAM,CAAAhK,QAAQ,CAC3Dc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,wTAcN,CAAC,CACDmE,EAAE,CAAC,UAAU,CAAE8D,QAAQ,CAAC,CACxBiB,EAAE,CAAC,YAAY,CAAE/H,GAAG,CAACf,WAAW,CAAC,CAAC,CAAC,CAEtC,GAAI6I,YAAY,CAAE,KAAM,CAAAA,YAAY,CAEpC;AACA,KAAM,CAAE3I,IAAI,CAAE6I,iBAAkB,CAAC,CAAG,KAAM,CAAAlK,QAAQ,CAC/Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,YAAY,CAAC,CACpBC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAC3BzB,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAA+G,gBAAgB,CAAG,CAACD,iBAAiB,EAAI,EAAE,EAAEvH,GAAG,CAAC4F,CAAC,EAAIA,CAAC,CAAC6B,UAAU,CAAC,CAEzE,MAAO,CACLjI,QAAQ,CAAE,CAACA,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,OAAA4H,UAAA,CAAAC,kBAAA,CAAAC,WAAA,CAAAC,mBAAA,CAAAC,WAAA,CAAAC,WAAA,CAAAC,iBAAA,OAAK,CACnCvH,EAAE,CAAEX,CAAC,CAACW,EAAE,CACRK,UAAU,EAAA4G,UAAA,CAAE5H,CAAC,CAACa,OAAO,UAAA+G,UAAA,kBAAAC,kBAAA,CAATD,UAAA,CAAW9G,OAAO,UAAA+G,kBAAA,iBAAlBA,kBAAA,CAAoB5G,WAAW,CAC3C8B,WAAW,EAAA+E,WAAA,CAAE9H,CAAC,CAACa,OAAO,UAAAiH,WAAA,kBAAAC,mBAAA,CAATD,WAAA,CAAWhH,OAAO,UAAAiH,mBAAA,iBAAlBA,mBAAA,CAAoBhH,YAAY,CAC7CH,SAAS,EAAAoH,WAAA,CAAEhI,CAAC,CAACa,OAAO,UAAAmH,WAAA,iBAATA,WAAA,CAAWxD,UAAU,CAChCtD,YAAY,EAAA+G,WAAA,CAAEjI,CAAC,CAACa,OAAO,UAAAoH,WAAA,kBAAAC,iBAAA,CAATD,WAAA,CAAW9G,KAAK,UAAA+G,iBAAA,iBAAhBA,iBAAA,CAAkB9G,IAAI,CACpCC,IAAI,CAAE,GAAI,CAAA5C,IAAI,CAACuB,CAAC,CAACsB,YAAY,CAAC,CAACC,kBAAkB,CAAC,CAAC,CACnDC,SAAS,CAAExB,CAAC,CAACyB,UAAU,CACvBC,OAAO,CAAE1B,CAAC,CAAC2B,QAAQ,CACnBG,KAAK,CAAE9B,CAAC,CAAC8B,KAAK,CACdqG,QAAQ,CAAET,gBAAgB,CAACU,QAAQ,CAACpI,CAAC,CAACW,EAAE,CAAC,CACzCiB,MAAM,CAAE,MACV,CAAC,EAAC,CAAC,CACHjE,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACvD,MAAO,CAAE+B,QAAQ,CAAE,EAAE,CAAE/B,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC/C,CACF,CAAC,CAED,MAAO,MAAM,CAAA8I,6BAA6B,CAAG,KAAO,CAAAnE,SAAS,EAAK,CAChE,GAAI,CACF,KAAM,CAAEtF,IAAI,CAAE0D,WAAW,CAAE3E,KAAK,CAAE4E,WAAY,CAAC,CAAG,KAAM,CAAAhF,QAAQ,CAC7Dc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,CAAC,WAAW,CAAC,CACnBC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAE9B,GAAI3B,WAAW,CAAE,KAAM,CAAAA,WAAW,CAElC,KAAM,CAAA+E,SAAS,CAAG,CAAChF,WAAW,EAAI,EAAE,EAAEpC,GAAG,CAAC0G,CAAC,EAAIA,CAAC,CAACpD,SAAS,CAAC,CAE3D,KAAM,CAAE5E,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,WAAW,CAAE6E,SAAS,CAAC,CAE7B,KAAM,CAAAf,QAAQ,CAAG,CAAC1F,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAE/C,KAAM,CAAE/B,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAAnC,QAAQ,CACtCc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,UAAU,CAAE8D,QAAQ,CAAC,CAE3B,KAAM,CAAE3H,IAAI,CAAE4D,UAAW,CAAC,CAAG,KAAM,CAAAjF,QAAQ,CACxCc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAC3BzB,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAA8F,aAAa,CAAG,CAAC/G,QAAQ,EAAI,EAAE,EAAEL,MAAM,CAC7C,KAAM,CAAAiJ,aAAa,CAAG,CAAC9F,UAAU,EAAI,EAAE,EAAEnD,MAAM,CAC/C,KAAM,CAAAuD,UAAU,CAAG6D,aAAa,CAAG,CAAC,CAAG5D,IAAI,CAACC,KAAK,CAAEwF,aAAa,CAAG7B,aAAa,CAAI,GAAG,CAAC,CAAG,CAAC,CAE5F,MAAO,CACL8B,OAAO,CAAE,CACP9B,aAAa,CACb6B,aAAa,CACbrF,oBAAoB,CAAEL,UAAU,CAChChB,MAAM,CAAEgB,UAAU,EAAI,EAAE,CAAG,MAAM,CAAGA,UAAU,EAAI,EAAE,CAAG,MAAM,CAAG,KAClE,CAAC,CACDjF,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,oCAAoC,CAAEA,KAAK,CAAC,CAC1D,MAAO,CACL4K,OAAO,CAAE,CACP9B,aAAa,CAAE,CAAC,CAChB6B,aAAa,CAAE,CAAC,CAChBrF,oBAAoB,CAAE,CAAC,CACvBrB,MAAM,CAAE,SACV,CAAC,CACDjE,KAAK,CAAEA,KAAK,CAAC4B,OACf,CAAC,CACH,CACF,CAAC,CAED,MAAO,MAAM,CAAAiJ,4BAA4B,CAAG,KAAO,CAAAtE,SAAS,EAAK,CAC/D,GAAI,CACF,KAAM,CAAEtF,IAAI,CAAE0D,WAAW,CAAE3E,KAAK,CAAE4E,WAAY,CAAC,CAAG,KAAM,CAAAhF,QAAQ,CAC7Dc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,kIAON,CAAC,CACDC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAE9B,GAAI3B,WAAW,CAAE,KAAM,CAAAA,WAAW,CAElC,KAAM,CAAAW,gBAAgB,CAAG,KAAM,CAAA/E,OAAO,CAACC,GAAG,CACxC,CAACkE,WAAW,EAAI,EAAE,EAAEpC,GAAG,CAAC,KAAO,CAAAoD,UAAU,EAAK,KAAAmF,mBAAA,CAAAC,oBAAA,CAC5C,KAAM,CAAE9J,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,WAAW,CAAE+E,UAAU,CAACE,SAAS,CAAC,CAExC,KAAM,CAAE5E,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAAnC,QAAQ,CACtCc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,UAAU,CAAE,CAAC5B,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAAC,CAEjD,KAAM,CAAElD,KAAK,CAAEiG,eAAgB,CAAC,CAAG,KAAM,CAAAnG,QAAQ,CAC9Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAC3BzB,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAA8F,aAAa,CAAG,CAAC/G,QAAQ,EAAI,EAAE,EAAEL,MAAM,CAC7C,KAAM,CAAAuD,UAAU,CAAG6D,aAAa,CAAG,CAAC,CAAG5D,IAAI,CAACC,KAAK,CAAEY,eAAe,CAAG+C,aAAa,CAAI,GAAG,CAAC,CAAG,CAAC,CAE9F,MAAO,CACLzF,UAAU,EAAAyH,mBAAA,CAAEnF,UAAU,CAACxC,OAAO,UAAA2H,mBAAA,iBAAlBA,mBAAA,CAAoBxH,WAAW,CAC3C8B,WAAW,EAAA2F,oBAAA,CAAEpF,UAAU,CAACxC,OAAO,UAAA4H,oBAAA,iBAAlBA,oBAAA,CAAoB3H,YAAY,CAC7C4H,QAAQ,CAAErF,UAAU,CAACE,SAAS,CAC9BiD,aAAa,CACbmC,QAAQ,CAAElF,eAAe,EAAI,CAAC,CAC9BT,oBAAoB,CAAEL,UAAU,CAChChB,MAAM,CAAEgB,UAAU,EAAI,EAAE,CAAG,MAAM,CAAGA,UAAU,EAAI,EAAE,CAAG,MAAM,CAAG,KAClE,CAAC,CACH,CAAC,CACH,CAAC,CAED,MAAO,CAAEM,gBAAgB,CAAEvF,KAAK,CAAE,IAAK,CAAC,CAC1C,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,mCAAmC,CAAEA,KAAK,CAAC,CACzD,MAAO,CAAEuF,gBAAgB,CAAE,EAAE,CAAEvF,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CACvD,CACF,CAAC,CAED,MAAO,MAAM,CAAAsJ,kBAAkB,CAAG,KAAO,CAAA3E,SAAS,EAAK,CACrD,GAAI,CACF,KAAM,CAAAb,MAAM,CAAG,EAAE,CACjB,KAAM,CAAAD,SAAS,CAAG,EAAE,CAEpB,KAAM,CAAExE,IAAI,CAAE0D,WAAY,CAAC,CAAG,KAAM,CAAA/E,QAAQ,CACzCc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,kFAGN,CAAC,CACDC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAE9B,IAAK,KAAM,CAAAZ,UAAU,GAAK,CAAAhB,WAAW,EAAI,EAAE,CAAG,CAC5C,KAAM,CAAE1D,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,WAAW,CAAE+E,UAAU,CAACE,SAAS,CAAC,CAExC,KAAM,CAAE5E,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAAnC,QAAQ,CACtCc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZmE,EAAE,CAAC,UAAU,CAAE,CAAC5B,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAAC,CAEjD,KAAM,CAAElD,KAAK,CAAEiG,eAAgB,CAAC,CAAG,KAAM,CAAAnG,QAAQ,CAC9Cc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,IAAI,CAAE,CAAEb,KAAK,CAAE,OAAQ,CAAC,CAAC,CAChCc,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAC3BzB,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAAiC,UAAU,CAAG,CAAC,CAAAlD,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEL,MAAM,GAAI,CAAC,EAAI,CAAC,CAAIqE,eAAe,CAAGhE,QAAQ,CAACL,MAAM,CAAI,GAAG,CAAG,CAAC,CAE9F,GAAIuD,UAAU,CAAGQ,SAAS,CAAE,KAAA0F,oBAAA,CAAAC,oBAAA,CAAAC,oBAAA,CAC1B3F,MAAM,CAACS,IAAI,CAAC,CACVC,IAAI,CAAE,gBAAgB,CACtBC,QAAQ,CAAEpB,UAAU,CAAG,EAAE,CAAG,UAAU,CAAG,SAAS,CAClDrD,OAAO,uBAAA4E,MAAA,EAAA2E,oBAAA,CAAwBxF,UAAU,CAACxC,OAAO,UAAAgI,oBAAA,iBAAlBA,oBAAA,CAAoB/H,YAAY,SAAAoD,MAAA,CAAOtB,IAAI,CAACC,KAAK,CAACF,UAAU,CAAC,uCAAqC,CACjIG,WAAW,EAAAgG,oBAAA,CAAEzF,UAAU,CAACxC,OAAO,UAAAiI,oBAAA,iBAAlBA,oBAAA,CAAoBhI,YAAY,CAC7CC,UAAU,EAAAgI,oBAAA,CAAE1F,UAAU,CAACxC,OAAO,UAAAkI,oBAAA,iBAAlBA,oBAAA,CAAoB/H,WAAW,CAC3C2B,UAAU,CAAEC,IAAI,CAACC,KAAK,CAACF,UAAU,CACnC,CAAC,CAAC,CACJ,CACF,CAEA,MAAO,CAAES,MAAM,CAAE1F,KAAK,CAAE,IAAK,CAAC,CAChC,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAC9C,MAAO,CAAE0F,MAAM,CAAE,EAAE,CAAE1F,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC7C,CACF,CAAC,CAED;AACA;AACA;AAEA,MAAO,MAAM,CAAA0J,aAAa,CAAG,KAAAA,CAAOtE,UAAU,CAAEuE,OAAO,CAAEC,WAAW,CAAE3H,SAAS,CAAEE,OAAO,GAAK,CAC3F,GAAI,CACF;AACA,KAAM,CAAAI,KAAK,CAAGe,IAAI,CAACuG,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAE,EAAE,CAAC,CAAGzG,IAAI,CAACuG,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAE,EAAE,CAAC,CAEvG;AACA,KAAM,CAACC,OAAO,CAAEC,MAAM,CAAC,CAAG9H,OAAO,CAAC/C,KAAK,CAAC,GAAG,CAAC,CAC5C,KAAM,CAAA8K,SAAS,CAAG,GAAI,CAAAhL,IAAI,CAAC0K,WAAW,CAAC,CACvCM,SAAS,CAACC,QAAQ,CAACC,QAAQ,CAACJ,OAAO,CAAC,CAAG,CAAC,CAAEI,QAAQ,CAACH,MAAM,CAAC,CAAE,CAAC,CAAC,CAE9D,KAAM,CAAE5K,IAAI,CAAEjB,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CACnCc,IAAI,CAAC,UAAU,CAAC,CAChBuL,MAAM,CAAC,CACNC,QAAQ,CAAEX,OAAO,CACjB5H,YAAY,CAAE6H,WAAW,CACzB1H,UAAU,CAAED,SAAS,CACrBG,QAAQ,CAAED,OAAO,CACjBI,KAAK,CACL7B,UAAU,CAAEwJ,SAAS,CAAC/K,WAAW,CAAC,CACpC,CAAC,CAAC,CACDJ,MAAM,CAAC,CAAC,CAEX,GAAIX,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,MAAO,CAAEwC,OAAO,CAAEvB,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAG,CAAC,CAAC,CAAEjB,KAAK,CAAE,IAAK,CAAC,CAC5C,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CAC/C,MAAO,CAAEwC,OAAO,CAAE,IAAI,CAAExC,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAChD,CACF,CAAC,CAED,MAAO,MAAM,CAAAuK,cAAc,CAAG,KAAAA,CAAO5F,SAAS,CAAEO,SAAS,GAAK,CAC5D,GAAI,CACF,KAAM,CAAE7F,IAAI,CAAEjB,KAAM,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CACnCc,IAAI,CAAC,YAAY,CAAC,CAClBuL,MAAM,CAAC,CACNjG,UAAU,CAAEO,SAAS,CACrByD,UAAU,CAAElD,SACd,CAAC,CAAC,CACDnG,MAAM,CAAC,CAAC,CAEX,GAAIX,KAAK,CAAE,KAAM,CAAAA,KAAK,CAEtB,MAAO,CAAEoM,OAAO,CAAE,IAAI,CAAEvH,UAAU,CAAE5D,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAG,CAAC,CAAC,CAAEjB,KAAK,CAAE,IAAK,CAAC,CAC9D,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACjD,MAAO,CAAEoM,OAAO,CAAE,KAAK,CAAEvH,UAAU,CAAE,IAAI,CAAE7E,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CACnE,CACF,CAAC,CAED;AACA;AACA;AAEA,MAAO,MAAM,CAAAyK,6BAA6B,CAAG,KAAO,CAAA9F,SAAS,EAAK,CAChE,GAAI,CACF,KAAM,CAAEtF,IAAI,CAAE0D,WAAW,CAAE3E,KAAK,CAAE4E,WAAY,CAAC,CAAG,KAAM,CAAAhF,QAAQ,CAC7Dc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,CAAC,yDAAyD,CAAC,CACjEC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAE9B,GAAI3B,WAAW,CAAE,KAAM,CAAAA,WAAW,CAElC,KAAM,CAAA0H,OAAO,CAAG,EAAE,CAElB,IAAK,KAAM,CAAA3G,UAAU,GAAK,CAAAhB,WAAW,EAAI,EAAE,CAAG,KAAA4H,oBAAA,CAAAC,oBAAA,CAC5C,KAAM,CAAAxB,QAAQ,CAAGrF,UAAU,CAACE,SAAS,CACrC,KAAM,CAAA4G,UAAU,CAAG,EAAAF,oBAAA,CAAA5G,UAAU,CAACxC,OAAO,UAAAoJ,oBAAA,iBAAlBA,oBAAA,CAAoBnJ,YAAY,GAAI,EAAE,CACzD,KAAM,CAAAC,UAAU,CAAG,EAAAmJ,oBAAA,CAAA7G,UAAU,CAACxC,OAAO,UAAAqJ,oBAAA,iBAAlBA,oBAAA,CAAoBlJ,WAAW,GAAI,EAAE,CAExD;AACA,KAAM,CAAErC,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,gBAAgB,CAAC,CACxBC,EAAE,CAAC,WAAW,CAAEoK,QAAQ,CAAC,CAE5B,KAAM,CAAApC,QAAQ,CAAG,CAAC1F,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAE/C;AACA,KAAM,CAAE/B,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAAnC,QAAQ,CACtCc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,6EAA6E,CAAC,CACrFmE,EAAE,CAAC,UAAU,CAAE8D,QAAQ,CAAC,CACxB5G,KAAK,CAAC,cAAc,CAAE,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CAE9C;AACA,KAAM,CAAEhB,IAAI,CAAE4D,UAAW,CAAC,CAAG,KAAM,CAAAjF,QAAQ,CACxCc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,4BAA4B,CAAC,CACpCC,EAAE,CAAC,YAAY,CAAE2F,SAAS,CAAC,CAC3BzB,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAA0J,aAAa,CAAG,GAAI,CAAAC,GAAG,CAAC,CAAC9H,UAAU,EAAI,EAAE,EAAEtC,GAAG,CAAC4F,CAAC,EAAIA,CAAC,CAAC6B,UAAU,CAAC,CAAC,CAExE;AACA,IAAK,KAAM,CAAAxH,OAAO,GAAK,CAAAT,QAAQ,EAAI,EAAE,CAAG,CACtC,KAAM,CAAA6K,SAAS,CAAG1J,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAE2J,IAAI,CAAC/G,CAAC,EAAIA,CAAC,CAAC9C,EAAE,GAAKR,OAAO,CAAC0J,QAAQ,CAAC,CAC/DI,OAAO,CAACnG,IAAI,CAAC,CACX9C,UAAU,CACVoJ,UAAU,CACVxJ,SAAS,CAAE,CAAA2J,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAE/F,UAAU,GAAI,SAAS,CAC7C2E,WAAW,CAAE,GAAI,CAAA1K,IAAI,CAAC0B,OAAO,CAACmB,YAAY,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAChEC,SAAS,CAAErB,OAAO,CAACsB,UAAU,CAC7BC,OAAO,CAAEvB,OAAO,CAACwB,QAAQ,CACzBC,MAAM,CAAEyI,aAAa,CAACI,GAAG,CAACtK,OAAO,CAACQ,EAAE,CAAC,CAAG,SAAS,CAAG,QAAQ,CAC5D8D,SAAS,CAAEtE,OAAO,CAACQ,EACrB,CAAC,CAAC,CACJ,CACF,CAEA;AACA,KAAM,CAAAyB,WAAW,CAAG,CAAC,CAAC,CACtB,IAAK,KAAM,CAAAsI,MAAM,GAAI,CAAAT,OAAO,CAAE,CAC5B,GAAI,CAAC7H,WAAW,CAACsI,MAAM,CAAC1J,UAAU,CAAC,CAAE,CACnCoB,WAAW,CAACsI,MAAM,CAAC1J,UAAU,CAAC,CAAG,CAC/BA,UAAU,CAAE0J,MAAM,CAAC1J,UAAU,CAC7BoJ,UAAU,CAAEM,MAAM,CAACN,UAAU,CAC7B3D,aAAa,CAAE,CAAC,CAChBmC,QAAQ,CAAE,CAAC,CACXhG,UAAU,CAAE,CACd,CAAC,CACH,CACAR,WAAW,CAACsI,MAAM,CAAC1J,UAAU,CAAC,CAACyF,aAAa,EAAE,CAC9C,GAAIiE,MAAM,CAAC9I,MAAM,GAAK,SAAS,CAAE,CAC/BQ,WAAW,CAACsI,MAAM,CAAC1J,UAAU,CAAC,CAAC4H,QAAQ,EAAE,CAC3C,CACF,CAEA;AACA,IAAK,KAAM,CAAA+B,GAAG,GAAI,CAAAvI,WAAW,CAAE,CAC7B,KAAM,CAAAwI,IAAI,CAAGxI,WAAW,CAACuI,GAAG,CAAC,CAC7BC,IAAI,CAAChI,UAAU,CAAGgI,IAAI,CAACnE,aAAa,CAAG,CAAC,CACpC5D,IAAI,CAACC,KAAK,CAAE8H,IAAI,CAAChC,QAAQ,CAAGgC,IAAI,CAACnE,aAAa,CAAI,GAAG,CAAC,CACtD,CAAC,CACP,CAEA,MAAO,CACLwD,OAAO,CAAEA,OAAO,CAACY,IAAI,CAAC,CAAC/E,CAAC,CAAEgF,CAAC,GAAK,GAAI,CAAArM,IAAI,CAACqM,CAAC,CAAC3B,WAAW,CAAC,CAAG,GAAI,CAAA1K,IAAI,CAACqH,CAAC,CAACqD,WAAW,CAAC,CAAC,CAClF/G,WAAW,CAAE2I,MAAM,CAACC,MAAM,CAAC5I,WAAW,CAAC,CACvCzE,KAAK,CAAE,IACT,CAAC,CACH,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,oCAAoC,CAAEA,KAAK,CAAC,CAC1D,MAAO,CAAEsM,OAAO,CAAE,EAAE,CAAE7H,WAAW,CAAE,EAAE,CAAEzE,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC/D,CACF,CAAC,CAED,MAAO,MAAM,CAAA0L,8BAA8B,CAAG,cAAAA,CAAA,CAAwB,IAAjB,CAAAC,OAAO,CAAAhJ,SAAA,CAAA7C,MAAA,IAAA6C,SAAA,MAAAC,SAAA,CAAAD,SAAA,IAAG,CAAC,CAAC,CAC/D,GAAI,CACF;AACA,KAAM,CAAEtD,IAAI,CAAEuM,QAAQ,CAAExN,KAAK,CAAEC,YAAa,CAAC,CAAG,KAAM,CAAAL,QAAQ,CAC3Dc,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,qBAAqB,CAAC,CAC7BC,EAAE,CAAC,MAAM,CAAE,SAAS,CAAC,CAExB,GAAIX,YAAY,CAAE,KAAM,CAAAA,YAAY,CAEpC,KAAM,CAAAwN,UAAU,CAAG,EAAE,CAErB,IAAK,KAAM,CAAAxH,OAAO,GAAK,CAAAuH,QAAQ,EAAI,EAAE,CAAG,CACtC;AACA,KAAM,CAAEvM,IAAI,CAAE0D,WAAY,CAAC,CAAG,KAAM,CAAA/E,QAAQ,CACzCc,IAAI,CAAC,aAAa,CAAC,CACnBC,MAAM,CAAC,yDAAyD,CAAC,CACjEC,EAAE,CAAC,YAAY,CAAEqF,OAAO,CAACjD,EAAE,CAAC,CAE/B,IAAK,KAAM,CAAA2C,UAAU,GAAK,CAAAhB,WAAW,EAAI,EAAE,CAAG,KAAA+I,oBAAA,CAC5C;AACA,GAAIH,OAAO,CAAClK,UAAU,EAAI,EAAAqK,oBAAA,CAAA/H,UAAU,CAACxC,OAAO,UAAAuK,oBAAA,iBAAlBA,oBAAA,CAAoBpK,WAAW,IAAKiK,OAAO,CAAClK,UAAU,CAAE,CAChF,SACF,CAEA,KAAM,CAAA2H,QAAQ,CAAGrF,UAAU,CAACE,SAAS,CAErC;AACA,KAAM,CAAE5E,IAAI,CAAEiC,OAAQ,CAAC,CAAG,KAAM,CAAAtD,QAAQ,CACrCc,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,gBAAgB,CAAC,CACxBC,EAAE,CAAC,WAAW,CAAEoK,QAAQ,CAAC,CAE5B,KAAM,CAAApC,QAAQ,CAAG,CAAC1F,OAAO,EAAI,EAAE,EAAEX,GAAG,CAACuD,CAAC,EAAIA,CAAC,CAAC9C,EAAE,CAAC,CAE/C;AACA,GAAI,CAAA2K,aAAa,CAAG/N,QAAQ,CACzBc,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,6EAA6E,CAAC,CACrFmE,EAAE,CAAC,UAAU,CAAE8D,QAAQ,CAAC,CAE3B;AACA,GAAI2E,OAAO,CAACK,SAAS,CAAE,CACrBD,aAAa,CAAGA,aAAa,CAACE,GAAG,CAAC,cAAc,CAAEN,OAAO,CAACK,SAAS,CAAC,CACtE,CACA,GAAIL,OAAO,CAACO,OAAO,CAAE,CACnBH,aAAa,CAAGA,aAAa,CAACI,GAAG,CAAC,cAAc,CAAER,OAAO,CAACO,OAAO,CAAC,CACpE,CAEA,KAAM,CAAE7M,IAAI,CAAEc,QAAS,CAAC,CAAG,KAAM,CAAA4L,aAAa,CAAC3L,KAAK,CAAC,cAAc,CAAE,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CAE1F;AACA,KAAM,CAAEhB,IAAI,CAAE4D,UAAW,CAAC,CAAG,KAAM,CAAAjF,QAAQ,CACxCc,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,4BAA4B,CAAC,CACpCC,EAAE,CAAC,YAAY,CAAEqF,OAAO,CAACjD,EAAE,CAAC,CAC5B8B,EAAE,CAAC,YAAY,CAAE,CAAC/C,QAAQ,EAAI,EAAE,EAAEQ,GAAG,CAACF,CAAC,EAAIA,CAAC,CAACW,EAAE,CAAC,CAAC,CAEpD,KAAM,CAAA0J,aAAa,CAAG,GAAI,CAAAsB,GAAG,CAC3B,CAACnJ,UAAU,EAAI,EAAE,EAAEtC,GAAG,CAAC4F,CAAC,EAAI,CAACA,CAAC,CAAC6B,UAAU,CAAE,IAAI,CAAC,CAClD,CAAC,CAED;AACA,IAAK,KAAM,CAAAxH,OAAO,GAAK,CAAAT,QAAQ,EAAI,EAAE,CAAG,KAAAkM,oBAAA,CAAAC,oBAAA,CACtC,KAAM,CAAAtB,SAAS,CAAG1J,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAE2J,IAAI,CAAC/G,CAAC,EAAIA,CAAC,CAAC9C,EAAE,GAAKR,OAAO,CAAC0J,QAAQ,CAAC,CAC/DuB,UAAU,CAACtH,IAAI,CAAC,CACdG,WAAW,CAAEL,OAAO,CAACxC,IAAI,CACzB8C,SAAS,CAAEN,OAAO,CAACsC,SAAS,CAC5B7D,MAAM,EAAAuJ,oBAAA,CAAEtI,UAAU,CAACxC,OAAO,UAAA8K,oBAAA,iBAAlBA,oBAAA,CAAoB3K,WAAW,CACvCmJ,UAAU,EAAAyB,oBAAA,CAAEvI,UAAU,CAACxC,OAAO,UAAA+K,oBAAA,iBAAlBA,oBAAA,CAAoB9K,YAAY,CAC5C+K,KAAK,CAAE,CAAAvB,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAE/F,UAAU,GAAI,SAAS,CACzC2E,WAAW,CAAE,GAAI,CAAA1K,IAAI,CAAC0B,OAAO,CAACmB,YAAY,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAChEwK,WAAW,IAAA5H,MAAA,CAAKhE,OAAO,CAACsB,UAAU,QAAA0C,MAAA,CAAMhE,OAAO,CAACwB,QAAQ,CAAE,CAC1DC,MAAM,CAAEyI,aAAa,CAACI,GAAG,CAACtK,OAAO,CAACQ,EAAE,CAAC,CAAG,SAAS,CAAG,QACtD,CAAC,CAAC,CACJ,CACF,CACF,CAEA,MAAO,CAAE/B,IAAI,CAAEwM,UAAU,CAAEzN,KAAK,CAAE,IAAK,CAAC,CAC1C,CAAE,MAAOA,KAAK,CAAE,CACd2B,OAAO,CAAC3B,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACnD,MAAO,CAAEiB,IAAI,CAAE,EAAE,CAAEjB,KAAK,CAAEA,KAAK,CAAC4B,OAAQ,CAAC,CAC3C,CACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}